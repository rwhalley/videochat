(self.webpackChunk=self.webpackChunk||[]).push([[26],{6024:(Ct,G,b)=>{"use strict";b.d(G,{f:()=>g});var y=b(8404),M=b.n(y),I=Object.defineProperty,A=Object.defineProperties,F=Object.getOwnPropertyDescriptors,C=Object.getOwnPropertySymbols,R=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable,p=(f,t,a)=>t in f?I(f,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):f[t]=a,T=(f,t)=>{for(var a in t||(t={}))R.call(t,a)&&p(f,a,t[a]);if(C)for(var a of C(t))O.call(t,a)&&p(f,a,t[a]);return f},S=(f,t)=>A(f,F(t)),E=class{constructor(f,t){this.hlsInstance={},this.hlsStatsState={},this.hlsInstance=f,this.videoEl=t}getState(){return this.hlsStatsState}},m=class extends E{constructor(){super(...arguments),this.timeUpdateHandler=()=>{let f=this.videoEl.buffered.length>0?this.videoEl.buffered.end(0)-this.videoEl.buffered.start(0):0,t=(this.hlsInstance.liveSyncPosition?this.hlsInstance.liveSyncPosition-this.videoEl.currentTime:0)*1e3,a=this.videoEl.getVideoPlaybackQuality().droppedVideoFrames;this.hlsStatsState=S(T({},this.hlsStatsState),{distanceFromLive:t>0?t:0,bufferedDuration:f,droppedFrames:a})},this.levelLoadedHandler=(f,{level:t})=>{let a=this.hlsInstance.levels[t],{bitrate:h,height:v,width:i}=a;this.hlsStatsState=S(T({},this.hlsStatsState),{bitrate:h,videoSize:{height:v,width:i}})},this.fragChangedHandler=(f,{frag:t})=>{let{stats:a,baseurl:h}=t,{bwEstimate:v}=a;this.hlsStatsState=S(T({},this.hlsStatsState),{bandwidthEstimate:v,url:h})}}startGatheringStats(){this.hlsInstance.on(M().Events.FRAG_CHANGED,this.fragChangedHandler),this.hlsInstance.on(M().Events.LEVEL_LOADED,this.levelLoadedHandler),this.videoEl.addEventListener("timeupdate",this.timeUpdateHandler)}finishGatheringStats(){this.videoEl.removeEventListener("timeupdate",this.timeUpdateHandler),this.hlsInstance.off(M().Events.FRAG_CHANGED,this.fragChangedHandler),this.hlsInstance.off(M().Events.LEVEL_LOADED,this.levelLoadedHandler)}},g=class{constructor(f,t){this.intervalFunctionId=-1;let a=new m(f,t);this.adapter=a}subscribe(f,t=2e3){return this.adapter.startGatheringStats(),this.intervalFunctionId=setInterval(()=>{f(this.getState())},t),this.unsubscribe.bind(this)}unsubscribe(){clearInterval(this.intervalFunctionId),this.adapter.finishGatheringStats()}getState(){return this.adapter.getState()}}},27:(Ct,G,b)=>{"use strict";b.d(G,{Z:()=>M});var y=b(8160),M=I=>y.createElement("svg",Object.assign({width:"24px",height:"24px",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},I),y.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M18.707 6.707a1 1 0 0 0-1.414-1.414L12 10.586 6.707 5.293a1 1 0 0 0-1.414 1.414L10.586 12l-5.293 5.293a1 1 0 1 0 1.414 1.414L12 13.414l5.293 5.293a1 1 0 0 0 1.414-1.414L13.414 12l5.293-5.293Z",fill:"currentColor"}))},5285:(Ct,G,b)=>{"use strict";b.d(G,{Z:()=>M});var y=b(8160),M=I=>y.createElement("svg",Object.assign({width:"24px",height:"24px",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},I),y.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.595 9.595a3.273 3.273 0 0 1 2.314-.959h1.636a.818.818 0 0 0 0-1.636H7.91a4.91 4.91 0 0 0 0 9.818h1.636a.818.818 0 0 0 0-1.636H7.91a3.273 3.273 0 0 1-2.314-5.587ZM14.455 7a.818.818 0 0 0 0 1.636h1.636a3.273 3.273 0 0 1 0 6.546h-1.637a.818.818 0 0 0 0 1.636h1.637a4.909 4.909 0 1 0 0-9.818h-1.637Zm-5.728 4.09a.818.818 0 0 0 0 1.637h6.546a.818.818 0 1 0 0-1.636H8.727Z",fill:"currentColor"}))},8404:function(Ct){typeof window<"u"&&function(b,y){Ct.exports=y()}(this,function(){return function(G){var b={};function y(M){if(b[M])return b[M].exports;var I=b[M]={i:M,l:!1,exports:{}};return G[M].call(I.exports,I,I.exports,y),I.l=!0,I.exports}return y.m=G,y.c=b,y.d=function(M,I,A){y.o(M,I)||Object.defineProperty(M,I,{enumerable:!0,get:A})},y.r=function(M){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(M,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(M,"__esModule",{value:!0})},y.t=function(M,I){if(I&1&&(M=y(M)),I&8||I&4&&typeof M=="object"&&M&&M.__esModule)return M;var A=Object.create(null);if(y.r(A),Object.defineProperty(A,"default",{enumerable:!0,value:M}),I&2&&typeof M!="string")for(var F in M)y.d(A,F,function(C){return M[C]}.bind(null,F));return A},y.n=function(M){var I=M&&M.__esModule?function(){return M.default}:function(){return M};return y.d(I,"a",I),I},y.o=function(M,I){return Object.prototype.hasOwnProperty.call(M,I)},y.p="/dist/",y(y.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(G,b,y){"use strict";var M=Object.prototype.hasOwnProperty,I="~";function A(){}Object.create&&(A.prototype=Object.create(null),new A().__proto__||(I=!1));function F(p,T,S){this.fn=p,this.context=T,this.once=S||!1}function C(p,T,S,E,m){if(typeof S!="function")throw new TypeError("The listener must be a function");var g=new F(S,E||p,m),f=I?I+T:T;return p._events[f]?p._events[f].fn?p._events[f]=[p._events[f],g]:p._events[f].push(g):(p._events[f]=g,p._eventsCount++),p}function R(p,T){--p._eventsCount===0?p._events=new A:delete p._events[T]}function O(){this._events=new A,this._eventsCount=0}O.prototype.eventNames=function(){var T=[],S,E;if(this._eventsCount===0)return T;for(E in S=this._events)M.call(S,E)&&T.push(I?E.slice(1):E);return Object.getOwnPropertySymbols?T.concat(Object.getOwnPropertySymbols(S)):T},O.prototype.listeners=function(T){var S=I?I+T:T,E=this._events[S];if(!E)return[];if(E.fn)return[E.fn];for(var m=0,g=E.length,f=new Array(g);m<g;m++)f[m]=E[m].fn;return f},O.prototype.listenerCount=function(T){var S=I?I+T:T,E=this._events[S];return E?E.fn?1:E.length:0},O.prototype.emit=function(T,S,E,m,g,f){var t=I?I+T:T;if(!this._events[t])return!1;var a=this._events[t],h=arguments.length,v,i;if(a.fn){switch(a.once&&this.removeListener(T,a.fn,void 0,!0),h){case 1:return a.fn.call(a.context),!0;case 2:return a.fn.call(a.context,S),!0;case 3:return a.fn.call(a.context,S,E),!0;case 4:return a.fn.call(a.context,S,E,m),!0;case 5:return a.fn.call(a.context,S,E,m,g),!0;case 6:return a.fn.call(a.context,S,E,m,g,f),!0}for(i=1,v=new Array(h-1);i<h;i++)v[i-1]=arguments[i];a.fn.apply(a.context,v)}else{var r=a.length,o;for(i=0;i<r;i++)switch(a[i].once&&this.removeListener(T,a[i].fn,void 0,!0),h){case 1:a[i].fn.call(a[i].context);break;case 2:a[i].fn.call(a[i].context,S);break;case 3:a[i].fn.call(a[i].context,S,E);break;case 4:a[i].fn.call(a[i].context,S,E,m);break;default:if(!v)for(o=1,v=new Array(h-1);o<h;o++)v[o-1]=arguments[o];a[i].fn.apply(a[i].context,v)}}return!0},O.prototype.on=function(T,S,E){return C(this,T,S,E,!1)},O.prototype.once=function(T,S,E){return C(this,T,S,E,!0)},O.prototype.removeListener=function(T,S,E,m){var g=I?I+T:T;if(!this._events[g])return this;if(!S)return R(this,g),this;var f=this._events[g];if(f.fn)f.fn===S&&(!m||f.once)&&(!E||f.context===E)&&R(this,g);else{for(var t=0,a=[],h=f.length;t<h;t++)(f[t].fn!==S||m&&!f[t].once||E&&f[t].context!==E)&&a.push(f[t]);a.length?this._events[g]=a.length===1?a[0]:a:R(this,g)}return this},O.prototype.removeAllListeners=function(T){var S;return T?(S=I?I+T:T,this._events[S]&&R(this,S)):(this._events=new A,this._eventsCount=0),this},O.prototype.off=O.prototype.removeListener,O.prototype.addListener=O.prototype.on,O.prefixed=I,O.EventEmitter=O,G.exports=O},"./node_modules/url-toolkit/src/url-toolkit.js":function(G,b,y){(function(M){var I=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,A=/^(?=([^\/?#]*))\1([^]*)$/,F=/(?:\/|^)\.(?=\/)/g,C=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,R={buildAbsoluteURL:function(O,p,T){if(T=T||{},O=O.trim(),p=p.trim(),!p){if(!T.alwaysNormalize)return O;var S=R.parseURL(O);if(!S)throw new Error("Error trying to parse base URL.");return S.path=R.normalizePath(S.path),R.buildURLFromParts(S)}var E=R.parseURL(p);if(!E)throw new Error("Error trying to parse relative URL.");if(E.scheme)return T.alwaysNormalize?(E.path=R.normalizePath(E.path),R.buildURLFromParts(E)):p;var m=R.parseURL(O);if(!m)throw new Error("Error trying to parse base URL.");if(!m.netLoc&&m.path&&m.path[0]!=="/"){var g=A.exec(m.path);m.netLoc=g[1],m.path=g[2]}m.netLoc&&!m.path&&(m.path="/");var f={scheme:m.scheme,netLoc:E.netLoc,path:null,params:E.params,query:E.query,fragment:E.fragment};if(!E.netLoc&&(f.netLoc=m.netLoc,E.path[0]!=="/"))if(!E.path)f.path=m.path,E.params||(f.params=m.params,E.query||(f.query=m.query));else{var t=m.path,a=t.substring(0,t.lastIndexOf("/")+1)+E.path;f.path=R.normalizePath(a)}return f.path===null&&(f.path=T.alwaysNormalize?R.normalizePath(E.path):E.path),R.buildURLFromParts(f)},parseURL:function(O){var p=I.exec(O);return p?{scheme:p[1]||"",netLoc:p[2]||"",path:p[3]||"",params:p[4]||"",query:p[5]||"",fragment:p[6]||""}:null},normalizePath:function(O){for(O=O.split("").reverse().join("").replace(F,"");O.length!==(O=O.replace(C,"")).length;);return O.split("").reverse().join("")},buildURLFromParts:function(O){return O.scheme+O.netLoc+O.path+O.params+O.query+O.fragment}};G.exports=R})(this)},"./node_modules/webworkify-webpack/index.js":function(G,b,y){function M(T){var S={};function E(g){if(S[g])return S[g].exports;var f=S[g]={i:g,l:!1,exports:{}};return T[g].call(f.exports,f,f.exports,E),f.l=!0,f.exports}E.m=T,E.c=S,E.i=function(g){return g},E.d=function(g,f,t){E.o(g,f)||Object.defineProperty(g,f,{configurable:!1,enumerable:!0,get:t})},E.r=function(g){Object.defineProperty(g,"__esModule",{value:!0})},E.n=function(g){var f=g&&g.__esModule?function(){return g.default}:function(){return g};return E.d(f,"a",f),f},E.o=function(g,f){return Object.prototype.hasOwnProperty.call(g,f)},E.p="/",E.oe=function(g){throw console.error(g),g};var m=E(E.s=ENTRY_MODULE);return m.default||m}var I="[\\.|\\-|\\+|\\w|/|@]+",A="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+I+").*?\\)";function F(T){return(T+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function C(T){return!isNaN(1*T)}function R(T,S,E){var m={};m[E]=[];var g=S.toString(),f=g.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!f)return m;for(var t=f[1],a=new RegExp("(\\\\n|\\W)"+F(t)+A,"g"),h;h=a.exec(g);)h[3]!=="dll-reference"&&m[E].push(h[3]);for(a=new RegExp("\\("+F(t)+'\\("(dll-reference\\s('+I+'))"\\)\\)'+A,"g");h=a.exec(g);)T[h[2]]||(m[E].push(h[1]),T[h[2]]=y(h[1]).m),m[h[2]]=m[h[2]]||[],m[h[2]].push(h[4]);for(var v=Object.keys(m),i=0;i<v.length;i++)for(var r=0;r<m[v[i]].length;r++)C(m[v[i]][r])&&(m[v[i]][r]=1*m[v[i]][r]);return m}function O(T){var S=Object.keys(T);return S.reduce(function(E,m){return E||T[m].length>0},!1)}function p(T,S){for(var E={main:[S]},m={main:[]},g={main:{}};O(E);)for(var f=Object.keys(E),t=0;t<f.length;t++){var a=f[t],h=E[a],v=h.pop();if(g[a]=g[a]||{},!(g[a][v]||!T[a][v])){g[a][v]=!0,m[a]=m[a]||[],m[a].push(v);for(var i=R(T,T[a][v],a),r=Object.keys(i),o=0;o<r.length;o++)E[r[o]]=E[r[o]]||[],E[r[o]]=E[r[o]].concat(i[r[o]])}}return m}G.exports=function(T,S){S=S||{};var E={main:y.m},m=S.all?{main:Object.keys(E.main)}:p(E,T),g="";Object.keys(m).filter(function(v){return v!=="main"}).forEach(function(v){for(var i=0;m[v][i];)i++;m[v].push(i),E[v][i]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",g=g+"var "+v+" = ("+M.toString().replace("ENTRY_MODULE",JSON.stringify(i))+")({"+m[v].map(function(r){return""+JSON.stringify(r)+": "+E[v][r].toString()}).join(",")+`});
`}),g=g+"new (("+M.toString().replace("ENTRY_MODULE",JSON.stringify(T))+")({"+m.main.map(function(v){return""+JSON.stringify(v)+": "+E.main[v].toString()}).join(",")+"}))(self);";var f=new window.Blob([g],{type:"text/javascript"});if(S.bare)return f;var t=window.URL||window.webkitURL||window.mozURL||window.msURL,a=t.createObjectURL(f),h=new window.Worker(a);return h.objectURL=a,h}},"./src/config.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"hlsDefaultConfig",function(){return o}),y.d(b,"mergeConfig",function(){return e}),y.d(b,"enableStreamingMode",function(){return s});var M=y("./src/controller/abr-controller.ts"),I=y("./src/controller/audio-stream-controller.ts"),A=y("./src/controller/audio-track-controller.ts"),F=y("./src/controller/subtitle-stream-controller.ts"),C=y("./src/controller/subtitle-track-controller.ts"),R=y("./src/controller/buffer-controller.ts"),O=y("./src/controller/timeline-controller.ts"),p=y("./src/controller/cap-level-controller.ts"),T=y("./src/controller/fps-controller.ts"),S=y("./src/controller/eme-controller.ts"),E=y("./src/controller/cmcd-controller.ts"),m=y("./src/utils/xhr-loader.ts"),g=y("./src/utils/fetch-loader.ts"),f=y("./src/utils/cues.ts"),t=y("./src/utils/mediakeys-helper.ts"),a=y("./src/utils/logger.ts");function h(){return h=Object.assign?Object.assign.bind():function(l){for(var n=1;n<arguments.length;n++){var u=arguments[n];for(var c in u)Object.prototype.hasOwnProperty.call(u,c)&&(l[c]=u[c])}return l},h.apply(this,arguments)}function v(l,n){var u=Object.keys(l);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(l);n&&(c=c.filter(function(D){return Object.getOwnPropertyDescriptor(l,D).enumerable})),u.push.apply(u,c)}return u}function i(l){for(var n=1;n<arguments.length;n++){var u=arguments[n]!=null?arguments[n]:{};n%2?v(Object(u),!0).forEach(function(c){r(l,c,u[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(u)):v(Object(u)).forEach(function(c){Object.defineProperty(l,c,Object.getOwnPropertyDescriptor(u,c))})}return l}function r(l,n,u){return n in l?Object.defineProperty(l,n,{value:u,enumerable:!0,configurable:!0,writable:!0}):l[n]=u,l}var o=i(i({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:m.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:M.default,bufferController:R.default,capLevelController:p.default,fpsController:T.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:t.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},d()),{},{subtitleStreamController:F.SubtitleStreamController,subtitleTrackController:C.default,timelineController:O.TimelineController,audioStreamController:I.default,audioTrackController:A.default,emeController:S.default,cmcdController:E.default});function d(){return{cueHandler:f.default,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function e(l,n){if((n.liveSyncDurationCount||n.liveMaxLatencyDurationCount)&&(n.liveSyncDuration||n.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(n.liveMaxLatencyDurationCount!==void 0&&(n.liveSyncDurationCount===void 0||n.liveMaxLatencyDurationCount<=n.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(n.liveMaxLatencyDuration!==void 0&&(n.liveSyncDuration===void 0||n.liveMaxLatencyDuration<=n.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return h({},l,n)}function s(l){var n=l.loader;if(n!==g.default&&n!==m.default)a.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),l.progressive=!1;else{var u=Object(g.fetchSupported)();u&&(l.loader=g.default,l.progressive=!0,l.enableSoftwareAES=!0,a.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":function(G,b,y){"use strict";y.r(b);var M=y("./src/polyfills/number.ts"),I=y("./src/utils/ewma-bandwidth-estimator.ts"),A=y("./src/events.ts"),F=y("./src/errors.ts"),C=y("./src/types/loader.ts"),R=y("./src/utils/logger.ts");function O(S,E){for(var m=0;m<E.length;m++){var g=E[m];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(S,g.key,g)}}function p(S,E,m){return E&&O(S.prototype,E),m&&O(S,m),Object.defineProperty(S,"prototype",{writable:!1}),S}var T=function(){function S(m){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=m;var g=m.config;this.bwEstimator=new I.default(g.abrEwmaSlowVoD,g.abrEwmaFastVoD,g.abrEwmaDefaultEstimate),this.registerListeners()}var E=S.prototype;return E.registerListeners=function(){var g=this.hls;g.on(A.Events.FRAG_LOADING,this.onFragLoading,this),g.on(A.Events.FRAG_LOADED,this.onFragLoaded,this),g.on(A.Events.FRAG_BUFFERED,this.onFragBuffered,this),g.on(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),g.on(A.Events.ERROR,this.onError,this)},E.unregisterListeners=function(){var g=this.hls;g.off(A.Events.FRAG_LOADING,this.onFragLoading,this),g.off(A.Events.FRAG_LOADED,this.onFragLoaded,this),g.off(A.Events.FRAG_BUFFERED,this.onFragBuffered,this),g.off(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),g.off(A.Events.ERROR,this.onError,this)},E.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},E.onFragLoading=function(g,f){var t=f.frag;if(t.type===C.PlaylistLevelType.MAIN&&!this.timer){var a;this.fragCurrent=t,this.partCurrent=(a=f.part)!=null?a:null,this.timer=self.setInterval(this.onCheck,100)}},E.onLevelLoaded=function(g,f){var t=this.hls.config;f.details.live?this.bwEstimator.update(t.abrEwmaSlowLive,t.abrEwmaFastLive):this.bwEstimator.update(t.abrEwmaSlowVoD,t.abrEwmaFastVoD)},E._abandonRulesCheck=function(){var g=this.fragCurrent,f=this.partCurrent,t=this.hls,a=t.autoLevelEnabled,h=t.config,v=t.media;if(!(!g||!v)){var i=f?f.stats:g.stats,r=f?f.duration:g.duration;if(i.aborted||i.loaded&&i.loaded===i.total||g.level===0){this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!a||v.paused||!v.playbackRate||!v.readyState)){var o=t.mainForwardBufferInfo;if(o!==null){var d=performance.now()-i.loading.start,e=Math.abs(v.playbackRate);if(!(d<=500*r/e)){var s=i.loaded&&i.loading.first,l=this.bwEstimator.getEstimate(),n=t.levels,u=t.minAutoLevel,c=n[g.level],D=i.total||Math.max(i.loaded,Math.round(r*c.maxBitrate/8)),L=s?i.loaded*1e3/d:0,P=L?(D-i.loaded)/L:D*8/l,B=o.len/e;if(!(P<=B)){var x=Number.POSITIVE_INFINITY,U;for(U=g.level-1;U>u;U--){var N=n[U].maxBitrate;if(x=L?r*N/(8*.8*L):r*N/l,x<B)break}x>=P||(R.logger.warn("Fragment "+g.sn+(f?" part "+f.index:"")+" of level "+g.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+U+`
      Current BW estimate: `+(Object(M.isFiniteNumber)(l)?(l/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+P.toFixed(3)+` s
      Estimated load time for the next fragment: `+x.toFixed(3)+` s
      Time to underbuffer: `+B.toFixed(3)+" s"),t.nextLoadLevel=U,s&&this.bwEstimator.sample(d,i.loaded),this.clearTimer(),g.loader&&(this.fragCurrent=this.partCurrent=null,g.loader.abort()),t.trigger(A.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:g,part:f,stats:i}))}}}}}},E.onFragLoaded=function(g,f){var t=f.frag,a=f.part;if(t.type===C.PlaylistLevelType.MAIN&&Object(M.isFiniteNumber)(t.sn)){var h=a?a.stats:t.stats,v=a?a.duration:t.duration;if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var i=this.hls.levels[t.level],r=(i.loaded?i.loaded.bytes:0)+h.loaded,o=(i.loaded?i.loaded.duration:0)+v;i.loaded={bytes:r,duration:o},i.realBitrate=Math.round(8*r/o)}if(t.bitrateTest){var d={stats:h,frag:t,part:a,id:t.type};this.onFragBuffered(A.Events.FRAG_BUFFERED,d)}}},E.onFragBuffered=function(g,f){var t=f.frag,a=f.part,h=a?a.stats:t.stats;if(!h.aborted&&!(t.type!==C.PlaylistLevelType.MAIN||t.sn==="initSegment")){var v=h.parsing.end-h.loading.start;this.bwEstimator.sample(v,h.loaded),h.bwEstimate=this.bwEstimator.getEstimate(),t.bitrateTest?this.bitrateTestDelay=v/1e3:this.bitrateTestDelay=0}},E.onError=function(g,f){switch(f.details){case F.ErrorDetails.FRAG_LOAD_ERROR:case F.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break;default:break}},E.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},E.getNextABRAutoLevel=function(){var g=this.fragCurrent,f=this.partCurrent,t=this.hls,a=t.maxAutoLevel,h=t.config,v=t.minAutoLevel,i=t.media,r=f?f.duration:g?g.duration:0,o=i?i.currentTime:0,d=i&&i.playbackRate!==0?Math.abs(i.playbackRate):1,e=this.bwEstimator?this.bwEstimator.getEstimate():h.abrEwmaDefaultEstimate,s=t.mainForwardBufferInfo,l=(s?s.len:0)/d,n=this.findBestLevel(e,v,a,l,h.abrBandWidthFactor,h.abrBandWidthUpFactor);if(n>=0)return n;R.logger.trace((l?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var u=r?Math.min(r,h.maxStarvationDelay):h.maxStarvationDelay,c=h.abrBandWidthFactor,D=h.abrBandWidthUpFactor;if(!l){var L=this.bitrateTestDelay;if(L){var P=r?Math.min(r,h.maxLoadingDelay):h.maxLoadingDelay;u=P-L,R.logger.trace("bitrate test took "+Math.round(1e3*L)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*u)+" ms"),c=D=1}}return n=this.findBestLevel(e,v,a,l+u,c,D),Math.max(n,0)},E.findBestLevel=function(g,f,t,a,h,v){for(var i,r=this.fragCurrent,o=this.partCurrent,d=this.lastLoadedFragLevel,e=this.hls.levels,s=e[d],l=!!(s!=null&&(i=s.details)!==null&&i!==void 0&&i.live),n=s?.codecSet,u=o?o.duration:r?r.duration:0,c=t;c>=f;c--){var D=e[c];if(!(!D||n&&D.codecSet!==n)){var L=D.details,P=(o?L?.partTarget:L?.averagetargetduration)||u,B=void 0;c<=d?B=h*g:B=v*g;var x=e[c].maxBitrate,U=x*P/B;if(R.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+c+"/"+Math.round(B)+"/"+x+"/"+P+"/"+a+"/"+U),B>x&&(U===0||!Object(M.isFiniteNumber)(U)||l&&!this.bitrateTestDelay||U<a))return c}}return-1},p(S,[{key:"nextAutoLevel",get:function(){var g=this._nextAutoLevel,f=this.bwEstimator;if(g!==-1&&!f.canEstimate())return g;var t=this.getNextABRAutoLevel();return g!==-1&&this.hls.levels[t].loadError?g:(g!==-1&&(t=Math.min(g,t)),t)},set:function(g){this._nextAutoLevel=g}}]),S}();b.default=T},"./src/controller/audio-stream-controller.ts":function(G,b,y){"use strict";y.r(b);var M=y("./src/polyfills/number.ts"),I=y("./src/controller/base-stream-controller.ts"),A=y("./src/events.ts"),F=y("./src/utils/buffer-helper.ts"),C=y("./src/controller/fragment-tracker.ts"),R=y("./src/types/level.ts"),O=y("./src/types/loader.ts"),p=y("./src/loader/fragment.ts"),T=y("./src/demux/chunk-cache.ts"),S=y("./src/demux/transmuxer-interface.ts"),E=y("./src/types/transmuxer.ts"),m=y("./src/controller/fragment-finders.ts"),g=y("./src/utils/discontinuities.ts"),f=y("./src/errors.ts");function t(){return t=Object.assign?Object.assign.bind():function(r){for(var o=1;o<arguments.length;o++){var d=arguments[o];for(var e in d)Object.prototype.hasOwnProperty.call(d,e)&&(r[e]=d[e])}return r},t.apply(this,arguments)}function a(r,o){r.prototype=Object.create(o.prototype),r.prototype.constructor=r,h(r,o)}function h(r,o){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,s){return e.__proto__=s,e},h(r,o)}var v=100,i=function(r){a(o,r);function o(e,s){var l;return l=r.call(this,e,s,"[audio-stream-controller]")||this,l.videoBuffer=null,l.videoTrackCC=-1,l.waitingVideoCC=-1,l.audioSwitch=!1,l.trackId=-1,l.waitingData=null,l.mainDetails=null,l.bufferFlushed=!1,l.cachedTrackLoadedData=null,l._registerListeners(),l}var d=o.prototype;return d.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},d._registerListeners=function(){var s=this.hls;s.on(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.on(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.on(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),s.on(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.on(A.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),s.on(A.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),s.on(A.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),s.on(A.Events.ERROR,this.onError,this),s.on(A.Events.BUFFER_RESET,this.onBufferReset,this),s.on(A.Events.BUFFER_CREATED,this.onBufferCreated,this),s.on(A.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),s.on(A.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),s.on(A.Events.FRAG_BUFFERED,this.onFragBuffered,this)},d._unregisterListeners=function(){var s=this.hls;s.off(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.off(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.off(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),s.off(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.off(A.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),s.off(A.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),s.off(A.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),s.off(A.Events.ERROR,this.onError,this),s.off(A.Events.BUFFER_RESET,this.onBufferReset,this),s.off(A.Events.BUFFER_CREATED,this.onBufferCreated,this),s.off(A.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),s.off(A.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),s.off(A.Events.FRAG_BUFFERED,this.onFragBuffered,this)},d.onInitPtsFound=function(s,l){var n=l.frag,u=l.id,c=l.initPTS;if(u==="main"){var D=n.cc;this.initPTS[n.cc]=c,this.log("InitPTS for cc: "+D+" found from main: "+c),this.videoTrackCC=D,this.state===I.State.WAITING_INIT_PTS&&this.tick()}},d.startLoad=function(s){if(!this.levels){this.startPosition=s,this.state=I.State.STOPPED;return}var l=this.lastCurrentTime;this.stopLoad(),this.setInterval(v),this.fragLoadError=0,l>0&&s===-1?(this.log("Override startPosition with lastCurrentTime @"+l.toFixed(3)),s=l,this.state=I.State.IDLE):(this.loadedmetadata=!1,this.state=I.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=s,this.tick()},d.doTick=function(){switch(this.state){case I.State.IDLE:this.doTickIdle();break;case I.State.WAITING_TRACK:{var s,l=this.levels,n=this.trackId,u=l==null||(s=l[n])===null||s===void 0?void 0:s.details;if(u){if(this.waitForCdnTuneIn(u))break;this.state=I.State.WAITING_INIT_PTS}break}case I.State.FRAG_LOADING_WAITING_RETRY:{var c,D=performance.now(),L=this.retryDate;(!L||D>=L||(c=this.media)!==null&&c!==void 0&&c.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=I.State.IDLE);break}case I.State.WAITING_INIT_PTS:{var P=this.waitingData;if(P){var B=P.frag,x=P.part,U=P.cache,N=P.complete;if(this.initPTS[B.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=I.State.FRAG_LOADING;var k=U.flush(),K={frag:B,part:x,payload:k,networkDetails:null};this._handleFragmentLoadProgress(K),N&&r.prototype._handleFragmentLoadComplete.call(this,K)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+B.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var w=this.getLoadPosition(),W=F.BufferHelper.bufferInfo(this.mediaBuffer,w,this.config.maxBufferHole),H=Object(m.fragmentWithinToleranceTest)(W.end,this.config.maxFragLookUpTolerance,B);H<0&&(this.log("Waiting fragment cc ("+B.cc+") @ "+B.start+" cancelled because another fragment at "+W.end+" is needed"),this.clearWaitingFragment())}}else this.state=I.State.IDLE}}this.onTickEnd()},d.clearWaitingFragment=function(){var s=this.waitingData;s&&(this.fragmentTracker.removeFragment(s.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=I.State.IDLE)},d.resetLoadingState=function(){this.clearWaitingFragment(),r.prototype.resetLoadingState.call(this)},d.onTickEnd=function(){var s=this.media;if(!(!s||!s.readyState)){var l=this.mediaBuffer?this.mediaBuffer:s,n=l.buffered;!this.loadedmetadata&&n.length&&(this.loadedmetadata=!0),this.lastCurrentTime=s.currentTime}},d.doTickIdle=function(){var s,l,n=this.hls,u=this.levels,c=this.media,D=this.trackId,L=n.config;if(!(!u||!u[D])&&!(!c&&(this.startFragRequested||!L.startFragPrefetch))){var P=u[D],B=P.details;if(!B||B.live&&this.levelLastLoaded!==D||this.waitForCdnTuneIn(B)){this.state=I.State.WAITING_TRACK;return}var x=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&x&&(this.bufferFlushed=!1,this.afterBufferFlushed(x,p.ElementaryStreamTypes.AUDIO,O.PlaylistLevelType.AUDIO));var U=this.getFwdBufferInfo(x,O.PlaylistLevelType.AUDIO);if(U!==null){var N=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,O.PlaylistLevelType.MAIN),k=U.len,K=this.getMaxBufferLength(N?.len),w=this.audioSwitch;if(!(k>=K&&!w)){if(!w&&this._streamEnded(U,B)){n.trigger(A.Events.BUFFER_EOS,{type:"audio"}),this.state=I.State.ENDED;return}var W=B.fragments,H=W[0].start,j=U.end;if(w&&c){var Y=this.getLoadPosition();j=Y,B.PTSKnown&&Y<H&&(U.end>H||U.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),c.currentTime=H+.05)}if(!(N&&j>N.end+B.targetduration)&&!((!N||!N.len)&&U.len)){var X=this.getNextFragment(j,B);if(!X){this.bufferFlushed=!0;return}((s=X.decryptdata)===null||s===void 0?void 0:s.keyFormat)==="identity"&&!((l=X.decryptdata)!==null&&l!==void 0&&l.key)?this.loadKey(X,B):this.loadFragment(X,B,j)}}}}},d.getMaxBufferLength=function(s){var l=r.prototype.getMaxBufferLength.call(this);return s?Math.max(l,s):l},d.onMediaDetaching=function(){this.videoBuffer=null,r.prototype.onMediaDetaching.call(this)},d.onAudioTracksUpdated=function(s,l){var n=l.audioTracks;this.resetTransmuxer(),this.levels=n.map(function(u){return new R.Level(u)})},d.onAudioTrackSwitching=function(s,l){var n=!!l.url;this.trackId=l.id;var u=this.fragCurrent;u!=null&&u.loader&&u.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),n?this.setInterval(v):this.resetTransmuxer(),n?(this.audioSwitch=!0,this.state=I.State.IDLE):this.state=I.State.STOPPED,this.tick()},d.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},d.onLevelLoaded=function(s,l){this.mainDetails=l.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(A.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},d.onAudioTrackLoaded=function(s,l){var n;if(this.mainDetails==null){this.cachedTrackLoadedData=l;return}var u=this.levels,c=l.details,D=l.id;if(!u){this.warn("Audio tracks were reset while loading level "+D);return}this.log("Track "+D+" loaded ["+c.startSN+","+c.endSN+"],duration:"+c.totalduration);var L=u[D],P=0;if(c.live||(n=L.details)!==null&&n!==void 0&&n.live){var B=this.mainDetails;if(c.fragments[0]||(c.deltaUpdateFailed=!0),c.deltaUpdateFailed||!B)return;!L.details&&c.hasProgramDateTime&&B.hasProgramDateTime?(Object(g.alignMediaPlaylistByPDT)(c,B),P=c.fragments[0].start):P=this.alignPlaylists(c,L.details)}L.details=c,this.levelLastLoaded=D,!this.startFragRequested&&(this.mainDetails||!c.live)&&this.setStartPosition(L.details,P),this.state===I.State.WAITING_TRACK&&!this.waitForCdnTuneIn(c)&&(this.state=I.State.IDLE),this.tick()},d._handleFragmentLoadProgress=function(s){var l,n=s.frag,u=s.part,c=s.payload,D=this.config,L=this.trackId,P=this.levels;if(!P){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+n.sn+" of level "+n.level+" will not be buffered");return}var B=P[L];console.assert(B,"Audio track is defined on fragment load progress");var x=B.details;console.assert(x,"Audio track details are defined on fragment load progress");var U=D.defaultAudioCodec||B.audioCodec||"mp4a.40.2",N=this.transmuxer;N||(N=this.transmuxer=new S.default(this.hls,O.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var k=this.initPTS[n.cc],K=(l=n.initSegment)===null||l===void 0?void 0:l.data;if(k!==void 0){var w=!1,W=u?u.index:-1,H=W!==-1,j=new E.ChunkMetadata(n.level,n.sn,n.stats.chunkCount,c.byteLength,W,H);N.push(c,K,U,"",n,u,x.totalduration,w,j,k)}else{this.log("Unknown video PTS for cc "+n.cc+", waiting for video PTS before demuxing audio frag "+n.sn+" of ["+x.startSN+" ,"+x.endSN+"],track "+L);var Y=this.waitingData=this.waitingData||{frag:n,part:u,cache:new T.default,complete:!1},X=Y.cache;X.push(new Uint8Array(c)),this.waitingVideoCC=this.videoTrackCC,this.state=I.State.WAITING_INIT_PTS}},d._handleFragmentLoadComplete=function(s){if(this.waitingData){this.waitingData.complete=!0;return}r.prototype._handleFragmentLoadComplete.call(this,s)},d.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},d.onBufferCreated=function(s,l){var n=l.tracks.audio;n&&(this.mediaBuffer=n.buffer||null),l.tracks.video&&(this.videoBuffer=l.tracks.video.buffer||null)},d.onFragBuffered=function(s,l){var n=l.frag,u=l.part;if(n.type===O.PlaylistLevelType.AUDIO){if(this.fragContextChanged(n)){this.warn("Fragment "+n.sn+(u?" p: "+u.index:"")+" of level "+n.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}n.sn!=="initSegment"&&(this.fragPrevious=n,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(A.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(n,u)}},d.onError=function(s,l){switch(l.details){case f.ErrorDetails.FRAG_LOAD_ERROR:case f.ErrorDetails.FRAG_LOAD_TIMEOUT:case f.ErrorDetails.KEY_LOAD_ERROR:case f.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(O.PlaylistLevelType.AUDIO,l);break;case f.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case f.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==I.State.ERROR&&this.state!==I.State.STOPPED&&(this.state=l.fatal?I.State.ERROR:I.State.IDLE,this.warn(l.details+" while loading frag, switching to "+this.state+" state"));break;case f.ErrorDetails.BUFFER_FULL_ERROR:if(l.parent==="audio"&&(this.state===I.State.PARSING||this.state===I.State.PARSED)){var n=!0,u=this.getFwdBufferInfo(this.mediaBuffer,O.PlaylistLevelType.AUDIO);u&&u.len>.5&&(n=!this.reduceMaxBufferLength(u.len)),n&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,r.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break;default:break}},d.onBufferFlushed=function(s,l){var n=l.type;n===p.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},d._handleTransmuxComplete=function(s){var l,n="audio",u=this.hls,c=s.remuxResult,D=s.chunkMeta,L=this.getCurrentContext(D);if(!L){this.warn("The loading context changed while buffering fragment "+D.sn+" of level "+D.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(D.level);return}var P=L.frag,B=L.part,x=L.level.details,U=c.audio,N=c.text,k=c.id3,K=c.initSegment;if(!(this.fragContextChanged(P)||!x)){if(this.state=I.State.PARSING,this.audioSwitch&&U&&this.completeAudioSwitch(),K!=null&&K.tracks&&(this._bufferInitSegment(K.tracks,P,D),u.trigger(A.Events.FRAG_PARSING_INIT_SEGMENT,{frag:P,id:n,tracks:K.tracks})),U){var w=U.startPTS,W=U.endPTS,H=U.startDTS,j=U.endDTS;B&&(B.elementaryStreams[p.ElementaryStreamTypes.AUDIO]={startPTS:w,endPTS:W,startDTS:H,endDTS:j}),P.setElementaryStreamInfo(p.ElementaryStreamTypes.AUDIO,w,W,H,j),this.bufferFragmentData(U,P,B,D)}if(k!=null&&(l=k.samples)!==null&&l!==void 0&&l.length){var Y=t({id:n,frag:P,details:x},k);u.trigger(A.Events.FRAG_PARSING_METADATA,Y)}if(N){var X=t({id:n,frag:P,details:x},N);u.trigger(A.Events.FRAG_PARSING_USERDATA,X)}}},d._bufferInitSegment=function(s,l,n){if(this.state===I.State.PARSING){s.video&&delete s.video;var u=s.audio;if(!!u){u.levelCodec=u.codec,u.id="audio",this.log("Init audio buffer, container:"+u.container+", codecs[parsed]=["+u.codec+"]"),this.hls.trigger(A.Events.BUFFER_CODECS,s);var c=u.initSegment;if(c!=null&&c.byteLength){var D={type:"audio",frag:l,part:null,chunkMeta:n,parent:l.type,data:c};this.hls.trigger(A.Events.BUFFER_APPENDING,D)}this.tick()}}},d.loadFragment=function(s,l,n){var u=this.fragmentTracker.getState(s);this.fragCurrent=s,(this.audioSwitch||u===C.FragmentState.NOT_LOADED||u===C.FragmentState.PARTIAL)&&(s.sn==="initSegment"?this._loadInitSegment(s):l.live&&!Object(M.isFiniteNumber)(this.initPTS[s.cc])?(this.log("Waiting for video PTS in continuity counter "+s.cc+" of live stream before loading audio fragment "+s.sn+" of level "+this.trackId),this.state=I.State.WAITING_INIT_PTS):(this.startFragRequested=!0,r.prototype.loadFragment.call(this,s,l,n)))},d.completeAudioSwitch=function(){var s=this.hls,l=this.media,n=this.trackId;l&&(this.log("Switching audio track : flushing all audio"),r.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,s.trigger(A.Events.AUDIO_TRACK_SWITCHED,{id:n})},o}(I.default);b.default=i},"./src/controller/audio-track-controller.ts":function(G,b,y){"use strict";y.r(b);var M=y("./src/events.ts"),I=y("./src/errors.ts"),A=y("./src/controller/base-playlist-controller.ts"),F=y("./src/types/loader.ts");function C(S,E){for(var m=0;m<E.length;m++){var g=E[m];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(S,g.key,g)}}function R(S,E,m){return E&&C(S.prototype,E),m&&C(S,m),Object.defineProperty(S,"prototype",{writable:!1}),S}function O(S,E){S.prototype=Object.create(E.prototype),S.prototype.constructor=S,p(S,E)}function p(S,E){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(g,f){return g.__proto__=f,g},p(S,E)}var T=function(S){O(E,S);function E(g){var f;return f=S.call(this,g,"[audio-track-controller]")||this,f.tracks=[],f.groupId=null,f.tracksInGroup=[],f.trackId=-1,f.trackName="",f.selectDefaultTrack=!0,f.registerListeners(),f}var m=E.prototype;return m.registerListeners=function(){var f=this.hls;f.on(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),f.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),f.on(M.Events.LEVEL_LOADING,this.onLevelLoading,this),f.on(M.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),f.on(M.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),f.on(M.Events.ERROR,this.onError,this)},m.unregisterListeners=function(){var f=this.hls;f.off(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),f.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),f.off(M.Events.LEVEL_LOADING,this.onLevelLoading,this),f.off(M.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),f.off(M.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),f.off(M.Events.ERROR,this.onError,this)},m.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,S.prototype.destroy.call(this)},m.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},m.onManifestParsed=function(f,t){this.tracks=t.audioTracks||[]},m.onAudioTrackLoaded=function(f,t){var a=t.id,h=t.details,v=this.tracksInGroup[a];if(!v){this.warn("Invalid audio track id "+a);return}var i=v.details;v.details=t.details,this.log("audioTrack "+a+" loaded ["+h.startSN+"-"+h.endSN+"]"),a===this.trackId&&(this.retryCount=0,this.playlistLoaded(a,t,i))},m.onLevelLoading=function(f,t){this.switchLevel(t.level)},m.onLevelSwitching=function(f,t){this.switchLevel(t.level)},m.switchLevel=function(f){var t=this.hls.levels[f];if(!!(t!=null&&t.audioGroupIds)){var a=t.audioGroupIds[t.urlId];if(this.groupId!==a){this.groupId=a;var h=this.tracks.filter(function(i){return!a||i.groupId===a});this.selectDefaultTrack&&!h.some(function(i){return i.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=h;var v={audioTracks:h};this.log("Updating audio tracks, "+h.length+' track(s) found in "'+a+'" group-id'),this.hls.trigger(M.Events.AUDIO_TRACKS_UPDATED,v),this.selectInitialTrack()}}},m.onError=function(f,t){S.prototype.onError.call(this,f,t),!(t.fatal||!t.context)&&t.context.type===F.PlaylistContextType.AUDIO_TRACK&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&this.retryLoadingOrFail(t)},m.setAudioTrack=function(f){var t=this.tracksInGroup;if(f<0||f>=t.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var a=t[this.trackId];this.log("Now switching to audio-track index "+f);var h=t[f],v=h.id,i=h.groupId,r=i===void 0?"":i,o=h.name,d=h.type,e=h.url;if(this.trackId=f,this.trackName=o,this.selectDefaultTrack=!1,this.hls.trigger(M.Events.AUDIO_TRACK_SWITCHING,{id:v,groupId:r,name:o,type:d,url:e}),!(h.details&&!h.details.live)){var s=this.switchParams(h.url,a?.details);this.loadPlaylist(s)}},m.selectInitialTrack=function(){var f=this.tracksInGroup;console.assert(f.length,"Initial audio track should be selected when tracks are known");var t=this.trackName,a=this.findTrackId(t)||this.findTrackId();a!==-1?this.setAudioTrack(a):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(M.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},m.findTrackId=function(f){for(var t=this.tracksInGroup,a=0;a<t.length;a++){var h=t[a];if((!this.selectDefaultTrack||h.default)&&(!f||f===h.name))return h.id}return-1},m.loadPlaylist=function(f){var t=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(t)){var a=t.id,h=t.groupId,v=t.url;if(f)try{v=f.addDirectives(v)}catch(i){this.warn("Could not construct new URL with HLS Delivery Directives: "+i)}this.log("loading audio-track playlist for id: "+a),this.clearTimer(),this.hls.trigger(M.Events.AUDIO_TRACK_LOADING,{url:v,id:a,groupId:h,deliveryDirectives:f||null})}},R(E,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(f){this.selectDefaultTrack=!1,this.setAudioTrack(f)}}]),E}(A.default);b.default=T},"./src/controller/base-playlist-controller.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"default",function(){return R});var M=y("./src/polyfills/number.ts"),I=y("./src/types/level.ts"),A=y("./src/controller/level-helper.ts"),F=y("./src/utils/logger.ts"),C=y("./src/errors.ts"),R=function(){function O(T,S){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=F.logger.log.bind(F.logger,S+":"),this.warn=F.logger.warn.bind(F.logger,S+":"),this.hls=T}var p=O.prototype;return p.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},p.onError=function(S,E){E.fatal&&E.type===C.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},p.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},p.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},p.stopLoad=function(){this.canLoad=!1,this.clearTimer()},p.switchParams=function(S,E){var m=E?.renditionReports;if(m)for(var g=0;g<m.length;g++){var f=m[g],t=""+f.URI;if(t===S.slice(-t.length)){var a=parseInt(f["LAST-MSN"]),h=parseInt(f["LAST-PART"]);if(E&&this.hls.config.lowLatencyMode){var v=Math.min(E.age-E.partTarget,E.targetduration);h!==void 0&&v>E.partTarget&&(h+=1)}if(Object(M.isFiniteNumber)(a))return new I.HlsUrlParameters(a,Object(M.isFiniteNumber)(h)?h:void 0,I.HlsSkip.No)}}},p.loadPlaylist=function(S){},p.shouldLoadTrack=function(S){return this.canLoad&&S&&!!S.url&&(!S.details||S.details.live)},p.playlistLoaded=function(S,E,m){var g=this,f=E.details,t=E.stats,a=t.loading.end?Math.max(0,self.performance.now()-t.loading.end):0;if(f.advancedDateTime=Date.now()-a,f.live||m!=null&&m.live){if(f.reloaded(m),m&&this.log("live playlist "+S+" "+(f.advanced?"REFRESHED "+f.lastPartSn+"-"+f.lastPartIndex:"MISSED")),m&&f.fragments.length>0&&Object(A.mergeDetails)(m,f),!this.canLoad||!f.live)return;var h,v=void 0,i=void 0;if(f.canBlockReload&&f.endSN&&f.advanced){var r=this.hls.config.lowLatencyMode,o=f.lastPartSn,d=f.endSN,e=f.lastPartIndex,s=e!==-1,l=o===d,n=r?0:e;s?(v=l?d+1:o,i=l?n:e+1):v=d+1;var u=f.age,c=u+f.ageHeader,D=Math.min(c-f.partTarget,f.targetduration*1.5);if(D>0){if(m&&D>m.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+m.tuneInGoal+" to: "+D+" with playlist age: "+f.age),D=0;else{var L=Math.floor(D/f.targetduration);if(v+=L,i!==void 0){var P=Math.round(D%f.targetduration/f.partTarget);i+=P}this.log("CDN Tune-in age: "+f.ageHeader+"s last advanced "+u.toFixed(2)+"s goal: "+D+" skip sn "+L+" to part "+i)}f.tuneInGoal=D}if(h=this.getDeliveryDirectives(f,E.deliveryDirectives,v,i),r||!l){this.loadPlaylist(h);return}}else h=this.getDeliveryDirectives(f,E.deliveryDirectives,v,i);var B=Object(A.computeReloadInterval)(f,t);v!==void 0&&f.canBlockReload&&(B-=f.partTarget||1),this.log("reload live playlist "+S+" in "+Math.round(B)+" ms"),this.timer=self.setTimeout(function(){return g.loadPlaylist(h)},B)}else this.clearTimer()},p.getDeliveryDirectives=function(S,E,m,g){var f=Object(I.getSkipValue)(S,m);return E!=null&&E.skip&&S.deltaUpdateFailed&&(m=E.msn,g=E.part,f=I.HlsSkip.No),new I.HlsUrlParameters(m,g,f)},p.retryLoadingOrFail=function(S){var E=this,m=this.hls.config,g=this.retryCount<m.levelLoadingMaxRetry;if(g){var f;if(this.retryCount++,S.details.indexOf("LoadTimeOut")>-1&&(f=S.context)!==null&&f!==void 0&&f.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+S.details+'"'),this.loadPlaylist();else{var t=Math.min(Math.pow(2,this.retryCount)*m.levelLoadingRetryDelay,m.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return E.loadPlaylist()},t),this.warn("retry playlist loading #"+this.retryCount+" in "+t+' ms after "'+S.details+'"')}}else this.warn('cannot recover from error "'+S.details+'"'),this.clearTimer(),S.fatal=!0;return g},O}()},"./src/controller/base-stream-controller.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"State",function(){return d}),y.d(b,"default",function(){return e});var M=y("./src/polyfills/number.ts"),I=y("./src/task-loop.ts"),A=y("./src/controller/fragment-tracker.ts"),F=y("./src/utils/buffer-helper.ts"),C=y("./src/utils/logger.ts"),R=y("./src/events.ts"),O=y("./src/errors.ts"),p=y("./src/types/transmuxer.ts"),T=y("./src/utils/mp4-tools.ts"),S=y("./src/utils/discontinuities.ts"),E=y("./src/controller/fragment-finders.ts"),m=y("./src/controller/level-helper.ts"),g=y("./src/loader/fragment-loader.ts"),f=y("./src/crypt/decrypter.ts"),t=y("./src/utils/time-ranges.ts"),a=y("./src/types/loader.ts");function h(s,l){for(var n=0;n<l.length;n++){var u=l[n];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(s,u.key,u)}}function v(s,l,n){return l&&h(s.prototype,l),n&&h(s,n),Object.defineProperty(s,"prototype",{writable:!1}),s}function i(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function r(s,l){s.prototype=Object.create(l.prototype),s.prototype.constructor=s,o(s,l)}function o(s,l){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(u,c){return u.__proto__=c,u},o(s,l)}var d={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},e=function(s){r(l,s);function l(u,c,D){var L;return L=s.call(this)||this,L.hls=void 0,L.fragPrevious=null,L.fragCurrent=null,L.fragmentTracker=void 0,L.transmuxer=null,L._state=d.STOPPED,L.media=null,L.mediaBuffer=null,L.config=void 0,L.bitrateTest=!1,L.lastCurrentTime=0,L.nextLoadPosition=0,L.startPosition=0,L.loadedmetadata=!1,L.fragLoadError=0,L.retryDate=0,L.levels=null,L.fragmentLoader=void 0,L.levelLastLoaded=null,L.startFragRequested=!1,L.decrypter=void 0,L.initPTS=[],L.onvseeking=null,L.onvended=null,L.logPrefix="",L.log=void 0,L.warn=void 0,L.logPrefix=D,L.log=C.logger.log.bind(C.logger,D+":"),L.warn=C.logger.warn.bind(C.logger,D+":"),L.hls=u,L.fragmentLoader=new g.default(u.config),L.fragmentTracker=c,L.config=u.config,L.decrypter=new f.default(u,u.config),u.on(R.Events.KEY_LOADED,L.onKeyLoaded,i(L)),u.on(R.Events.LEVEL_SWITCHING,L.onLevelSwitching,i(L)),L}var n=l.prototype;return n.doTick=function(){this.onTickEnd()},n.onTickEnd=function(){},n.startLoad=function(c){},n.stopLoad=function(){this.fragmentLoader.abort();var c=this.fragCurrent;c&&this.fragmentTracker.removeFragment(c),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=d.STOPPED},n._streamEnded=function(c,D){var L=this.fragCurrent,P=this.fragmentTracker;if(!D.live&&L&&this.media&&L.sn>=D.endSN&&!c.nextStart){var B=D.partList;if(B!=null&&B.length){var x=B[B.length-1],U=F.BufferHelper.isBuffered(this.media,x.start+x.duration/2);return U}var N=P.getState(L);return N===A.FragmentState.PARTIAL||N===A.FragmentState.OK}return!1},n.onMediaAttached=function(c,D){var L=this.media=this.mediaBuffer=D.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),L.addEventListener("seeking",this.onvseeking),L.addEventListener("ended",this.onvended);var P=this.config;this.levels&&P.autoStartLoad&&this.state===d.STOPPED&&this.startLoad(P.startPosition)},n.onMediaDetaching=function(){var c=this.media;c!=null&&c.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),c&&this.onvseeking&&this.onvended&&(c.removeEventListener("seeking",this.onvseeking),c.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},n.onMediaSeeking=function(){var c=this.config,D=this.fragCurrent,L=this.media,P=this.mediaBuffer,B=this.state,x=L?L.currentTime:0,U=F.BufferHelper.bufferInfo(P||L,x,c.maxBufferHole);if(this.log("media seeking to "+(Object(M.isFiniteNumber)(x)?x.toFixed(3):x)+", state: "+B),B===d.ENDED)this.resetLoadingState();else if(D&&!U.len){var N=c.maxFragLookUpTolerance,k=D.start-N,K=D.start+D.duration+N,w=x>K;(x<k||w)&&(w&&D.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),D.loader.abort()),this.resetLoadingState())}L&&(this.lastCurrentTime=x),!this.loadedmetadata&&!U.len&&(this.nextLoadPosition=this.startPosition=x),this.tickImmediate()},n.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},n.onKeyLoaded=function(c,D){if(!(this.state!==d.KEY_LOADING||D.frag!==this.fragCurrent||!this.levels)){this.state=d.IDLE;var L=this.levels[D.frag.level].details;L&&this.loadFragment(D.frag,L,D.frag.start)}},n.onLevelSwitching=function(c,D){this.fragLoadError=0},n.onHandlerDestroying=function(){this.stopLoad(),s.prototype.onHandlerDestroying.call(this)},n.onHandlerDestroyed=function(){this.state=d.STOPPED,this.hls.off(R.Events.KEY_LOADED,this.onKeyLoaded,this),this.hls.off(R.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,s.prototype.onHandlerDestroyed.call(this)},n.loadKey=function(c,D){this.log("Loading key for "+c.sn+" of ["+D.startSN+"-"+D.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+c.level),this.state=d.KEY_LOADING,this.fragCurrent=c,this.hls.trigger(R.Events.KEY_LOADING,{frag:c})},n.loadFragment=function(c,D,L){this._loadFragForPlayback(c,D,L)},n._loadFragForPlayback=function(c,D,L){var P=this,B=function(U){if(P.fragContextChanged(c)){P.warn("Fragment "+c.sn+(U.part?" p: "+U.part.index:"")+" of level "+c.level+" was dropped during download."),P.fragmentTracker.removeFragment(c);return}c.stats.chunkCount++,P._handleFragmentLoadProgress(U)};this._doFragLoad(c,D,L,B).then(function(x){if(!!x){P.fragLoadError=0;var U=P.state;if(P.fragContextChanged(c)){(U===d.FRAG_LOADING||!P.fragCurrent&&U===d.PARSING)&&(P.fragmentTracker.removeFragment(c),P.state=d.IDLE);return}"payload"in x&&(P.log("Loaded fragment "+c.sn+" of level "+c.level),P.hls.trigger(R.Events.FRAG_LOADED,x)),P._handleFragmentLoadComplete(x)}}).catch(function(x){P.state===d.STOPPED||P.state===d.ERROR||(P.warn(x),P.resetFragmentLoading(c))})},n.flushMainBuffer=function(c,D,L){if(L===void 0&&(L=null),!!(c-D)){var P={startOffset:c,endOffset:D,type:L};this.fragLoadError=0,this.hls.trigger(R.Events.BUFFER_FLUSHING,P)}},n._loadInitSegment=function(c){var D=this;this._doFragLoad(c).then(function(L){if(!L||D.fragContextChanged(c)||!D.levels)throw new Error("init load aborted");return L}).then(function(L){var P=D.hls,B=L.payload,x=c.decryptdata;if(B&&B.byteLength>0&&x&&x.key&&x.iv&&x.method==="AES-128"){var U=self.performance.now();return D.decrypter.webCryptoDecrypt(new Uint8Array(B),x.key.buffer,x.iv.buffer).then(function(N){var k=self.performance.now();return P.trigger(R.Events.FRAG_DECRYPTED,{frag:c,payload:N,stats:{tstart:U,tdecrypt:k}}),L.payload=N,L})}return L}).then(function(L){var P=D.fragCurrent,B=D.hls,x=D.levels;if(!x)throw new Error("init load aborted, missing levels");var U=x[c.level].details;console.assert(U,"Level details are defined when init segment is loaded");var N=c.stats;D.state=d.IDLE,D.fragLoadError=0,c.data=new Uint8Array(L.payload),N.parsing.start=N.buffering.start=self.performance.now(),N.parsing.end=N.buffering.end=self.performance.now(),L.frag===P&&B.trigger(R.Events.FRAG_BUFFERED,{stats:N,frag:P,part:null,id:c.type}),D.tick()}).catch(function(L){D.state===d.STOPPED||D.state===d.ERROR||(D.warn(L),D.resetFragmentLoading(c))})},n.fragContextChanged=function(c){var D=this.fragCurrent;return!c||!D||c.level!==D.level||c.sn!==D.sn||c.urlId!==D.urlId},n.fragBufferedComplete=function(c,D){var L=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+c.type+" sn: "+c.sn+(D?" part: "+D.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+c.level+" "+(L?t.default.toString(F.BufferHelper.getBuffered(L)):"(detached)")),this.state=d.IDLE,L&&(!this.loadedmetadata&&L.buffered.length&&this.fragCurrent===this.fragPrevious&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},n.seekToStartPos=function(){},n._handleFragmentLoadComplete=function(c){var D=this.transmuxer;if(!!D){var L=c.frag,P=c.part,B=c.partsLoaded,x=!B||B.length===0||B.some(function(N){return!N}),U=new p.ChunkMetadata(L.level,L.sn,L.stats.chunkCount+1,0,P?P.index:-1,!x);D.flush(U)}},n._handleFragmentLoadProgress=function(c){},n._doFragLoad=function(c,D,L,P){var B=this;if(L===void 0&&(L=null),!this.levels)throw new Error("frag load aborted, missing levels");if(L=Math.max(c.start,L||0),this.config.lowLatencyMode&&D){var x=D.partList;if(x&&P){L>c.end&&D.fragmentHint&&(c=D.fragmentHint);var U=this.getNextPart(x,c,L);if(U>-1){var N=x[U];return this.log("Loading part sn: "+c.sn+" p: "+N.index+" cc: "+c.cc+" of playlist ["+D.startSN+"-"+D.endSN+"] parts [0-"+U+"-"+(x.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+c.level+", target: "+parseFloat(L.toFixed(3))),this.nextLoadPosition=N.start+N.duration,this.state=d.FRAG_LOADING,this.hls.trigger(R.Events.FRAG_LOADING,{frag:c,part:x[U],targetBufferTime:L}),this.doFragPartsLoad(c,x,U,P).catch(function(k){return B.handleFragLoadError(k)})}else if(!c.url||this.loadedEndOfParts(x,L))return Promise.resolve(null)}}return this.log("Loading fragment "+c.sn+" cc: "+c.cc+" "+(D?"of ["+D.startSN+"-"+D.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+c.level+", target: "+parseFloat(L.toFixed(3))),Object(M.isFiniteNumber)(c.sn)&&!this.bitrateTest&&(this.nextLoadPosition=c.start+c.duration),this.state=d.FRAG_LOADING,this.hls.trigger(R.Events.FRAG_LOADING,{frag:c,targetBufferTime:L}),this.fragmentLoader.load(c,P).catch(function(k){return B.handleFragLoadError(k)})},n.doFragPartsLoad=function(c,D,L,P){var B=this;return new Promise(function(x,U){var N=[],k=function K(w){var W=D[w];B.fragmentLoader.loadPart(c,W,P).then(function(H){N[W.index]=H;var j=H.part;B.hls.trigger(R.Events.FRAG_LOADED,H);var Y=D[w+1];if(Y&&Y.fragment===c)K(w+1);else return x({frag:c,part:j,partsLoaded:N})}).catch(U)};k(L)})},n.handleFragLoadError=function(c){var D=c.data;return D&&D.details===O.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(D.frag,D.part):this.hls.trigger(R.Events.ERROR,D),null},n._handleTransmuxerFlush=function(c){var D=this.getCurrentContext(c);if(!D||this.state!==d.PARSING){this.fragCurrent||(this.state=d.IDLE);return}var L=D.frag,P=D.part,B=D.level,x=self.performance.now();L.stats.parsing.end=x,P&&(P.stats.parsing.end=x),this.updateLevelTiming(L,P,B,c.partial)},n.getCurrentContext=function(c){var D=this.levels,L=c.level,P=c.sn,B=c.part;if(!D||!D[L])return this.warn("Levels object was unset while buffering fragment "+P+" of level "+L+". The current chunk will not be buffered."),null;var x=D[L],U=B>-1?Object(m.getPartWith)(x,P,B):null,N=U?U.fragment:Object(m.getFragmentWithSN)(x,P,this.fragCurrent);return N?{frag:N,part:U,level:x}:null},n.bufferFragmentData=function(c,D,L,P){if(!(!c||this.state!==d.PARSING)){var B=c.data1,x=c.data2,U=B;if(B&&x&&(U=Object(T.appendUint8Array)(B,x)),!(!U||!U.length)){var N={type:c.type,frag:D,part:L,chunkMeta:P,parent:D.type,data:U};this.hls.trigger(R.Events.BUFFER_APPENDING,N),c.dropped&&c.independent&&!L&&this.flushBufferGap(D)}}},n.flushBufferGap=function(c){var D=this.media;if(!!D){if(!F.BufferHelper.isBuffered(D,D.currentTime)){this.flushMainBuffer(0,c.start);return}var L=D.currentTime,P=F.BufferHelper.bufferInfo(D,L,0),B=c.duration,x=Math.min(this.config.maxFragLookUpTolerance*2,B*.25),U=Math.max(Math.min(c.start-x,P.end-x),L+x);c.start-U>x&&this.flushMainBuffer(U,c.start)}},n.getFwdBufferInfo=function(c,D){var L=this.config,P=this.getLoadPosition();if(!Object(M.isFiniteNumber)(P))return null;var B=F.BufferHelper.bufferInfo(c,P,L.maxBufferHole);if(B.len===0&&B.nextStart!==void 0){var x=this.fragmentTracker.getBufferedFrag(P,D);if(x&&B.nextStart<x.end)return F.BufferHelper.bufferInfo(c,P,Math.max(B.nextStart,L.maxBufferHole))}return B},n.getMaxBufferLength=function(c){var D=this.config,L;return c?L=Math.max(8*D.maxBufferSize/c,D.maxBufferLength):L=D.maxBufferLength,Math.min(L,D.maxMaxBufferLength)},n.reduceMaxBufferLength=function(c){var D=this.config,L=c||D.maxBufferLength;return D.maxMaxBufferLength>=L?(D.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+D.maxMaxBufferLength+"s"),!0):!1},n.getNextFragment=function(c,D){var L=D.fragments,P=L.length;if(!P)return null;var B=this.config,x=L[0].start,U;if(D.live){var N=B.initialLiveManifestSize;if(P<N)return this.warn("Not enough fragments to start playback (have: "+P+", need: "+N+")"),null;!D.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(U=this.getInitialLiveFragment(D,L),this.startPosition=U?this.hls.liveSyncPosition||U.start:c)}else c<=x&&(U=L[0]);if(!U){var k=B.lowLatencyMode?D.partEnd:D.fragmentEnd;U=this.getFragmentAtPosition(c,k,D)}return this.mapToInitFragWhenRequired(U)},n.mapToInitFragWhenRequired=function(c){return c!=null&&c.initSegment&&!(c!=null&&c.initSegment.data)&&!this.bitrateTest?c.initSegment:c},n.getNextPart=function(c,D,L){for(var P=-1,B=!1,x=!0,U=0,N=c.length;U<N;U++){var k=c[U];if(x=x&&!k.independent,P>-1&&L<k.start)break;var K=k.loaded;!K&&(B||k.independent||x)&&k.fragment===D&&(P=U),B=K}return P},n.loadedEndOfParts=function(c,D){var L=c[c.length-1];return L&&D>L.start&&L.loaded},n.getInitialLiveFragment=function(c,D){var L=this.fragPrevious,P=null;if(L){if(c.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+L.programDateTime),P=Object(E.findFragmentByPDT)(D,L.endProgramDateTime,this.config.maxFragLookUpTolerance)),!P){var B=L.sn+1;if(B>=c.startSN&&B<=c.endSN){var x=D[B-c.startSN];L.cc===x.cc&&(P=x,this.log("Live playlist, switching playlist, load frag with next SN: "+P.sn))}P||(P=Object(E.findFragWithCC)(D,L.cc),P&&this.log("Live playlist, switching playlist, load frag with same CC: "+P.sn))}}else{var U=this.hls.liveSyncPosition;U!==null&&(P=this.getFragmentAtPosition(U,this.bitrateTest?c.fragmentEnd:c.edge,c))}return P},n.getFragmentAtPosition=function(c,D,L){var P=this.config,B=this.fragPrevious,x=L.fragments,U=L.endSN,N=L.fragmentHint,k=P.maxFragLookUpTolerance,K=!!(P.lowLatencyMode&&L.partList&&N);K&&N&&!this.bitrateTest&&(x=x.concat(N),U=N.sn);var w;if(c<D){var W=c>D-k?0:k;w=Object(E.findFragmentByPTS)(B,x,c,W)}else w=x[x.length-1];if(w){var H=w.sn-L.startSN;if(B&&w.sn===B.sn&&!K){var j=B&&w.level===B.level;if(j){var Y=x[H+1];w.sn<U&&this.fragmentTracker.getState(Y)!==A.FragmentState.OK?(this.log("SN "+w.sn+" just loaded, load next one: "+Y.sn),w=Y):w=null}}}return w},n.synchronizeToLiveEdge=function(c){var D=this.config,L=this.media;if(!!L){var P=this.hls.liveSyncPosition,B=L.currentTime,x=c.fragments[0].start,U=c.edge,N=B>=x-D.maxFragLookUpTolerance&&B<=U;if(P!==null&&L.duration>P&&(B<P||!N)){var k=D.liveMaxLatencyDuration!==void 0?D.liveMaxLatencyDuration:D.liveMaxLatencyDurationCount*c.targetduration;(!N&&L.readyState<4||B<U-k)&&(this.loadedmetadata||(this.nextLoadPosition=P),L.readyState&&(this.warn("Playback: "+B.toFixed(3)+" is located too far from the end of live sliding playlist: "+U+", reset currentTime to : "+P.toFixed(3)),L.currentTime=P))}}},n.alignPlaylists=function(c,D){var L=this.levels,P=this.levelLastLoaded,B=this.fragPrevious,x=P!==null?L[P]:null,U=c.fragments.length;if(!U)return this.warn("No fragments in live playlist"),0;var N=c.fragments[0].start,k=!D,K=c.alignedSliding&&Object(M.isFiniteNumber)(N);if(k||!K&&!N){Object(S.alignStream)(B,x,c);var w=c.fragments[0].start;return this.log("Live playlist sliding: "+w.toFixed(2)+" start-sn: "+(D?D.startSN:"na")+"->"+c.startSN+" prev-sn: "+(B?B.sn:"na")+" fragments: "+U),w}return N},n.waitForCdnTuneIn=function(c){var D=3;return c.live&&c.canBlockReload&&c.partTarget&&c.tuneInGoal>Math.max(c.partHoldBack,c.partTarget*D)},n.setStartPosition=function(c,D){var L=this.startPosition;if(L<D&&(L=-1),L===-1||this.lastCurrentTime===-1){var P=c.startTimeOffset;Object(M.isFiniteNumber)(P)?(L=D+P,P<0&&(L+=c.totalduration),L=Math.min(Math.max(D,L),D+c.totalduration),this.log("Start time offset "+P+" found in playlist, adjust startPosition to "+L),this.startPosition=L):c.live?L=this.hls.liveSyncPosition||D:this.startPosition=L=0,this.lastCurrentTime=L}this.nextLoadPosition=L},n.getLoadPosition=function(){var c=this.media,D=0;return this.loadedmetadata&&c?D=c.currentTime:this.nextLoadPosition&&(D=this.nextLoadPosition),D},n.handleFragLoadAborted=function(c,D){this.transmuxer&&c.sn!=="initSegment"&&c.stats.aborted&&(this.warn("Fragment "+c.sn+(D?" part"+D.index:"")+" of level "+c.level+" was aborted"),this.resetFragmentLoading(c))},n.resetFragmentLoading=function(c){(!this.fragCurrent||!this.fragContextChanged(c)&&this.state!==d.FRAG_LOADING_WAITING_RETRY)&&(this.state=d.IDLE)},n.onFragmentOrKeyLoadError=function(c,D){if(!D.fatal){var L=D.frag;if(!(!L||L.type!==c)){var P=this.fragCurrent;console.assert(P&&L.sn===P.sn&&L.level===P.level&&L.urlId===P.urlId,"Frag load error must match current frag to retry");var B=this.config;if(this.fragLoadError+1<=B.fragLoadingMaxRetry){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var x=Math.min(Math.pow(2,this.fragLoadError)*B.fragLoadingRetryDelay,B.fragLoadingMaxRetryTimeout);this.warn("Fragment "+L.sn+" of "+c+" "+L.level+" failed to load, retrying in "+x+"ms"),this.retryDate=self.performance.now()+x,this.fragLoadError++,this.state=d.FRAG_LOADING_WAITING_RETRY}else D.levelRetry?(c===a.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=d.IDLE):(C.logger.error(D.details+" reaches max retry, redispatch as fatal ..."),D.fatal=!0,this.hls.stopLoad(),this.state=d.ERROR)}}},n.afterBufferFlushed=function(c,D,L){if(!!c){var P=F.BufferHelper.getBuffered(c);this.fragmentTracker.detectEvictedFragments(D,P,L),this.state===d.ENDED&&this.resetLoadingState()}},n.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=d.IDLE},n.resetStartWhenNotLoaded=function(c){if(!this.loadedmetadata){this.startFragRequested=!1;var D=this.levels?this.levels[c].details:null;D!=null&&D.live?(this.startPosition=-1,this.setStartPosition(D,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},n.updateLevelTiming=function(c,D,L,P){var B=this,x=L.details;console.assert(!!x,"level.details must be defined");var U=Object.keys(c.elementaryStreams).reduce(function(N,k){var K=c.elementaryStreams[k];if(K){var w=K.endPTS-K.startPTS;if(w<=0)return B.warn("Could not parse fragment "+c.sn+" "+k+" duration reliably ("+w+")"),N||!1;var W=P?0:Object(m.updateFragPTSDTS)(x,c,K.startPTS,K.endPTS,K.startDTS,K.endDTS);return B.hls.trigger(R.Events.LEVEL_PTS_UPDATED,{details:x,level:L,drift:W,type:k,frag:c,start:K.startPTS,end:K.endPTS}),!0}return N},!1);U||(this.warn("Found no media in fragment "+c.sn+" of level "+L.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=d.PARSED,this.hls.trigger(R.Events.FRAG_PARSED,{frag:c,part:D})},n.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},v(l,[{key:"state",get:function(){return this._state},set:function(c){var D=this._state;D!==c&&(this._state=c,this.log(D+"->"+c))}}]),l}(I.default)},"./src/controller/buffer-controller.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"default",function(){return E});var M=y("./src/polyfills/number.ts"),I=y("./src/events.ts"),A=y("./src/utils/logger.ts"),F=y("./src/errors.ts"),C=y("./src/utils/buffer-helper.ts"),R=y("./src/utils/mediasource-helper.ts"),O=y("./src/loader/fragment.ts"),p=y("./src/controller/buffer-operation-queue.ts"),T=Object(R.getMediaSource)(),S=/([ha]vc.)(?:\.[^.,]+)+/,E=function(){function m(f){var t=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var a=t.hls,h=t.media,v=t.mediaSource;A.logger.log("[buffer-controller]: Media source opened"),h&&(t.updateMediaElementDuration(),a.trigger(I.Events.MEDIA_ATTACHED,{media:h})),v&&v.removeEventListener("sourceopen",t._onMediaSourceOpen),t.checkPendingTracks()},this._onMediaSourceClose=function(){A.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){A.logger.log("[buffer-controller]: Media source ended")},this.hls=f,this._initSourceBuffer(),this.registerListeners()}var g=m.prototype;return g.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},g.destroy=function(){this.unregisterListeners(),this.details=null},g.registerListeners=function(){var t=this.hls;t.on(I.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(I.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(I.Events.BUFFER_RESET,this.onBufferReset,this),t.on(I.Events.BUFFER_APPENDING,this.onBufferAppending,this),t.on(I.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.on(I.Events.BUFFER_EOS,this.onBufferEos,this),t.on(I.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(I.Events.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(I.Events.FRAG_PARSED,this.onFragParsed,this),t.on(I.Events.FRAG_CHANGED,this.onFragChanged,this)},g.unregisterListeners=function(){var t=this.hls;t.off(I.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(I.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(I.Events.BUFFER_RESET,this.onBufferReset,this),t.off(I.Events.BUFFER_APPENDING,this.onBufferAppending,this),t.off(I.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.off(I.Events.BUFFER_EOS,this.onBufferEos,this),t.off(I.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(I.Events.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(I.Events.FRAG_PARSED,this.onFragParsed,this),t.off(I.Events.FRAG_CHANGED,this.onFragChanged,this)},g._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new p.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},g.onManifestParsed=function(t,a){var h=2;(a.audio&&!a.video||!a.altAudio)&&(h=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=h,this.details=null,A.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},g.onMediaAttaching=function(t,a){var h=this.media=a.media;if(h&&T){var v=this.mediaSource=new T;v.addEventListener("sourceopen",this._onMediaSourceOpen),v.addEventListener("sourceended",this._onMediaSourceEnded),v.addEventListener("sourceclose",this._onMediaSourceClose),h.src=self.URL.createObjectURL(v),this._objectUrl=h.src}},g.onMediaDetaching=function(){var t=this.media,a=this.mediaSource,h=this._objectUrl;if(a){if(A.logger.log("[buffer-controller]: media source detaching"),a.readyState==="open")try{a.endOfStream()}catch(v){A.logger.warn("[buffer-controller]: onMediaDetaching: "+v.message+" while calling endOfStream")}this.onBufferReset(),a.removeEventListener("sourceopen",this._onMediaSourceOpen),a.removeEventListener("sourceended",this._onMediaSourceEnded),a.removeEventListener("sourceclose",this._onMediaSourceClose),t&&(h&&self.URL.revokeObjectURL(h),t.src===h?(t.removeAttribute("src"),t.load()):A.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(I.Events.MEDIA_DETACHED,void 0)},g.onBufferReset=function(){var t=this;this.getSourceBufferTypes().forEach(function(a){var h=t.sourceBuffer[a];try{h&&(t.removeBufferListeners(a),t.mediaSource&&t.mediaSource.removeSourceBuffer(h),t.sourceBuffer[a]=void 0)}catch(v){A.logger.warn("[buffer-controller]: Failed to reset the "+a+" buffer",v)}}),this._initSourceBuffer()},g.onBufferCodecs=function(t,a){var h=this,v=this.getSourceBufferTypes().length;Object.keys(a).forEach(function(i){if(v){var r=h.tracks[i];if(r&&typeof r.buffer.changeType=="function"){var o=a[i],d=o.id,e=o.codec,s=o.levelCodec,l=o.container,n=o.metadata,u=(r.levelCodec||r.codec).replace(S,"$1"),c=(s||e).replace(S,"$1");if(u!==c){var D=l+";codecs="+(s||e);h.appendChangeType(i,D),A.logger.log("[buffer-controller]: switching codec "+u+" to "+c),h.tracks[i]={buffer:r.buffer,codec:e,container:l,levelCodec:s,metadata:n,id:d}}}}else h.pendingTracks[i]=a[i]}),!v&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},g.appendChangeType=function(t,a){var h=this,v=this.operationQueue,i={execute:function(){var o=h.sourceBuffer[t];o&&(A.logger.log("[buffer-controller]: changing "+t+" sourceBuffer type to "+a),o.changeType(a)),v.shiftAndExecuteNext(t)},onStart:function(){},onComplete:function(){},onError:function(o){A.logger.warn("[buffer-controller]: Failed to change "+t+" SourceBuffer type",o)}};v.append(i,t)},g.onBufferAppending=function(t,a){var h=this,v=this.hls,i=this.operationQueue,r=this.tracks,o=a.data,d=a.type,e=a.frag,s=a.part,l=a.chunkMeta,n=l.buffering[d],u=self.performance.now();n.start=u;var c=e.stats.buffering,D=s?s.stats.buffering:null;c.start===0&&(c.start=u),D&&D.start===0&&(D.start=u);var L=r.audio,P=d==="audio"&&l.id===1&&L?.container==="audio/mpeg",B={execute:function(){if(n.executeStart=self.performance.now(),P){var U=h.sourceBuffer[d];if(U){var N=e.start-U.timestampOffset;Math.abs(N)>=.1&&(A.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+e.start+" (delta: "+N+") sn: "+e.sn+")"),U.timestampOffset=e.start)}}h.appendExecutor(o,d)},onStart:function(){},onComplete:function(){var U=self.performance.now();n.executeEnd=n.end=U,c.first===0&&(c.first=U),D&&D.first===0&&(D.first=U);var N=h.sourceBuffer,k={};for(var K in N)k[K]=C.BufferHelper.getBuffered(N[K]);h.appendError=0,h.hls.trigger(I.Events.BUFFER_APPENDED,{type:d,frag:e,part:s,chunkMeta:l,parent:e.type,timeRanges:k})},onError:function(U){A.logger.error("[buffer-controller]: Error encountered while trying to append to the "+d+" SourceBuffer",U);var N={type:F.ErrorTypes.MEDIA_ERROR,parent:e.type,details:F.ErrorDetails.BUFFER_APPEND_ERROR,err:U,fatal:!1};U.code===DOMException.QUOTA_EXCEEDED_ERR?N.details=F.ErrorDetails.BUFFER_FULL_ERROR:(h.appendError++,N.details=F.ErrorDetails.BUFFER_APPEND_ERROR,h.appendError>v.config.appendErrorMaxRetry&&(A.logger.error("[buffer-controller]: Failed "+v.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),N.fatal=!0,v.stopLoad())),v.trigger(I.Events.ERROR,N)}};i.append(B,d)},g.onBufferFlushing=function(t,a){var h=this,v=this.operationQueue,i=function(o){return{execute:h.removeExecutor.bind(h,o,a.startOffset,a.endOffset),onStart:function(){},onComplete:function(){h.hls.trigger(I.Events.BUFFER_FLUSHED,{type:o})},onError:function(e){A.logger.warn("[buffer-controller]: Failed to remove from "+o+" SourceBuffer",e)}}};a.type?v.append(i(a.type),a.type):this.getSourceBufferTypes().forEach(function(r){v.append(i(r),r)})},g.onFragParsed=function(t,a){var h=this,v=a.frag,i=a.part,r=[],o=i?i.elementaryStreams:v.elementaryStreams;o[O.ElementaryStreamTypes.AUDIOVIDEO]?r.push("audiovideo"):(o[O.ElementaryStreamTypes.AUDIO]&&r.push("audio"),o[O.ElementaryStreamTypes.VIDEO]&&r.push("video"));var d=function(){var s=self.performance.now();v.stats.buffering.end=s,i&&(i.stats.buffering.end=s);var l=i?i.stats:v.stats;h.hls.trigger(I.Events.FRAG_BUFFERED,{frag:v,part:i,stats:l,id:v.type})};r.length===0&&A.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+v.type+" level: "+v.level+" sn: "+v.sn),this.blockBuffers(d,r)},g.onFragChanged=function(t,a){this.flushBackBuffer()},g.onBufferEos=function(t,a){var h=this,v=this.getSourceBufferTypes().reduce(function(i,r){var o=h.sourceBuffer[r];return(!a.type||a.type===r)&&o&&!o.ended&&(o.ended=!0,A.logger.log("[buffer-controller]: "+r+" sourceBuffer now EOS")),i&&!!(!o||o.ended)},!0);v&&this.blockBuffers(function(){var i=h.mediaSource;!i||i.readyState!=="open"||i.endOfStream()})},g.onLevelUpdated=function(t,a){var h=a.details;!h.fragments.length||(this.details=h,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},g.flushBackBuffer=function(){var t=this.hls,a=this.details,h=this.media,v=this.sourceBuffer;if(!(!h||a===null)){var i=this.getSourceBufferTypes();if(!!i.length){var r=a.live&&t.config.liveBackBufferLength!==null?t.config.liveBackBufferLength:t.config.backBufferLength;if(!(!Object(M.isFiniteNumber)(r)||r<0)){var o=h.currentTime,d=a.levelTargetDuration,e=Math.max(r,d),s=Math.floor(o/d)*d-e;i.forEach(function(l){var n=v[l];if(n){var u=C.BufferHelper.getBuffered(n);u.length>0&&s>u.start(0)&&(t.trigger(I.Events.BACK_BUFFER_REACHED,{bufferEnd:s}),a.live&&t.trigger(I.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:s}),t.trigger(I.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:s,type:l}))}})}}}},g.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var t=this.details,a=this.hls,h=this.media,v=this.mediaSource,i=t.fragments[0].start+t.totalduration,r=h.duration,o=Object(M.isFiniteNumber)(v.duration)?v.duration:0;t.live&&a.config.liveDurationInfinity?(A.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),v.duration=1/0,this.updateSeekableRange(t)):(i>o&&i>r||!Object(M.isFiniteNumber)(r))&&(A.logger.log("[buffer-controller]: Updating Media Source duration to "+i.toFixed(3)),v.duration=i)}},g.updateSeekableRange=function(t){var a=this.mediaSource,h=t.fragments,v=h.length;if(v&&t.live&&a!==null&&a!==void 0&&a.setLiveSeekableRange){var i=Math.max(0,h[0].start),r=Math.max(i,i+t.totalduration);a.setLiveSeekableRange(i,r)}},g.checkPendingTracks=function(){var t=this.bufferCodecEventsExpected,a=this.operationQueue,h=this.pendingTracks,v=Object.keys(h).length;if(v&&!t||v===2){this.createSourceBuffers(h),this.pendingTracks={};var i=this.getSourceBufferTypes();if(i.length===0){this.hls.trigger(I.Events.ERROR,{type:F.ErrorTypes.MEDIA_ERROR,details:F.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}i.forEach(function(r){a.executeNext(r)})}},g.createSourceBuffers=function(t){var a=this.sourceBuffer,h=this.mediaSource;if(!h)throw Error("createSourceBuffers called when mediaSource was null");var v=0;for(var i in t)if(!a[i]){var r=t[i];if(!r)throw Error("source buffer exists for track "+i+", however track does not");var o=r.levelCodec||r.codec,d=r.container+";codecs="+o;A.logger.log("[buffer-controller]: creating sourceBuffer("+d+")");try{var e=a[i]=h.addSourceBuffer(d),s=i;this.addBufferListener(s,"updatestart",this._onSBUpdateStart),this.addBufferListener(s,"updateend",this._onSBUpdateEnd),this.addBufferListener(s,"error",this._onSBUpdateError),this.tracks[i]={buffer:e,codec:o,container:r.container,levelCodec:r.levelCodec,metadata:r.metadata,id:r.id},v++}catch(l){A.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+l.message),this.hls.trigger(I.Events.ERROR,{type:F.ErrorTypes.MEDIA_ERROR,details:F.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:l,mimeType:d})}}v&&this.hls.trigger(I.Events.BUFFER_CREATED,{tracks:this.tracks})},g._onSBUpdateStart=function(t){var a=this.operationQueue,h=a.current(t);h.onStart()},g._onSBUpdateEnd=function(t){var a=this.operationQueue,h=a.current(t);h.onComplete(),a.shiftAndExecuteNext(t)},g._onSBUpdateError=function(t,a){A.logger.error("[buffer-controller]: "+t+" SourceBuffer error",a),this.hls.trigger(I.Events.ERROR,{type:F.ErrorTypes.MEDIA_ERROR,details:F.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var h=this.operationQueue.current(t);h&&h.onError(a)},g.removeExecutor=function(t,a,h){var v=this.media,i=this.mediaSource,r=this.operationQueue,o=this.sourceBuffer,d=o[t];if(!v||!i||!d){A.logger.warn("[buffer-controller]: Attempting to remove from the "+t+" SourceBuffer, but it does not exist"),r.shiftAndExecuteNext(t);return}var e=Object(M.isFiniteNumber)(v.duration)?v.duration:1/0,s=Object(M.isFiniteNumber)(i.duration)?i.duration:1/0,l=Math.max(0,a),n=Math.min(h,e,s);n>l?(A.logger.log("[buffer-controller]: Removing ["+l+","+n+"] from the "+t+" SourceBuffer"),console.assert(!d.updating,t+" sourceBuffer must not be updating"),d.remove(l,n)):r.shiftAndExecuteNext(t)},g.appendExecutor=function(t,a){var h=this.operationQueue,v=this.sourceBuffer,i=v[a];if(!i){A.logger.warn("[buffer-controller]: Attempting to append to the "+a+" SourceBuffer, but it does not exist"),h.shiftAndExecuteNext(a);return}i.ended=!1,console.assert(!i.updating,a+" sourceBuffer must not be updating"),i.appendBuffer(t)},g.blockBuffers=function(t,a){var h=this;if(a===void 0&&(a=this.getSourceBufferTypes()),!a.length){A.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(t);return}var v=this.operationQueue,i=a.map(function(r){return v.appendBlocker(r)});Promise.all(i).then(function(){t(),a.forEach(function(r){var o=h.sourceBuffer[r];(!o||!o.updating)&&v.shiftAndExecuteNext(r)})})},g.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},g.addBufferListener=function(t,a,h){var v=this.sourceBuffer[t];if(!!v){var i=h.bind(this,t);this.listeners[t].push({event:a,listener:i}),v.addEventListener(a,i)}},g.removeBufferListeners=function(t){var a=this.sourceBuffer[t];!a||this.listeners[t].forEach(function(h){a.removeEventListener(h.event,h.listener)})},m}()},"./src/controller/buffer-operation-queue.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"default",function(){return I});var M=y("./src/utils/logger.ts"),I=function(){function A(C){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=C}var F=A.prototype;return F.append=function(R,O){var p=this.queues[O];p.push(R),p.length===1&&this.buffers[O]&&this.executeNext(O)},F.insertAbort=function(R,O){var p=this.queues[O];p.unshift(R),this.executeNext(O)},F.appendBlocker=function(R){var O,p=new Promise(function(S){O=S}),T={execute:O,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(T,R),p},F.executeNext=function(R){var O=this.buffers,p=this.queues,T=O[R],S=p[R];if(S.length){var E=S[0];try{E.execute()}catch(m){M.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),E.onError(m),(!T||!T.updating)&&(S.shift(),this.executeNext(R))}}},F.shiftAndExecuteNext=function(R){this.queues[R].shift(),this.executeNext(R)},F.current=function(R){return this.queues[R][0]},A}()},"./src/controller/cap-level-controller.ts":function(G,b,y){"use strict";y.r(b);var M=y("./src/events.ts");function I(C,R){for(var O=0;O<R.length;O++){var p=R[O];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(C,p.key,p)}}function A(C,R,O){return R&&I(C.prototype,R),O&&I(C,O),Object.defineProperty(C,"prototype",{writable:!1}),C}var F=function(){function C(O){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=O,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var R=C.prototype;return R.setStreamController=function(p){this.streamController=p},R.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},R.registerListeners=function(){var p=this.hls;p.on(M.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),p.on(M.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),p.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),p.on(M.Events.BUFFER_CODECS,this.onBufferCodecs,this),p.on(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},R.unregisterListener=function(){var p=this.hls;p.off(M.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),p.off(M.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),p.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),p.off(M.Events.BUFFER_CODECS,this.onBufferCodecs,this),p.off(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},R.onFpsDropLevelCapping=function(p,T){C.isLevelAllowed(T.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(T.droppedLevel)},R.onMediaAttaching=function(p,T){this.media=T.media instanceof HTMLVideoElement?T.media:null},R.onManifestParsed=function(p,T){var S=this.hls;this.restrictedLevels=[],this.firstLevel=T.firstLevel,S.config.capLevelToPlayerSize&&T.video&&this.startCapping()},R.onBufferCodecs=function(p,T){var S=this.hls;S.config.capLevelToPlayerSize&&T.video&&this.startCapping()},R.onMediaDetaching=function(){this.stopCapping()},R.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var p=this.hls.levels;if(p.length){var T=this.hls;T.autoLevelCapping=this.getMaxLevel(p.length-1),T.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=T.autoLevelCapping}}},R.getMaxLevel=function(p){var T=this,S=this.hls.levels;if(!S.length)return-1;var E=S.filter(function(m,g){return C.isLevelAllowed(g,T.restrictedLevels)&&g<=p});return this.clientRect=null,C.getMaxLevelByMediaSize(E,this.mediaWidth,this.mediaHeight)},R.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},R.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},R.getDimensions=function(){if(this.clientRect)return this.clientRect;var p=this.media,T={width:0,height:0};if(p){var S=p.getBoundingClientRect();T.width=S.width,T.height=S.height,!T.width&&!T.height&&(T.width=S.right-S.left||p.width||0,T.height=S.bottom-S.top||p.height||0)}return this.clientRect=T,T},C.isLevelAllowed=function(p,T){return T===void 0&&(T=[]),T.indexOf(p)===-1},C.getMaxLevelByMediaSize=function(p,T,S){if(!p||!p.length)return-1;for(var E=function(a,h){return h?a.width!==h.width||a.height!==h.height:!0},m=p.length-1,g=0;g<p.length;g+=1){var f=p[g];if((f.width>=T||f.height>=S)&&E(f,p[g+1])){m=g;break}}return m},A(C,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var p=1;if(!this.hls.config.ignoreDevicePixelRatio)try{p=self.devicePixelRatio}catch{}return p}}]),C}();b.default=F},"./src/controller/cmcd-controller.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"default",function(){return E});var M=y("./src/events.ts"),I=y("./src/types/cmcd.ts"),A=y("./src/utils/buffer-helper.ts"),F=y("./src/utils/logger.ts");function C(m,g){for(var f=0;f<g.length;f++){var t=g[f];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(m,t.key,t)}}function R(m,g,f){return g&&C(m.prototype,g),f&&C(m,f),Object.defineProperty(m,"prototype",{writable:!1}),m}function O(m,g){var f=typeof Symbol<"u"&&m[Symbol.iterator]||m["@@iterator"];if(f)return(f=f.call(m)).next.bind(f);if(Array.isArray(m)||(f=p(m))||g&&m&&typeof m.length=="number"){f&&(m=f);var t=0;return function(){return t>=m.length?{done:!0}:{done:!1,value:m[t++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function p(m,g){if(!!m){if(typeof m=="string")return T(m,g);var f=Object.prototype.toString.call(m).slice(8,-1);if(f==="Object"&&m.constructor&&(f=m.constructor.name),f==="Map"||f==="Set")return Array.from(m);if(f==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(f))return T(m,g)}}function T(m,g){(g==null||g>m.length)&&(g=m.length);for(var f=0,t=new Array(g);f<g;f++)t[f]=m[f];return t}function S(){return S=Object.assign?Object.assign.bind():function(m){for(var g=1;g<arguments.length;g++){var f=arguments[g];for(var t in f)Object.prototype.hasOwnProperty.call(f,t)&&(m[t]=f[t])}return m},S.apply(this,arguments)}var E=function(){function m(f){var t=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){t.initialized&&(t.starved=!0),t.buffering=!0},this.onPlaying=function(){t.initialized||(t.initialized=!0),t.buffering=!1},this.applyPlaylistData=function(v){try{t.apply(v,{ot:I.CMCDObjectType.MANIFEST,su:!t.initialized})}catch(i){F.logger.warn("Could not generate manifest CMCD data.",i)}},this.applyFragmentData=function(v){try{var i=v.frag,r=t.hls.levels[i.level],o=t.getObjectType(i),d={d:i.duration*1e3,ot:o};(o===I.CMCDObjectType.VIDEO||o===I.CMCDObjectType.AUDIO||o==I.CMCDObjectType.MUXED)&&(d.br=r.bitrate/1e3,d.tb=t.getTopBandwidth(o)/1e3,d.bl=t.getBufferLength(o)),t.apply(v,d)}catch(e){F.logger.warn("Could not generate segment CMCD data.",e)}},this.hls=f;var a=this.config=f.config,h=a.cmcd;h!=null&&(a.pLoader=this.createPlaylistLoader(),a.fLoader=this.createFragmentLoader(),this.sid=h.sessionId||m.uuid(),this.cid=h.contentId,this.useHeaders=h.useHeaders===!0,this.registerListeners())}var g=m.prototype;return g.registerListeners=function(){var t=this.hls;t.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(M.Events.MEDIA_DETACHED,this.onMediaDetached,this),t.on(M.Events.BUFFER_CREATED,this.onBufferCreated,this)},g.unregisterListeners=function(){var t=this.hls;t.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(M.Events.MEDIA_DETACHED,this.onMediaDetached,this),t.off(M.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},g.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},g.onMediaAttached=function(t,a){this.media=a.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},g.onMediaDetached=function(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},g.onBufferCreated=function(t,a){var h,v;this.audioBuffer=(h=a.tracks.audio)===null||h===void 0?void 0:h.buffer,this.videoBuffer=(v=a.tracks.video)===null||v===void 0?void 0:v.buffer},g.createData=function(){var t;return{v:I.CMCDVersion,sf:I.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(t=this.media)===null||t===void 0?void 0:t.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},g.apply=function(t,a){a===void 0&&(a={}),S(a,this.createData());var h=a.ot===I.CMCDObjectType.INIT||a.ot===I.CMCDObjectType.VIDEO||a.ot===I.CMCDObjectType.MUXED;if(this.starved&&h&&(a.bs=!0,a.su=!0,this.starved=!1),a.su==null&&(a.su=this.buffering),this.useHeaders){var v=m.toHeaders(a);if(!Object.keys(v).length)return;t.headers||(t.headers={}),S(t.headers,v)}else{var i=m.toQuery(a);if(!i)return;t.url=m.appendQueryToUri(t.url,i)}},g.getObjectType=function(t){var a=t.type;if(a==="subtitle")return I.CMCDObjectType.TIMED_TEXT;if(t.sn==="initSegment")return I.CMCDObjectType.INIT;if(a==="audio")return I.CMCDObjectType.AUDIO;if(a==="main")return this.hls.audioTracks.length?I.CMCDObjectType.VIDEO:I.CMCDObjectType.MUXED},g.getTopBandwidth=function(t){var a=0,h,v=this.hls;if(t===I.CMCDObjectType.AUDIO)h=v.audioTracks;else{var i=v.maxAutoLevel,r=i>-1?i+1:v.levels.length;h=v.levels.slice(0,r)}for(var o=O(h),d;!(d=o()).done;){var e=d.value;e.bitrate>a&&(a=e.bitrate)}return a>0?a:NaN},g.getBufferLength=function(t){var a=this.hls.media,h=t===I.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;if(!h||!a)return NaN;var v=A.BufferHelper.bufferInfo(h,a.currentTime,this.config.maxBufferHole);return v.len*1e3},g.createPlaylistLoader=function(){var t=this.config.pLoader,a=this.applyPlaylistData,h=t||this.config.loader;return function(){function v(r){this.loader=void 0,this.loader=new h(r)}var i=v.prototype;return i.destroy=function(){this.loader.destroy()},i.abort=function(){this.loader.abort()},i.load=function(o,d,e){a(o),this.loader.load(o,d,e)},R(v,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),v}()},g.createFragmentLoader=function(){var t=this.config.fLoader,a=this.applyFragmentData,h=t||this.config.loader;return function(){function v(r){this.loader=void 0,this.loader=new h(r)}var i=v.prototype;return i.destroy=function(){this.loader.destroy()},i.abort=function(){this.loader.abort()},i.load=function(o,d,e){a(o),this.loader.load(o,d,e)},R(v,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),v}()},m.uuid=function(){var t=URL.createObjectURL(new Blob),a=t.toString();return URL.revokeObjectURL(t),a.slice(a.lastIndexOf("/")+1)},m.serialize=function(t){for(var a=[],h=function(P){return!Number.isNaN(P)&&P!=null&&P!==""&&P!==!1},v=function(P){return Math.round(P)},i=function(P){return v(P/100)*100},r=function(P){return encodeURIComponent(P)},o={br:v,d:v,bl:i,dl:i,mtp:i,nor:r,rtp:i,tb:v},d=Object.keys(t||{}).sort(),e=O(d),s;!(s=e()).done;){var l=s.value,n=t[l];if(!!h(n)&&!(l==="v"&&n===1)&&!(l=="pr"&&n===1)){var u=o[l];u&&(n=u(n));var c=typeof n,D=void 0;l==="ot"||l==="sf"||l==="st"?D=l+"="+n:c==="boolean"?D=l:c==="number"?D=l+"="+n:D=l+"="+JSON.stringify(n),a.push(D)}}return a.join(",")},m.toHeaders=function(t){for(var a=Object.keys(t),h={},v=["Object","Request","Session","Status"],i=[{},{},{},{}],r={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},o=0,d=a;o<d.length;o++){var e=d[o],s=r[e]!=null?r[e]:1;i[s][e]=t[e]}for(var l=0;l<i.length;l++){var n=m.serialize(i[l]);n&&(h["CMCD-"+v[l]]=n)}return h},m.toQuery=function(t){return"CMCD="+encodeURIComponent(m.serialize(t))},m.appendQueryToUri=function(t,a){if(!a)return t;var h=t.includes("?")?"&":"?";return""+t+h+a},m}()},"./src/controller/eme-controller.ts":function(G,b,y){"use strict";y.r(b);var M=y("./src/events.ts"),I=y("./src/errors.ts"),A=y("./src/utils/logger.ts"),F=y("./src/utils/mediakeys-helper.ts");function C(E,m){for(var g=0;g<m.length;g++){var f=m[g];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(E,f.key,f)}}function R(E,m,g){return m&&C(E.prototype,m),g&&C(E,g),Object.defineProperty(E,"prototype",{writable:!1}),E}var O=3,p=function(m,g,f){var t={audioCapabilities:[],videoCapabilities:[]};return m.forEach(function(a){t.audioCapabilities.push({contentType:'audio/mp4; codecs="'+a+'"',robustness:f.audioRobustness||""})}),g.forEach(function(a){t.videoCapabilities.push({contentType:'video/mp4; codecs="'+a+'"',robustness:f.videoRobustness||""})}),[t]},T=function(m,g,f,t){switch(m){case F.KeySystems.WIDEVINE:return p(g,f,t);default:throw new Error("Unknown key-system: "+m)}},S=function(){function E(g){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=g,this._config=g.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var m=E.prototype;return m.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},m._registerListeners=function(){this.hls.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(M.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this)},m._unregisterListeners=function(){this.hls.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(M.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this)},m.getLicenseServerUrl=function(f){switch(f){case F.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+f+'"')},m._attemptKeySystemAccess=function(f,t,a){var h=this,v=T(f,t,a,this._drmSystemOptions);A.logger.log("Requesting encrypted media key-system access");var i=this.requestMediaKeySystemAccess(f,v);this.mediaKeysPromise=i.then(function(r){return h._onMediaKeySystemAccessObtained(f,r)}),i.catch(function(r){A.logger.error('Failed to obtain key-system "'+f+'" access:',r)})},m._onMediaKeySystemAccessObtained=function(f,t){var a=this;A.logger.log('Access for key-system "'+f+'" obtained');var h={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:t,mediaKeySystemDomain:f};this._mediaKeysList.push(h);var v=Promise.resolve().then(function(){return t.createMediaKeys()}).then(function(i){return h.mediaKeys=i,A.logger.log('Media-keys created for key-system "'+f+'"'),a._onMediaKeysCreated(),i});return v.catch(function(i){A.logger.error("Failed to create media-keys:",i)}),v},m._onMediaKeysCreated=function(){var f=this;this._mediaKeysList.forEach(function(t){t.mediaKeysSession||(t.mediaKeysSession=t.mediaKeys.createSession(),f._onNewMediaKeySession(t.mediaKeysSession))})},m._onNewMediaKeySession=function(f){var t=this;A.logger.log("New key-system session "+f.sessionId),f.addEventListener("message",function(a){t._onKeySessionMessage(f,a.message)},!1)},m._onKeySessionMessage=function(f,t){A.logger.log("Got EME message event, creating license request"),this._requestLicense(t,function(a){A.logger.log("Received license data (length: "+(a&&a.byteLength)+"), updating key-session"),f.update(a).catch(function(h){A.logger.warn("Updating key-session failed: "+h)})})},m.onMediaEncrypted=function(f){var t=this;if(A.logger.log('Media is encrypted using "'+f.initDataType+'" init data type'),!this.mediaKeysPromise){A.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),this.hls.trigger(M.Events.ERROR,{type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}var a=function(v){!t._media||(t._attemptSetMediaKeys(v),t._generateRequestWithPreferredKeySession(f.initDataType,f.initData))};this.mediaKeysPromise.then(a).catch(a)},m._attemptSetMediaKeys=function(f){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var t=this._mediaKeysList[0];if(!t||!t.mediaKeys){A.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),this.hls.trigger(M.Events.ERROR,{type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}A.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(t.mediaKeys),this._hasSetMediaKeys=!0}},m._generateRequestWithPreferredKeySession=function(f,t){var a=this,h=this._mediaKeysList[0];if(!h){A.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),this.hls.trigger(M.Events.ERROR,{type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}if(h.mediaKeysSessionInitialized){A.logger.warn("Key-Session already initialized but requested again");return}var v=h.mediaKeysSession;if(!v){A.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(M.Events.ERROR,{type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});return}if(!t){A.logger.warn("Fatal: initData required for generating a key session is null"),this.hls.trigger(M.Events.ERROR,{type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});return}A.logger.log('Generating key-session request for "'+f+'" init data type'),h.mediaKeysSessionInitialized=!0,v.generateRequest(f,t).then(function(){A.logger.debug("Key-session generation succeeded")}).catch(function(i){A.logger.error("Error generating key-session request:",i),a.hls.trigger(M.Events.ERROR,{type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})},m._createLicenseXhr=function(f,t,a){var h=new XMLHttpRequest;h.responseType="arraybuffer",h.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,h,f,t,a);var v=this._licenseXhrSetup;if(v)try{v.call(this.hls,h,f),v=void 0}catch(i){A.logger.error(i)}try{h.readyState||h.open("POST",f,!0),v&&v.call(this.hls,h,f)}catch(i){throw new Error("issue setting up KeySystem license XHR "+i)}return h},m._onLicenseRequestReadyStageChange=function(f,t,a,h){switch(f.readyState){case 4:if(f.status===200){this._requestLicenseFailureCount=0,A.logger.log("License request succeeded");var v=f.response,i=this._licenseResponseCallback;if(i)try{v=i.call(this.hls,f,t)}catch(o){A.logger.error(o)}h(v)}else{if(A.logger.error("License Request XHR failed ("+t+"). Status: "+f.status+" ("+f.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>O){this.hls.trigger(M.Events.ERROR,{type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});return}var r=O-this._requestLicenseFailureCount+1;A.logger.warn("Retrying license request, "+r+" attempts left"),this._requestLicense(a,h)}break}},m._generateLicenseRequestChallenge=function(f,t){switch(f.mediaKeySystemDomain){case F.KeySystems.WIDEVINE:return t}throw new Error("unsupported key-system: "+f.mediaKeySystemDomain)},m._requestLicense=function(f,t){A.logger.log("Requesting content license for key-system");var a=this._mediaKeysList[0];if(!a){A.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.hls.trigger(M.Events.ERROR,{type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}try{var h=this.getLicenseServerUrl(a.mediaKeySystemDomain),v=this._createLicenseXhr(h,f,t);A.logger.log("Sending license request to URL: "+h);var i=this._generateLicenseRequestChallenge(a,f);v.send(i)}catch(r){A.logger.error("Failure requesting DRM license: "+r),this.hls.trigger(M.Events.ERROR,{type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},m.onMediaAttached=function(f,t){if(!!this._emeEnabled){var a=t.media;this._media=a,a.addEventListener("encrypted",this._onMediaEncrypted)}},m.onMediaDetached=function(){var f=this._media,t=this._mediaKeysList;!f||(f.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(t.map(function(a){if(a.mediaKeysSession)return a.mediaKeysSession.close().catch(function(){})})).then(function(){return f.setMediaKeys(null)}).catch(function(){}))},m.onManifestParsed=function(f,t){if(!!this._emeEnabled){var a=t.levels.map(function(v){return v.audioCodec}).filter(function(v){return!!v}),h=t.levels.map(function(v){return v.videoCodec}).filter(function(v){return!!v});this._attemptKeySystemAccess(F.KeySystems.WIDEVINE,a,h)}},R(E,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),E}();b.default=S},"./src/controller/fps-controller.ts":function(G,b,y){"use strict";y.r(b);var M=y("./src/events.ts"),I=y("./src/utils/logger.ts"),A=function(){function F(R){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=R,this.registerListeners()}var C=F.prototype;return C.setStreamController=function(O){this.streamController=O},C.registerListeners=function(){this.hls.on(M.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},C.unregisterListeners=function(){this.hls.off(M.Events.MEDIA_ATTACHING,this.onMediaAttaching)},C.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},C.onMediaAttaching=function(O,p){var T=this.hls.config;if(T.capLevelOnFPSDrop){var S=p.media instanceof self.HTMLVideoElement?p.media:null;this.media=S,S&&typeof S.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),T.fpsDroppedMonitoringPeriod)}},C.checkFPS=function(O,p,T){var S=performance.now();if(p){if(this.lastTime){var E=S-this.lastTime,m=T-this.lastDroppedFrames,g=p-this.lastDecodedFrames,f=1e3*m/E,t=this.hls;if(t.trigger(M.Events.FPS_DROP,{currentDropped:m,currentDecoded:g,totalDroppedFrames:T}),f>0&&m>t.config.fpsDroppedMonitoringThreshold*g){var a=t.currentLevel;I.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+a),a>0&&(t.autoLevelCapping===-1||t.autoLevelCapping>=a)&&(a=a-1,t.trigger(M.Events.FPS_DROP_LEVEL_CAPPING,{level:a,droppedLevel:t.currentLevel}),t.autoLevelCapping=a,this.streamController.nextLevelSwitch())}}this.lastTime=S,this.lastDroppedFrames=T,this.lastDecodedFrames=p}},C.checkFPSInterval=function(){var O=this.media;if(O)if(this.isVideoPlaybackQualityAvailable){var p=O.getVideoPlaybackQuality();this.checkFPS(O,p.totalVideoFrames,p.droppedVideoFrames)}else this.checkFPS(O,O.webkitDecodedFrameCount,O.webkitDroppedFrameCount)},F}();b.default=A},"./src/controller/fragment-finders.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"findFragmentByPDT",function(){return A}),y.d(b,"findFragmentByPTS",function(){return F}),y.d(b,"fragmentWithinToleranceTest",function(){return C}),y.d(b,"pdtWithinToleranceTest",function(){return R}),y.d(b,"findFragWithCC",function(){return O});var M=y("./src/polyfills/number.ts"),I=y("./src/utils/binary-search.ts");function A(p,T,S){if(T===null||!Array.isArray(p)||!p.length||!Object(M.isFiniteNumber)(T))return null;var E=p[0].programDateTime;if(T<(E||0))return null;var m=p[p.length-1].endProgramDateTime;if(T>=(m||0))return null;S=S||0;for(var g=0;g<p.length;++g){var f=p[g];if(R(T,S,f))return f}return null}function F(p,T,S,E){S===void 0&&(S=0),E===void 0&&(E=0);var m=null;if(p?m=T[p.sn-T[0].sn+1]||null:S===0&&T[0].start===0&&(m=T[0]),m&&C(S,E,m)===0)return m;var g=I.default.search(T,C.bind(null,S,E));return g||m}function C(p,T,S){p===void 0&&(p=0),T===void 0&&(T=0);var E=Math.min(T,S.duration+(S.deltaPTS?S.deltaPTS:0));return S.start+S.duration-E<=p?1:S.start-E>p&&S.start?-1:0}function R(p,T,S){var E=Math.min(T,S.duration+(S.deltaPTS?S.deltaPTS:0))*1e3,m=S.endProgramDateTime||0;return m-E>p}function O(p,T){return I.default.search(p,function(S){return S.cc<T?1:S.cc>T?-1:0})}},"./src/controller/fragment-tracker.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"FragmentState",function(){return A}),y.d(b,"FragmentTracker",function(){return F});var M=y("./src/events.ts"),I=y("./src/types/loader.ts"),A;(function(O){O.NOT_LOADED="NOT_LOADED",O.APPENDING="APPENDING",O.PARTIAL="PARTIAL",O.OK="OK"})(A||(A={}));var F=function(){function O(T){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=T,this._registerListeners()}var p=O.prototype;return p._registerListeners=function(){var S=this.hls;S.on(M.Events.BUFFER_APPENDED,this.onBufferAppended,this),S.on(M.Events.FRAG_BUFFERED,this.onFragBuffered,this),S.on(M.Events.FRAG_LOADED,this.onFragLoaded,this)},p._unregisterListeners=function(){var S=this.hls;S.off(M.Events.BUFFER_APPENDED,this.onBufferAppended,this),S.off(M.Events.FRAG_BUFFERED,this.onFragBuffered,this),S.off(M.Events.FRAG_LOADED,this.onFragLoaded,this)},p.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},p.getAppendedFrag=function(S,E){if(E===I.PlaylistLevelType.MAIN){var m=this.activeFragment,g=this.activeParts;if(!m)return null;if(g)for(var f=g.length;f--;){var t=g[f],a=t?t.end:m.appendedPTS;if(t.start<=S&&a!==void 0&&S<=a)return f>9&&(this.activeParts=g.slice(f-9)),t}else if(m.start<=S&&m.appendedPTS!==void 0&&S<=m.appendedPTS)return m}return this.getBufferedFrag(S,E)},p.getBufferedFrag=function(S,E){for(var m=this.fragments,g=Object.keys(m),f=g.length;f--;){var t=m[g[f]];if(t?.body.type===E&&t.buffered){var a=t.body;if(a.start<=S&&S<=a.end)return a}}return null},p.detectEvictedFragments=function(S,E,m){var g=this;Object.keys(this.fragments).forEach(function(f){var t=g.fragments[f];if(!!t){if(!t.buffered){t.body.type===m&&g.removeFragment(t.body);return}var a=t.range[S];!a||a.time.some(function(h){var v=!g.isTimeBuffered(h.startPTS,h.endPTS,E);return v&&g.removeFragment(t.body),v})}})},p.detectPartialFragments=function(S){var E=this,m=this.timeRanges,g=S.frag,f=S.part;if(!(!m||g.sn==="initSegment")){var t=R(g),a=this.fragments[t];!a||(Object.keys(m).forEach(function(h){var v=g.elementaryStreams[h];if(!!v){var i=m[h],r=f!==null||v.partial===!0;a.range[h]=E.getBufferedTimes(g,f,r,i)}}),a.loaded=null,Object.keys(a.range).length?a.buffered=!0:this.removeFragment(a.body))}},p.fragBuffered=function(S){var E=R(S),m=this.fragments[E];m&&(m.loaded=null,m.buffered=!0)},p.getBufferedTimes=function(S,E,m,g){for(var f={time:[],partial:m},t=E?E.start:S.start,a=E?E.end:S.end,h=S.minEndPTS||a,v=S.maxStartPTS||t,i=0;i<g.length;i++){var r=g.start(i)-this.bufferPadding,o=g.end(i)+this.bufferPadding;if(v>=r&&h<=o){f.time.push({startPTS:Math.max(t,g.start(i)),endPTS:Math.min(a,g.end(i))});break}else if(t<o&&a>r)f.partial=!0,f.time.push({startPTS:Math.max(t,g.start(i)),endPTS:Math.min(a,g.end(i))});else if(a<=r)break}return f},p.getPartialFragment=function(S){var E=null,m,g,f,t=0,a=this.bufferPadding,h=this.fragments;return Object.keys(h).forEach(function(v){var i=h[v];!i||C(i)&&(g=i.body.start-a,f=i.body.end+a,S>=g&&S<=f&&(m=Math.min(S-g,f-S),t<=m&&(E=i.body,t=m)))}),E},p.getState=function(S){var E=R(S),m=this.fragments[E];return m?m.buffered?C(m)?A.PARTIAL:A.OK:A.APPENDING:A.NOT_LOADED},p.isTimeBuffered=function(S,E,m){for(var g,f,t=0;t<m.length;t++){if(g=m.start(t)-this.bufferPadding,f=m.end(t)+this.bufferPadding,S>=g&&E<=f)return!0;if(E<=g)return!1}return!1},p.onFragLoaded=function(S,E){var m=E.frag,g=E.part;if(!(m.sn==="initSegment"||m.bitrateTest||g)){var f=R(m);this.fragments[f]={body:m,loaded:E,buffered:!1,range:Object.create(null)}}},p.onBufferAppended=function(S,E){var m=this,g=E.frag,f=E.part,t=E.timeRanges;if(g.type===I.PlaylistLevelType.MAIN)if(this.activeFragment=g,f){var a=this.activeParts;a||(this.activeParts=a=[]),a.push(f)}else this.activeParts=null;this.timeRanges=t,Object.keys(t).forEach(function(h){var v=t[h];if(m.detectEvictedFragments(h,v),!f)for(var i=0;i<v.length;i++)g.appendedPTS=Math.max(v.end(i),g.appendedPTS||0)})},p.onFragBuffered=function(S,E){this.detectPartialFragments(E)},p.hasFragment=function(S){var E=R(S);return!!this.fragments[E]},p.removeFragmentsInRange=function(S,E,m){var g=this;Object.keys(this.fragments).forEach(function(f){var t=g.fragments[f];if(!!t&&t.buffered){var a=t.body;a.type===m&&a.start<E&&a.end>S&&g.removeFragment(a)}})},p.removeFragment=function(S){var E=R(S);S.stats.loaded=0,S.clearElementaryStreamInfo(),delete this.fragments[E]},p.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},O}();function C(O){var p,T;return O.buffered&&(((p=O.range.video)===null||p===void 0?void 0:p.partial)||((T=O.range.audio)===null||T===void 0?void 0:T.partial))}function R(O){return O.type+"_"+O.level+"_"+O.urlId+"_"+O.sn}},"./src/controller/gap-controller.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"STALL_MINIMUM_DURATION_MS",function(){return C}),y.d(b,"MAX_START_GAP_JUMP",function(){return R}),y.d(b,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return O}),y.d(b,"SKIP_BUFFER_RANGE_START",function(){return p}),y.d(b,"default",function(){return T});var M=y("./src/utils/buffer-helper.ts"),I=y("./src/errors.ts"),A=y("./src/events.ts"),F=y("./src/utils/logger.ts"),C=250,R=2,O=.1,p=.05,T=function(){function S(m,g,f,t){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=m,this.media=g,this.fragmentTracker=f,this.hls=t}var E=S.prototype;return E.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},E.poll=function(g,f){var t=this.config,a=this.media,h=this.stalled;if(a!==null){var v=a.currentTime,i=a.seeking,r=this.seeking&&!i,o=!this.seeking&&i;if(this.seeking=i,v!==g){if(this.moved=!0,h!==null){if(this.stallReported){var d=self.performance.now()-h;F.logger.warn("playback not stuck anymore @"+v+", after "+Math.round(d)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((o||r)&&(this.stalled=null),!(a.paused&&!i||a.ended||a.playbackRate===0||!M.BufferHelper.getBuffered(a).length)){var e=M.BufferHelper.bufferInfo(a,v,0),s=e.len>0,l=e.nextStart||0;if(!(!s&&!l)){if(i){var n=e.len>R,u=!l||f&&f.start<=v||l-v>R&&!this.fragmentTracker.getPartialFragment(v);if(n||u)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var c,D=Math.max(l,e.start||0)-v,L=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,P=L==null||(c=L.details)===null||c===void 0?void 0:c.live,B=P?L.details.targetduration*2:R;if(D>0&&D<=B){this._trySkipBufferHole(null);return}}var x=self.performance.now();if(h===null){this.stalled=x;return}var U=x-h;if(!(!i&&U>=C&&(this._reportStall(e),!this.media))){var N=M.BufferHelper.bufferInfo(a,v,t.maxBufferHole);this._tryFixBufferStall(N,U)}}}}},E._tryFixBufferStall=function(g,f){var t=this.config,a=this.fragmentTracker,h=this.media;if(h!==null){var v=h.currentTime,i=a.getPartialFragment(v);if(i){var r=this._trySkipBufferHole(i);if(r||!this.media)return}g.len>t.maxBufferHole&&f>t.highBufferWatchdogPeriod*1e3&&(F.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},E._reportStall=function(g){var f=this.hls,t=this.media,a=this.stallReported;!a&&t&&(this.stallReported=!0,F.logger.warn("Playback stalling at @"+t.currentTime+" due to low buffer ("+JSON.stringify(g)+")"),f.trigger(A.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:g.len}))},E._trySkipBufferHole=function(g){var f=this.config,t=this.hls,a=this.media;if(a===null)return 0;for(var h=a.currentTime,v=0,i=M.BufferHelper.getBuffered(a),r=0;r<i.length;r++){var o=i.start(r);if(h+f.maxBufferHole>=v&&h<o){var d=Math.max(o+p,a.currentTime+O);return F.logger.warn("skipping hole, adjusting currentTime from "+h+" to "+d),this.moved=!0,this.stalled=null,a.currentTime=d,g&&t.trigger(A.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+h+" to "+d,frag:g}),d}v=i.end(r)}return 0},E._tryNudgeBuffer=function(){var g=this.config,f=this.hls,t=this.media,a=this.nudgeRetry;if(t!==null){var h=t.currentTime;if(this.nudgeRetry++,a<g.nudgeMaxRetry){var v=h+(a+1)*g.nudgeOffset;F.logger.warn("Nudging 'currentTime' from "+h+" to "+v),t.currentTime=v,f.trigger(A.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else F.logger.error("Playhead still not moving while enough data buffered @"+h+" after "+g.nudgeMaxRetry+" nudges"),f.trigger(A.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},S}()},"./src/controller/id3-track-controller.ts":function(G,b,y){"use strict";y.r(b);var M=y("./src/polyfills/number.ts"),I=y("./src/events.ts"),A=y("./src/utils/texttrack-utils.ts"),F=y("./src/demux/id3.ts"),C=y("./src/loader/date-range.ts"),R=y("./src/types/demuxer.ts"),O=.25;function p(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}function T(m,g){return m.getTime()/1e3-g}function S(m){return Uint8Array.from(m.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var E=function(){function m(f){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=f,this._registerListeners()}var g=m.prototype;return g.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},g._registerListeners=function(){var t=this.hls;t.on(I.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(I.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(I.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.on(I.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(I.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},g._unregisterListeners=function(){var t=this.hls;t.off(I.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(I.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(I.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.off(I.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(I.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},g.onMediaAttached=function(t,a){this.media=a.media},g.onMediaDetaching=function(){!this.id3Track||(Object(A.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},g.onManifestLoading=function(){this.dateRangeCuesAppended={}},g.createTrack=function(t){var a=this.getID3Track(t.textTracks);return a.mode="hidden",a},g.getID3Track=function(t){if(!!this.media){for(var a=0;a<t.length;a++){var h=t[a];if(h.kind==="metadata"&&h.label==="id3")return Object(A.sendAddTrackEvent)(h,this.media),h}return this.media.addTextTrack("metadata","id3")}},g.onFragParsingMetadata=function(t,a){if(!!this.media){var h=this.hls.config,v=h.enableEmsgMetadataCues,i=h.enableID3MetadataCues;if(!(!v&&!i)){var r=a.frag,o=a.samples,d=a.details;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var e=d.edge||r.end,s=p(),l=!1,n={},u=0;u<o.length;u++){var c=o[u].type;if(!(c===R.MetadataSchema.emsg&&!v||!i)){var D=F.getID3Frames(o[u].data);if(D){var L=o[u].pts,P=e,B=P-L;B<=0&&(P=L+O);for(var x=0;x<D.length;x++){var U=D[x];if(!F.isTimeStampFrame(U)){var N=new s(L,P,"");N.value=U,c&&(N.type=c),this.id3Track.addCue(N),n[U.key]=null,l=!0}}}}}l&&this.updateId3CueEnds(n)}}},g.updateId3CueEnds=function(t){var a,h=(a=this.id3Track)===null||a===void 0?void 0:a.cues;if(h)for(var v=h.length;v--;){var i,r=h[v],o=(i=r.value)===null||i===void 0?void 0:i.key;if(o&&o in t){var d=t[o];d&&r.endTime!==d&&(r.endTime=d),t[o]=r.startTime}}},g.onBufferFlushing=function(t,a){var h=a.startOffset,v=a.endOffset,i=a.type,r=this.id3Track,o=this.hls;if(!!o){var d=o.config,e=d.enableEmsgMetadataCues,s=d.enableID3MetadataCues;if(r&&(e||s)){var l;i==="audio"?l=function(u){return u.type===R.MetadataSchema.audioId3&&s}:i==="video"?l=function(u){return u.type===R.MetadataSchema.emsg&&e}:l=function(u){return u.type===R.MetadataSchema.audioId3&&s||u.type===R.MetadataSchema.emsg&&e},Object(A.removeCuesInRange)(r,h,v,l)}}},g.onLevelUpdated=function(t,a){var h=this,v=a.details;if(!(!this.media||!v.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)){var i=this.dateRangeCuesAppended,r=this.id3Track,o=v.dateRanges,d=Object.keys(o);if(r)for(var e=Object.keys(i).filter(function(B){return!d.includes(B)}),s=function(x){var U=e[x];Object.keys(i[U].cues).forEach(function(N){r.removeCue(i[U].cues[N])}),delete i[U]},l=e.length;l--;)s(l);var n=v.fragments[v.fragments.length-1];if(!(d.length===0||!Object(M.isFiniteNumber)(n?.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var u=n.programDateTime/1e3-n.start,c=v.edge||n.end,D=p(),L=function(x){var U=d[x],N=o[U],k=i[U],K=k?.cues||{},w=k?.durationKnown||!1,W=T(N.startDate,u),H=c,j=N.endDate;if(j)H=T(j,u),w=!0;else if(N.endOnNext&&!w){var Y=d.reduce(function(V,J){var Z=o[J];return Z.class===N.class&&Z.id!==J&&Z.startDate>N.startDate&&V.push(Z),V},[]).sort(function(V,J){return V.startDate.getTime()-J.startDate.getTime()})[0];Y&&(H=T(Y.startDate,u),w=!0)}for(var X=Object.keys(N.attr),z=0;z<X.length;z++){var _=X[z];if(!(_===C.DateRangeAttribute.ID||_===C.DateRangeAttribute.CLASS||_===C.DateRangeAttribute.START_DATE||_===C.DateRangeAttribute.DURATION||_===C.DateRangeAttribute.END_DATE||_===C.DateRangeAttribute.END_ON_NEXT)){var Q=K[_];if(Q)w&&!k.durationKnown&&(Q.endTime=H);else{var $=N.attr[_];Q=new D(W,H,""),(_===C.DateRangeAttribute.SCTE35_OUT||_===C.DateRangeAttribute.SCTE35_IN)&&($=S($)),Q.value={key:_,data:$},Q.type=R.MetadataSchema.dateRange,h.id3Track.addCue(Q),K[_]=Q}}}i[U]={cues:K,dateRange:N,durationKnown:w}},P=0;P<d.length;P++)L(P)}}},m}();b.default=E},"./src/controller/latency-controller.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"default",function(){return R});var M=y("./src/errors.ts"),I=y("./src/events.ts"),A=y("./src/utils/logger.ts");function F(O,p){for(var T=0;T<p.length;T++){var S=p[T];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(O,S.key,S)}}function C(O,p,T){return p&&F(O.prototype,p),T&&F(O,T),Object.defineProperty(O,"prototype",{writable:!1}),O}var R=function(){function O(T){var S=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return S.timeupdate()},this.hls=T,this.config=T.config,this.registerListeners()}var p=O.prototype;return p.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},p.registerListeners=function(){this.hls.on(I.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(I.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(I.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(I.Events.ERROR,this.onError,this)},p.unregisterListeners=function(){this.hls.off(I.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(I.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(I.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(I.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(I.Events.ERROR,this.onError)},p.onMediaAttached=function(S,E){this.media=E.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},p.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},p.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},p.onLevelUpdated=function(S,E){var m=E.details;this.levelDetails=m,m.advanced&&this.timeupdate(),!m.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},p.onError=function(S,E){E.details===M.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,A.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},p.timeupdate=function(){var S=this.media,E=this.levelDetails;if(!(!S||!E)){this.currentTime=S.currentTime;var m=this.computeLatency();if(m!==null){this._latency=m;var g=this.config,f=g.lowLatencyMode,t=g.maxLiveSyncPlaybackRate;if(!(!f||t===1)){var a=this.targetLatency;if(a!==null){var h=m-a,v=Math.min(this.maxLatency,a+E.targetduration),i=h<v;if(E.live&&i&&h>.05&&this.forwardBufferLength>1){var r=Math.min(2,Math.max(1,t)),o=Math.round(2/(1+Math.exp(-.75*h-this.edgeStalled))*20)/20;S.playbackRate=Math.min(r,Math.max(1,o))}else S.playbackRate!==1&&S.playbackRate!==0&&(S.playbackRate=1)}}}}},p.estimateLiveEdge=function(){var S=this.levelDetails;return S===null?null:S.edge+S.age},p.computeLatency=function(){var S=this.estimateLiveEdge();return S===null?null:S-this.currentTime},C(O,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var S=this.config,E=this.levelDetails;return S.liveMaxLatencyDuration!==void 0?S.liveMaxLatencyDuration:E?S.liveMaxLatencyDurationCount*E.targetduration:0}},{key:"targetLatency",get:function(){var S=this.levelDetails;if(S===null)return null;var E=S.holdBack,m=S.partHoldBack,g=S.targetduration,f=this.config,t=f.liveSyncDuration,a=f.liveSyncDurationCount,h=f.lowLatencyMode,v=this.hls.userConfig,i=h&&m||E;(v.liveSyncDuration||v.liveSyncDurationCount||i===0)&&(i=t!==void 0?t:a*g);var r=g,o=1;return i+Math.min(this.stallCount*o,r)}},{key:"liveSyncPosition",get:function(){var S=this.estimateLiveEdge(),E=this.targetLatency,m=this.levelDetails;if(S===null||E===null||m===null)return null;var g=m.edge,f=S-E-this.edgeStalled,t=g-m.totalduration,a=g-(this.config.lowLatencyMode&&m.partTarget||m.targetduration);return Math.min(Math.max(t,f),a)}},{key:"drift",get:function(){var S=this.levelDetails;return S===null?1:S.drift}},{key:"edgeStalled",get:function(){var S=this.levelDetails;if(S===null)return 0;var E=(this.config.lowLatencyMode&&S.partTarget||S.targetduration)*3;return Math.max(S.age-E,0)}},{key:"forwardBufferLength",get:function(){var S=this.media,E=this.levelDetails;if(!S||!E)return 0;var m=S.buffered.length;return(m?S.buffered.end(m-1):E.edge)-this.currentTime}}]),O}()},"./src/controller/level-controller.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"default",function(){return f});var M=y("./src/types/level.ts"),I=y("./src/events.ts"),A=y("./src/errors.ts"),F=y("./src/utils/codecs.ts"),C=y("./src/controller/level-helper.ts"),R=y("./src/controller/base-playlist-controller.ts"),O=y("./src/types/loader.ts");function p(){return p=Object.assign?Object.assign.bind():function(t){for(var a=1;a<arguments.length;a++){var h=arguments[a];for(var v in h)Object.prototype.hasOwnProperty.call(h,v)&&(t[v]=h[v])}return t},p.apply(this,arguments)}function T(t,a){for(var h=0;h<a.length;h++){var v=a[h];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(t,v.key,v)}}function S(t,a,h){return a&&T(t.prototype,a),h&&T(t,h),Object.defineProperty(t,"prototype",{writable:!1}),t}function E(t,a){t.prototype=Object.create(a.prototype),t.prototype.constructor=t,m(t,a)}function m(t,a){return m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(v,i){return v.__proto__=i,v},m(t,a)}var g=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),f=function(t){E(a,t);function a(v){var i;return i=t.call(this,v,"[level-controller]")||this,i._levels=[],i._firstLevel=-1,i._startLevel=void 0,i.currentLevelIndex=-1,i.manualLevelIndex=-1,i.onParsedComplete=void 0,i._registerListeners(),i}var h=a.prototype;return h._registerListeners=function(){var i=this.hls;i.on(I.Events.MANIFEST_LOADED,this.onManifestLoaded,this),i.on(I.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.on(I.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),i.on(I.Events.FRAG_LOADED,this.onFragLoaded,this),i.on(I.Events.ERROR,this.onError,this)},h._unregisterListeners=function(){var i=this.hls;i.off(I.Events.MANIFEST_LOADED,this.onManifestLoaded,this),i.off(I.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.off(I.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),i.off(I.Events.FRAG_LOADED,this.onFragLoaded,this),i.off(I.Events.ERROR,this.onError,this)},h.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,t.prototype.destroy.call(this)},h.startLoad=function(){var i=this._levels;i.forEach(function(r){r.loadError=0}),t.prototype.startLoad.call(this)},h.onManifestLoaded=function(i,r){var o=[],d=[],e=[],s,l={},n,u=!1,c=!1,D=!1;if(r.levels.forEach(function(x){var U=x.attrs;u=u||!!(x.width&&x.height),c=c||!!x.videoCodec,D=D||!!x.audioCodec,g&&x.audioCodec&&x.audioCodec.indexOf("mp4a.40.34")!==-1&&(x.audioCodec=void 0);var N=x.bitrate+"-"+x.attrs.RESOLUTION+"-"+x.attrs.CODECS;n=l[N],n?n.url.push(x.url):(n=new M.Level(x),l[N]=n,o.push(n)),U&&(U.AUDIO&&Object(C.addGroupId)(n,"audio",U.AUDIO),U.SUBTITLES&&Object(C.addGroupId)(n,"text",U.SUBTITLES))}),(u||c)&&D&&(o=o.filter(function(x){var U=x.videoCodec,N=x.width,k=x.height;return!!U||!!(N&&k)})),o=o.filter(function(x){var U=x.audioCodec,N=x.videoCodec;return(!U||Object(F.isCodecSupportedInMp4)(U,"audio"))&&(!N||Object(F.isCodecSupportedInMp4)(N,"video"))}),r.audioTracks&&(d=r.audioTracks.filter(function(x){return!x.audioCodec||Object(F.isCodecSupportedInMp4)(x.audioCodec,"audio")}),Object(C.assignTrackIdsByGroup)(d)),r.subtitles&&(e=r.subtitles,Object(C.assignTrackIdsByGroup)(e)),o.length>0){s=o[0].bitrate,o.sort(function(x,U){return x.bitrate-U.bitrate}),this._levels=o;for(var L=0;L<o.length;L++)if(o[L].bitrate===s){this._firstLevel=L,this.log("manifest loaded, "+o.length+" level(s) found, first bitrate: "+s);break}var P=D&&!c,B={levels:o,audioTracks:d,subtitleTracks:e,firstLevel:this._firstLevel,stats:r.stats,audio:D,video:c,altAudio:!P&&d.some(function(x){return!!x.url})};this.hls.trigger(I.Events.MANIFEST_PARSED,B),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(I.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:r.url,reason:"no level with compatible codecs found in manifest"})},h.onError=function(i,r){var o;if(t.prototype.onError.call(this,i,r),!r.fatal){var d=r.context,e=this._levels[this.currentLevelIndex];if(d&&(d.type===O.PlaylistContextType.AUDIO_TRACK&&e.audioGroupIds&&d.groupId===e.audioGroupIds[e.urlId]||d.type===O.PlaylistContextType.SUBTITLE_TRACK&&e.textGroupIds&&d.groupId===e.textGroupIds[e.urlId])){this.redundantFailover(this.currentLevelIndex);return}var s=!1,l=!0,n;switch(r.details){case A.ErrorDetails.FRAG_LOAD_ERROR:case A.ErrorDetails.FRAG_LOAD_TIMEOUT:case A.ErrorDetails.KEY_LOAD_ERROR:case A.ErrorDetails.KEY_LOAD_TIMEOUT:if(r.frag){var u=r.frag.type===O.PlaylistLevelType.MAIN?r.frag.level:this.currentLevelIndex,c=this._levels[u];c?(c.fragmentError++,c.fragmentError>this.hls.config.fragLoadingMaxRetry&&(n=u)):n=u}break;case A.ErrorDetails.LEVEL_LOAD_ERROR:case A.ErrorDetails.LEVEL_LOAD_TIMEOUT:d&&(d.deliveryDirectives&&(l=!1),n=d.level),s=!0;break;case A.ErrorDetails.REMUX_ALLOC_ERROR:n=(o=r.level)!=null?o:this.currentLevelIndex,s=!0;break}n!==void 0&&this.recoverLevel(r,n,s,l)}},h.recoverLevel=function(i,r,o,d){var e=i.details,s=this._levels[r];if(s.loadError++,o){var l=this.retryLoadingOrFail(i);if(l)i.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(d){var n=s.url.length;if(n>1&&s.loadError<n)i.levelRetry=!0,this.redundantFailover(r);else if(this.manualLevelIndex===-1){for(var u=-1,c=this._levels,D=c.length;D--;){var L=(D+this.currentLevelIndex)%c.length;if(L!==this.currentLevelIndex&&c[L].loadError===0){u=L;break}}u>-1&&this.currentLevelIndex!==u&&(this.warn(e+": switch to "+u),i.levelRetry=!0,this.hls.nextAutoLevel=u)}}},h.redundantFailover=function(i){var r=this._levels[i],o=r.url.length;if(o>1){var d=(r.urlId+1)%o;this.warn("Switching to redundant URL-id "+d),this._levels.forEach(function(e){e.urlId=d}),this.level=i}},h.onFragLoaded=function(i,r){var o=r.frag;if(o!==void 0&&o.type===O.PlaylistLevelType.MAIN){var d=this._levels[o.level];d!==void 0&&(d.fragmentError=0,d.loadError=0)}},h.onLevelLoaded=function(i,r){var o,d=r.level,e=r.details,s=this._levels[d];if(!s){var l;this.warn("Invalid level index "+d),(l=r.deliveryDirectives)!==null&&l!==void 0&&l.skip&&(e.deltaUpdateFailed=!0);return}d===this.currentLevelIndex?(s.fragmentError===0&&(s.loadError=0,this.retryCount=0),this.playlistLoaded(d,r,s.details)):(o=r.deliveryDirectives)!==null&&o!==void 0&&o.skip&&(e.deltaUpdateFailed=!0)},h.onAudioTrackSwitched=function(i,r){var o=this.hls.levels[this.currentLevelIndex];if(!!o&&o.audioGroupIds){for(var d=-1,e=this.hls.audioTracks[r.id].groupId,s=0;s<o.audioGroupIds.length;s++)if(o.audioGroupIds[s]===e){d=s;break}d!==o.urlId&&(o.urlId=d,this.startLoad())}},h.loadPlaylist=function(i){var r=this.currentLevelIndex,o=this._levels[r];if(this.canLoad&&o&&o.url.length>0){var d=o.urlId,e=o.url[d];if(i)try{e=i.addDirectives(e)}catch(s){this.warn("Could not construct new URL with HLS Delivery Directives: "+s)}this.log("Attempt loading level index "+r+(i?" at sn "+i.msn+" part "+i.part:"")+" with URL-id "+d+" "+e),this.clearTimer(),this.hls.trigger(I.Events.LEVEL_LOADING,{url:e,level:r,id:d,deliveryDirectives:i||null})}},h.removeLevel=function(i,r){var o=function(s,l){return l!==r},d=this._levels.filter(function(e,s){return s!==i?!0:e.url.length>1&&r!==void 0?(e.url=e.url.filter(o),e.audioGroupIds&&(e.audioGroupIds=e.audioGroupIds.filter(o)),e.textGroupIds&&(e.textGroupIds=e.textGroupIds.filter(o)),e.urlId=0,!0):!1}).map(function(e,s){var l=e.details;return l!=null&&l.fragments&&l.fragments.forEach(function(n){n.level=s}),e});this._levels=d,this.hls.trigger(I.Events.LEVELS_UPDATED,{levels:d})},S(a,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(i){var r,o=this._levels;if(o.length!==0&&!(this.currentLevelIndex===i&&(r=o[i])!==null&&r!==void 0&&r.details)){if(i<0||i>=o.length){var d=i<0;if(this.hls.trigger(I.Events.ERROR,{type:A.ErrorTypes.OTHER_ERROR,details:A.ErrorDetails.LEVEL_SWITCH_ERROR,level:i,fatal:d,reason:"invalid level idx"}),d)return;i=Math.min(i,o.length-1)}this.clearTimer();var e=this.currentLevelIndex,s=o[e],l=o[i];this.log("switching to level "+i+" from "+e),this.currentLevelIndex=i;var n=p({},l,{level:i,maxBitrate:l.maxBitrate,uri:l.uri,urlId:l.urlId});delete n._urlId,this.hls.trigger(I.Events.LEVEL_SWITCHING,n);var u=l.details;if(!u||u.live){var c=this.switchParams(l.uri,s?.details);this.loadPlaylist(c)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(i){this.manualLevelIndex=i,this._startLevel===void 0&&(this._startLevel=i),i!==-1&&(this.level=i)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(i){this._firstLevel=i}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var i=this.hls.config.startLevel;return i!==void 0?i:this._firstLevel}else return this._startLevel},set:function(i){this._startLevel=i}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(i){this.level=i,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=i)}}]),a}(R.default)},"./src/controller/level-helper.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"addGroupId",function(){return C}),y.d(b,"assignTrackIdsByGroup",function(){return R}),y.d(b,"updatePTS",function(){return O}),y.d(b,"updateFragPTSDTS",function(){return T}),y.d(b,"mergeDetails",function(){return S}),y.d(b,"mapPartIntersection",function(){return m}),y.d(b,"mapFragmentIntersection",function(){return g}),y.d(b,"adjustSliding",function(){return f}),y.d(b,"addSliding",function(){return t}),y.d(b,"computeReloadInterval",function(){return a}),y.d(b,"getFragmentWithSN",function(){return h}),y.d(b,"getPartWith",function(){return v});var M=y("./src/polyfills/number.ts"),I=y("./src/utils/logger.ts"),A=y("./src/loader/date-range.ts");function F(){return F=Object.assign?Object.assign.bind():function(i){for(var r=1;r<arguments.length;r++){var o=arguments[r];for(var d in o)Object.prototype.hasOwnProperty.call(o,d)&&(i[d]=o[d])}return i},F.apply(this,arguments)}function C(i,r,o){switch(r){case"audio":i.audioGroupIds||(i.audioGroupIds=[]),i.audioGroupIds.push(o);break;case"text":i.textGroupIds||(i.textGroupIds=[]),i.textGroupIds.push(o);break}}function R(i){var r={};i.forEach(function(o){var d=o.groupId||"";o.id=r[d]=r[d]||0,r[d]++})}function O(i,r,o){var d=i[r],e=i[o];p(d,e)}function p(i,r){var o=r.startPTS;if(Object(M.isFiniteNumber)(o)){var d=0,e;r.sn>i.sn?(d=o-i.start,e=i):(d=i.start-o,e=r),e.duration!==d&&(e.duration=d)}else if(r.sn>i.sn){var s=i.cc===r.cc;s&&i.minEndPTS?r.start=i.start+(i.minEndPTS-i.start):r.start=i.start+i.duration}else r.start=Math.max(i.start-r.duration,0)}function T(i,r,o,d,e,s){var l=d-o;l<=0&&(I.logger.warn("Fragment should have a positive duration",r),d=o+r.duration,s=e+r.duration);var n=o,u=d,c=r.startPTS,D=r.endPTS;if(Object(M.isFiniteNumber)(c)){var L=Math.abs(c-o);Object(M.isFiniteNumber)(r.deltaPTS)?r.deltaPTS=Math.max(L,r.deltaPTS):r.deltaPTS=L,n=Math.max(o,c),o=Math.min(o,c),e=Math.min(e,r.startDTS),u=Math.min(d,D),d=Math.max(d,D),s=Math.max(s,r.endDTS)}r.duration=d-o;var P=o-r.start;r.appendedPTS=d,r.start=r.startPTS=o,r.maxStartPTS=n,r.startDTS=e,r.endPTS=d,r.minEndPTS=u,r.endDTS=s;var B=r.sn;if(!i||B<i.startSN||B>i.endSN)return 0;var x,U=B-i.startSN,N=i.fragments;for(N[U]=r,x=U;x>0;x--)p(N[x],N[x-1]);for(x=U;x<N.length-1;x++)p(N[x],N[x+1]);return i.fragmentHint&&p(N[N.length-1],i.fragmentHint),i.PTSKnown=i.alignedSliding=!0,P}function S(i,r){for(var o=null,d=i.fragments,e=d.length-1;e>=0;e--){var s=d[e].initSegment;if(s){o=s;break}}i.fragmentHint&&delete i.fragmentHint.endPTS;var l=0,n;if(g(i,r,function(x,U){x.relurl&&(l=x.cc-U.cc),Object(M.isFiniteNumber)(x.startPTS)&&Object(M.isFiniteNumber)(x.endPTS)&&(U.start=U.startPTS=x.startPTS,U.startDTS=x.startDTS,U.appendedPTS=x.appendedPTS,U.maxStartPTS=x.maxStartPTS,U.endPTS=x.endPTS,U.endDTS=x.endDTS,U.minEndPTS=x.minEndPTS,U.duration=x.endPTS-x.startPTS,U.duration&&(n=U),r.PTSKnown=r.alignedSliding=!0),U.elementaryStreams=x.elementaryStreams,U.loader=x.loader,U.stats=x.stats,U.urlId=x.urlId,x.initSegment&&(U.initSegment=x.initSegment,o=x.initSegment)}),o){var u=r.fragmentHint?r.fragments.concat(r.fragmentHint):r.fragments;u.forEach(function(x){var U;(!x.initSegment||x.initSegment.relurl===((U=o)===null||U===void 0?void 0:U.relurl))&&(x.initSegment=o)})}if(r.skippedSegments)if(r.deltaUpdateFailed=r.fragments.some(function(x){return!x}),r.deltaUpdateFailed){I.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var c=r.skippedSegments;c--;)r.fragments.shift();r.startSN=r.fragments[0].sn,r.startCC=r.fragments[0].cc}else r.canSkipDateRanges&&(r.dateRanges=E(i.dateRanges,r.dateRanges,r.recentlyRemovedDateranges));var D=r.fragments;if(l){I.logger.warn("discontinuity sliding from playlist, take drift into account");for(var L=0;L<D.length;L++)D[L].cc+=l}r.skippedSegments&&(r.startCC=r.fragments[0].cc),m(i.partList,r.partList,function(x,U){U.elementaryStreams=x.elementaryStreams,U.stats=x.stats}),n?T(r,n,n.startPTS,n.endPTS,n.startDTS,n.endDTS):f(i,r),D.length&&(r.totalduration=r.edge-D[0].start),r.driftStartTime=i.driftStartTime,r.driftStart=i.driftStart;var P=r.advancedDateTime;if(r.advanced&&P){var B=r.edge;r.driftStart||(r.driftStartTime=P,r.driftStart=B),r.driftEndTime=P,r.driftEnd=B}else r.driftEndTime=i.driftEndTime,r.driftEnd=i.driftEnd,r.advancedDateTime=i.advancedDateTime}function E(i,r,o){var d=F({},i);return o&&o.forEach(function(e){delete d[e]}),Object.keys(r).forEach(function(e){var s=new A.DateRange(r[e].attr,d[e]);s.isValid?d[e]=s:I.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(r[e].attr)+'"')}),d}function m(i,r,o){if(i&&r)for(var d=0,e=0,s=i.length;e<=s;e++){var l=i[e],n=r[e+d];l&&n&&l.index===n.index&&l.fragment.sn===n.fragment.sn?o(l,n):d--}}function g(i,r,o){for(var d=r.skippedSegments,e=Math.max(i.startSN,r.startSN)-r.startSN,s=(i.fragmentHint?1:0)+(d?r.endSN:Math.min(i.endSN,r.endSN))-r.startSN,l=r.startSN-i.startSN,n=r.fragmentHint?r.fragments.concat(r.fragmentHint):r.fragments,u=i.fragmentHint?i.fragments.concat(i.fragmentHint):i.fragments,c=e;c<=s;c++){var D=u[l+c],L=n[c];d&&!L&&c<d&&(L=r.fragments[c]=D),D&&L&&o(D,L)}}function f(i,r){var o=r.startSN+r.skippedSegments-i.startSN,d=i.fragments;o<0||o>=d.length||t(r,d[o].start)}function t(i,r){if(r){for(var o=i.fragments,d=i.skippedSegments;d<o.length;d++)o[d].start+=r;i.fragmentHint&&(i.fragmentHint.start+=r)}}function a(i,r){var o=1e3*i.levelTargetDuration,d=o/2,e=i.age,s=e>0&&e<o*3,l=r.loading.end-r.loading.start,n,u=i.availabilityDelay;if(i.updated===!1)if(s){var c=333*i.misses;n=Math.max(Math.min(d,l*2),c),i.availabilityDelay=(i.availabilityDelay||0)+n}else n=d;else s?(u=Math.min(u||o/2,e),i.availabilityDelay=u,n=u+o-e):n=o-l;return Math.round(n)}function h(i,r,o){if(!i||!i.details)return null;var d=i.details,e=d.fragments[r-d.startSN];return e||(e=d.fragmentHint,e&&e.sn===r)?e:r<d.startSN&&o&&o.sn===r?o:null}function v(i,r,o){if(!i||!i.details)return null;var d=i.details.partList;if(d)for(var e=d.length;e--;){var s=d[e];if(s.index===o&&s.fragment.sn===r)return s}return null}},"./src/controller/stream-controller.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"default",function(){return v});var M=y("./src/polyfills/number.ts"),I=y("./src/controller/base-stream-controller.ts"),A=y("./src/is-supported.ts"),F=y("./src/events.ts"),C=y("./src/utils/buffer-helper.ts"),R=y("./src/controller/fragment-tracker.ts"),O=y("./src/types/loader.ts"),p=y("./src/loader/fragment.ts"),T=y("./src/demux/transmuxer-interface.ts"),S=y("./src/types/transmuxer.ts"),E=y("./src/controller/gap-controller.ts"),m=y("./src/errors.ts");function g(i,r){for(var o=0;o<r.length;o++){var d=r[o];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(i,d.key,d)}}function f(i,r,o){return r&&g(i.prototype,r),o&&g(i,o),Object.defineProperty(i,"prototype",{writable:!1}),i}function t(i,r){i.prototype=Object.create(r.prototype),i.prototype.constructor=i,a(i,r)}function a(i,r){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(d,e){return d.__proto__=e,d},a(i,r)}var h=100,v=function(i){t(r,i);function r(d,e){var s;return s=i.call(this,d,e,"[stream-controller]")||this,s.audioCodecSwap=!1,s.gapController=null,s.level=-1,s._forceStartLoad=!1,s.altAudio=!1,s.audioOnly=!1,s.fragPlaying=null,s.onvplaying=null,s.onvseeked=null,s.fragLastKbps=0,s.couldBacktrack=!1,s.backtrackFragment=null,s.audioCodecSwitch=!1,s.videoBuffer=null,s._registerListeners(),s}var o=r.prototype;return o._registerListeners=function(){var e=this.hls;e.on(F.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(F.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(F.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(F.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(F.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(F.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(F.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(F.Events.ERROR,this.onError,this),e.on(F.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(F.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(F.Events.BUFFER_CREATED,this.onBufferCreated,this),e.on(F.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(F.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(F.Events.FRAG_BUFFERED,this.onFragBuffered,this)},o._unregisterListeners=function(){var e=this.hls;e.off(F.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(F.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(F.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(F.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(F.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(F.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(F.Events.ERROR,this.onError,this),e.off(F.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(F.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(F.Events.BUFFER_CREATED,this.onBufferCreated,this),e.off(F.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(F.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(F.Events.FRAG_BUFFERED,this.onFragBuffered,this)},o.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},o.startLoad=function(e){if(this.levels){var s=this.lastCurrentTime,l=this.hls;if(this.stopLoad(),this.setInterval(h),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var n=l.startLevel;n===-1&&(l.config.testBandwidth&&this.levels.length>1?(n=0,this.bitrateTest=!0):n=l.nextAutoLevel),this.level=l.nextLoadLevel=n,this.loadedmetadata=!1}s>0&&e===-1&&(this.log("Override startPosition with lastCurrentTime @"+s.toFixed(3)),e=s),this.state=I.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=I.State.STOPPED},o.stopLoad=function(){this._forceStartLoad=!1,i.prototype.stopLoad.call(this)},o.doTick=function(){switch(this.state){case I.State.IDLE:this.doTickIdle();break;case I.State.WAITING_LEVEL:{var e,s=this.levels,l=this.level,n=s==null||(e=s[l])===null||e===void 0?void 0:e.details;if(n&&(!n.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(n))break;this.state=I.State.IDLE;break}break}case I.State.FRAG_LOADING_WAITING_RETRY:{var u,c=self.performance.now(),D=this.retryDate;(!D||c>=D||(u=this.media)!==null&&u!==void 0&&u.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=I.State.IDLE)}break;default:break}this.onTickEnd()},o.onTickEnd=function(){i.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},o.doTickIdle=function(){var e,s,l=this.hls,n=this.levelLastLoaded,u=this.levels,c=this.media,D=l.config,L=l.nextLoadLevel;if(!(n===null||!c&&(this.startFragRequested||!D.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!u||!u[L])){var P=u[L];this.level=l.nextLoadLevel=L;var B=P.details;if(!B||this.state===I.State.WAITING_LEVEL||B.live&&this.levelLastLoaded!==L){this.state=I.State.WAITING_LEVEL;return}var x=this.getMainFwdBufferInfo();if(x!==null){var U=x.len,N=this.getMaxBufferLength(P.maxBitrate);if(!(U>=N)){if(this._streamEnded(x,B)){var k={};this.altAudio&&(k.type="video"),this.hls.trigger(F.Events.BUFFER_EOS,k),this.state=I.State.ENDED;return}this.backtrackFragment&&this.backtrackFragment.start>x.end&&(this.backtrackFragment=null);var K=this.backtrackFragment?this.backtrackFragment.start:x.end,w=this.getNextFragment(K,B);if(this.couldBacktrack&&!this.fragPrevious&&w&&w.sn!=="initSegment"&&this.fragmentTracker.getState(w)!==R.FragmentState.OK){var W,H=((W=this.backtrackFragment)!=null?W:w).sn,j=H-B.startSN,Y=B.fragments[j-1];Y&&w.cc===Y.cc&&(w=Y,this.fragmentTracker.removeFragment(Y))}else this.backtrackFragment&&x.len&&(this.backtrackFragment=null);if(w&&this.fragmentTracker.getState(w)===R.FragmentState.OK&&this.nextLoadPosition>K){var X=this.audioOnly&&!this.altAudio?p.ElementaryStreamTypes.AUDIO:p.ElementaryStreamTypes.VIDEO;c&&this.afterBufferFlushed(c,X,O.PlaylistLevelType.MAIN),w=this.getNextFragment(this.nextLoadPosition,B)}!w||(w.initSegment&&!w.initSegment.data&&!this.bitrateTest&&(w=w.initSegment),((e=w.decryptdata)===null||e===void 0?void 0:e.keyFormat)==="identity"&&!((s=w.decryptdata)!==null&&s!==void 0&&s.key)?this.loadKey(w,B):this.loadFragment(w,B,K))}}}},o.loadFragment=function(e,s,l){var n,u=this.fragmentTracker.getState(e);this.fragCurrent=e,u===R.FragmentState.NOT_LOADED?e.sn==="initSegment"?this._loadInitSegment(e):this.bitrateTest?(this.log("Fragment "+e.sn+" of level "+e.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(e)):(this.startFragRequested=!0,i.prototype.loadFragment.call(this,e,s,l)):u===R.FragmentState.APPENDING?this.reduceMaxBufferLength(e.duration)&&this.fragmentTracker.removeFragment(e):((n=this.media)===null||n===void 0?void 0:n.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},o.getAppendedFrag=function(e){var s=this.fragmentTracker.getAppendedFrag(e,O.PlaylistLevelType.MAIN);return s&&"fragment"in s?s.fragment:s},o.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,O.PlaylistLevelType.MAIN)},o.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.end+.5):null},o.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},o.nextLevelSwitch=function(){var e=this.levels,s=this.media;if(s!=null&&s.readyState){var l,n=this.getAppendedFrag(s.currentTime);if(n&&n.start>1&&this.flushMainBuffer(0,n.start-1),!s.paused&&e){var u=this.hls.nextLoadLevel,c=e[u],D=this.fragLastKbps;D&&this.fragCurrent?l=this.fragCurrent.duration*c.maxBitrate/(1e3*D)+1:l=0}else l=0;var L=this.getBufferedFrag(s.currentTime+l);if(L){var P=this.followingBufferedFrag(L);if(P){this.abortCurrentFrag();var B=P.maxStartPTS?P.maxStartPTS:P.start,x=P.duration,U=Math.max(L.end,B+Math.min(Math.max(x-this.config.maxFragLookUpTolerance,x*.5),x*.75));this.flushMainBuffer(U,Number.POSITIVE_INFINITY)}}}},o.abortCurrentFrag=function(){var e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e!=null&&e.loader&&e.loader.abort(),this.state){case I.State.KEY_LOADING:case I.State.FRAG_LOADING:case I.State.FRAG_LOADING_WAITING_RETRY:case I.State.PARSING:case I.State.PARSED:this.state=I.State.IDLE;break}this.nextLoadPosition=this.getLoadPosition()},o.flushMainBuffer=function(e,s){i.prototype.flushMainBuffer.call(this,e,s,this.altAudio?"video":null)},o.onMediaAttached=function(e,s){i.prototype.onMediaAttached.call(this,e,s);var l=s.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),l.addEventListener("playing",this.onvplaying),l.addEventListener("seeked",this.onvseeked),this.gapController=new E.default(this.config,l,this.fragmentTracker,this.hls)},o.onMediaDetaching=function(){var e=this.media;e&&this.onvplaying&&this.onvseeked&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),i.prototype.onMediaDetaching.call(this)},o.onMediaPlaying=function(){this.tick()},o.onMediaSeeked=function(){var e=this.media,s=e?e.currentTime:null;Object(M.isFiniteNumber)(s)&&this.log("Media seeked to "+s.toFixed(3)),this.tick()},o.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(F.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},o.onManifestParsed=function(e,s){var l=!1,n=!1,u;s.levels.forEach(function(c){u=c.audioCodec,u&&(u.indexOf("mp4a.40.2")!==-1&&(l=!0),u.indexOf("mp4a.40.5")!==-1&&(n=!0))}),this.audioCodecSwitch=l&&n&&!Object(A.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=s.levels,this.startFragRequested=!1},o.onLevelLoading=function(e,s){var l=this.levels;if(!(!l||this.state!==I.State.IDLE)){var n=l[s.level];(!n.details||n.details.live&&this.levelLastLoaded!==s.level||this.waitForCdnTuneIn(n.details))&&(this.state=I.State.WAITING_LEVEL)}},o.onLevelLoaded=function(e,s){var l,n=this.levels,u=s.level,c=s.details,D=c.totalduration;if(!n){this.warn("Levels were reset while loading level "+u);return}this.log("Level "+u+" loaded ["+c.startSN+","+c.endSN+"], cc ["+c.startCC+", "+c.endCC+"] duration:"+D);var L=this.fragCurrent;L&&(this.state===I.State.FRAG_LOADING||this.state===I.State.FRAG_LOADING_WAITING_RETRY)&&L.level!==s.level&&L.loader&&(this.state=I.State.IDLE,this.backtrackFragment=null,L.loader.abort());var P=n[u],B=0;if(c.live||(l=P.details)!==null&&l!==void 0&&l.live){if(c.fragments[0]||(c.deltaUpdateFailed=!0),c.deltaUpdateFailed)return;B=this.alignPlaylists(c,P.details)}if(P.details=c,this.levelLastLoaded=u,this.hls.trigger(F.Events.LEVEL_UPDATED,{details:c,level:u}),this.state===I.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(c))return;this.state=I.State.IDLE}this.startFragRequested?c.live&&this.synchronizeToLiveEdge(c):this.setStartPosition(c,B),this.tick()},o._handleFragmentLoadProgress=function(e){var s,l=e.frag,n=e.part,u=e.payload,c=this.levels;if(!c){this.warn("Levels were reset while fragment load was in progress. Fragment "+l.sn+" of level "+l.level+" will not be buffered");return}var D=c[l.level],L=D.details;if(!L){this.warn("Dropping fragment "+l.sn+" of level "+l.level+" after level details were reset");return}var P=D.videoCodec,B=L.PTSKnown||!L.live,x=(s=l.initSegment)===null||s===void 0?void 0:s.data,U=this._getAudioCodec(D),N=this.transmuxer=this.transmuxer||new T.default(this.hls,O.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),k=n?n.index:-1,K=k!==-1,w=new S.ChunkMetadata(l.level,l.sn,l.stats.chunkCount,u.byteLength,k,K),W=this.initPTS[l.cc];N.push(u,x,U,P,l,n,L.totalduration,B,w,W)},o.onAudioTrackSwitching=function(e,s){var l=this.altAudio,n=!!s.url,u=s.id;if(!n){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var c=this.fragCurrent;c!=null&&c.loader&&(this.log("Switching to main audio track, cancel main fragment load"),c.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var D=this.hls;l&&D.trigger(F.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),D.trigger(F.Events.AUDIO_TRACK_SWITCHED,{id:u})}},o.onAudioTrackSwitched=function(e,s){var l=s.id,n=!!this.hls.audioTracks[l].url;if(n){var u=this.videoBuffer;u&&this.mediaBuffer!==u&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=u)}this.altAudio=n,this.tick()},o.onBufferCreated=function(e,s){var l=s.tracks,n,u,c=!1;for(var D in l){var L=l[D];if(L.id==="main"){if(u=D,n=L,D==="video"){var P=l[D];P&&(this.videoBuffer=P.buffer)}}else c=!0}c&&n?(this.log("Alternate track found, use "+u+".buffered to schedule main fragment loading"),this.mediaBuffer=n.buffer):this.mediaBuffer=this.media},o.onFragBuffered=function(e,s){var l=s.frag,n=s.part;if(!(l&&l.type!==O.PlaylistLevelType.MAIN)){if(this.fragContextChanged(l)){this.warn("Fragment "+l.sn+(n?" p: "+n.index:"")+" of level "+l.level+" finished buffering, but was aborted. state: "+this.state),this.state===I.State.PARSED&&(this.state=I.State.IDLE);return}var u=n?n.stats:l.stats;this.fragLastKbps=Math.round(8*u.total/(u.buffering.end-u.loading.first)),l.sn!=="initSegment"&&(this.fragPrevious=l),this.fragBufferedComplete(l,n)}},o.onError=function(e,s){switch(s.details){case m.ErrorDetails.FRAG_LOAD_ERROR:case m.ErrorDetails.FRAG_LOAD_TIMEOUT:case m.ErrorDetails.KEY_LOAD_ERROR:case m.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(O.PlaylistLevelType.MAIN,s);break;case m.ErrorDetails.LEVEL_LOAD_ERROR:case m.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==I.State.ERROR&&(s.fatal?(this.warn(""+s.details),this.state=I.State.ERROR):!s.levelRetry&&this.state===I.State.WAITING_LEVEL&&(this.state=I.State.IDLE));break;case m.ErrorDetails.BUFFER_FULL_ERROR:if(s.parent==="main"&&(this.state===I.State.PARSING||this.state===I.State.PARSED)){var l=!0,n=this.getFwdBufferInfo(this.media,O.PlaylistLevelType.MAIN);n&&n.len>.5&&(l=!this.reduceMaxBufferLength(n.len)),l&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break;default:break}},o.checkBuffer=function(){var e=this.media,s=this.gapController;if(!(!e||!s||!e.readyState)){if(this.loadedmetadata||!C.BufferHelper.getBuffered(e).length){var l=this.state!==I.State.IDLE?this.fragCurrent:null;s.poll(this.lastCurrentTime,l)}this.lastCurrentTime=e.currentTime}},o.onFragLoadEmergencyAborted=function(){this.state=I.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},o.onBufferFlushed=function(e,s){var l=s.type;if(l!==p.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var n=(l===p.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(n,l,O.PlaylistLevelType.MAIN)}},o.onLevelsUpdated=function(e,s){this.levels=s.levels},o.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},o.seekToStartPos=function(){var e=this.media;if(!!e){var s=e.currentTime,l=this.startPosition;if(l>=0&&s<l){if(e.seeking){this.log("could not seek to "+l+", already seeking at "+s);return}var n=C.BufferHelper.getBuffered(e),u=n.length?n.start(0):0,c=u-l;c>0&&(c<this.config.maxBufferHole||c<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+c+" to match buffer start"),l+=c,this.startPosition=l),this.log("seek to target start position "+l+" from current time "+s),e.currentTime=l}}},o._getAudioCodec=function(e){var s=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&s&&(this.log("Swapping audio codec"),s.indexOf("mp4a.40.5")!==-1?s="mp4a.40.2":s="mp4a.40.5"),s},o._loadBitrateTestFrag=function(e){var s=this;e.bitrateTest=!0,this._doFragLoad(e).then(function(l){var n=s.hls;if(!(!l||n.nextLoadLevel||s.fragContextChanged(e))){s.fragLoadError=0,s.state=I.State.IDLE,s.startFragRequested=!1,s.bitrateTest=!1;var u=e.stats;u.parsing.start=u.parsing.end=u.buffering.start=u.buffering.end=self.performance.now(),n.trigger(F.Events.FRAG_LOADED,l),e.bitrateTest=!1}})},o._handleTransmuxComplete=function(e){var s,l="main",n=this.hls,u=e.remuxResult,c=e.chunkMeta,D=this.getCurrentContext(c);if(!D){this.warn("The loading context changed while buffering fragment "+c.sn+" of level "+c.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(c.level);return}var L=D.frag,P=D.part,B=D.level,x=u.video,U=u.text,N=u.id3,k=u.initSegment,K=B.details,w=this.altAudio?void 0:u.audio;if(!this.fragContextChanged(L)){if(this.state=I.State.PARSING,k){k.tracks&&(this._bufferInitSegment(B,k.tracks,L,c),n.trigger(F.Events.FRAG_PARSING_INIT_SEGMENT,{frag:L,id:l,tracks:k.tracks}));var W=k.initPTS,H=k.timescale;Object(M.isFiniteNumber)(W)&&(this.initPTS[L.cc]=W,n.trigger(F.Events.INIT_PTS_FOUND,{frag:L,id:l,initPTS:W,timescale:H}))}if(x&&u.independent!==!1){if(K){var j=x.startPTS,Y=x.endPTS,X=x.startDTS,z=x.endDTS;if(P)P.elementaryStreams[x.type]={startPTS:j,endPTS:Y,startDTS:X,endDTS:z};else if(x.firstKeyFrame&&x.independent&&(this.couldBacktrack=!0),x.dropped&&x.independent){var _=this.getMainFwdBufferInfo(),Q=(_?_.end:this.getLoadPosition())+this.config.maxBufferHole,$=x.firstKeyFramePTS?x.firstKeyFramePTS:j;if(Q<$-this.config.maxBufferHole){this.backtrack(L);return}L.setElementaryStreamInfo(x.type,L.start,Y,L.start,z,!0)}L.setElementaryStreamInfo(x.type,j,Y,X,z),this.backtrackFragment&&(this.backtrackFragment=L),this.bufferFragmentData(x,L,P,c)}}else if(u.independent===!1){this.backtrack(L);return}if(w){var V=w.startPTS,J=w.endPTS,Z=w.startDTS,q=w.endDTS;P&&(P.elementaryStreams[p.ElementaryStreamTypes.AUDIO]={startPTS:V,endPTS:J,startDTS:Z,endDTS:q}),L.setElementaryStreamInfo(p.ElementaryStreamTypes.AUDIO,V,J,Z,q),this.bufferFragmentData(w,L,P,c)}if(K&&N!==null&&N!==void 0&&(s=N.samples)!==null&&s!==void 0&&s.length){var ot={id:l,frag:L,details:K,samples:N.samples};n.trigger(F.Events.FRAG_PARSING_METADATA,ot)}if(K&&U){var tt={id:l,frag:L,details:K,samples:U.samples};n.trigger(F.Events.FRAG_PARSING_USERDATA,tt)}}},o._bufferInitSegment=function(e,s,l,n){var u=this;if(this.state===I.State.PARSING){this.audioOnly=!!s.audio&&!s.video,this.altAudio&&!this.audioOnly&&delete s.audio;var c=s.audio,D=s.video,L=s.audiovideo;if(c){var P=e.audioCodec,B=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(P&&(P.indexOf("mp4a.40.5")!==-1?P="mp4a.40.2":P="mp4a.40.5"),c.metadata.channelCount!==1&&B.indexOf("firefox")===-1&&(P="mp4a.40.5")),B.indexOf("android")!==-1&&c.container!=="audio/mpeg"&&(P="mp4a.40.2",this.log("Android: force audio codec to "+P)),e.audioCodec&&e.audioCodec!==P&&this.log('Swapping manifest audio codec "'+e.audioCodec+'" for "'+P+'"'),c.levelCodec=P,c.id="main",this.log("Init audio buffer, container:"+c.container+", codecs[selected/level/parsed]=["+(P||"")+"/"+(e.audioCodec||"")+"/"+c.codec+"]")}D&&(D.levelCodec=e.videoCodec,D.id="main",this.log("Init video buffer, container:"+D.container+", codecs[level/parsed]=["+(e.videoCodec||"")+"/"+D.codec+"]")),L&&this.log("Init audiovideo buffer, container:"+L.container+", codecs[level/parsed]=["+(e.attrs.CODECS||"")+"/"+L.codec+"]"),this.hls.trigger(F.Events.BUFFER_CODECS,s),Object.keys(s).forEach(function(x){var U=s[x],N=U.initSegment;N!=null&&N.byteLength&&u.hls.trigger(F.Events.BUFFER_APPENDING,{type:x,data:N,frag:l,part:null,chunkMeta:n,parent:l.type})}),this.tick()}},o.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,O.PlaylistLevelType.MAIN)},o.backtrack=function(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=I.State.IDLE},o.checkFragmentChanged=function(){var e=this.media,s=null;if(e&&e.readyState>1&&e.seeking===!1){var l=e.currentTime;if(C.BufferHelper.isBuffered(e,l)?s=this.getAppendedFrag(l):C.BufferHelper.isBuffered(e,l+.1)&&(s=this.getAppendedFrag(l+.1)),s){this.backtrackFragment=null;var n=this.fragPlaying,u=s.level;(!n||s.sn!==n.sn||n.level!==u||s.urlId!==n.urlId)&&(this.hls.trigger(F.Events.FRAG_CHANGED,{frag:s}),(!n||n.level!==u)&&this.hls.trigger(F.Events.LEVEL_SWITCHED,{level:u}),this.fragPlaying=s)}}},f(r,[{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"currentFrag",get:function(){var e=this.media;return e?this.fragPlaying||this.getAppendedFrag(e.currentTime):null}},{key:"currentProgramDateTime",get:function(){var e=this.media;if(e){var s=e.currentTime,l=this.currentFrag;if(l&&Object(M.isFiniteNumber)(s)&&Object(M.isFiniteNumber)(l.programDateTime)){var n=l.programDateTime+(s-l.start)*1e3;return new Date(n)}}return null}},{key:"currentLevel",get:function(){var e=this.currentFrag;return e?e.level:-1}},{key:"nextBufferedFrag",get:function(){var e=this.currentFrag;return e?this.followingBufferedFrag(e):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),r}(I.default)},"./src/controller/subtitle-stream-controller.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"SubtitleStreamController",function(){return t});var M=y("./src/events.ts"),I=y("./src/utils/buffer-helper.ts"),A=y("./src/controller/fragment-finders.ts"),F=y("./src/utils/discontinuities.ts"),C=y("./src/controller/level-helper.ts"),R=y("./src/controller/fragment-tracker.ts"),O=y("./src/controller/base-stream-controller.ts"),p=y("./src/types/loader.ts"),T=y("./src/types/level.ts");function S(h,v){for(var i=0;i<v.length;i++){var r=v[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(h,r.key,r)}}function E(h,v,i){return v&&S(h.prototype,v),i&&S(h,i),Object.defineProperty(h,"prototype",{writable:!1}),h}function m(h,v){h.prototype=Object.create(v.prototype),h.prototype.constructor=h,g(h,v)}function g(h,v){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,o){return r.__proto__=o,r},g(h,v)}var f=500,t=function(h){m(v,h);function v(r,o){var d;return d=h.call(this,r,o,"[subtitle-stream-controller]")||this,d.levels=[],d.currentTrackId=-1,d.tracksBuffered=[],d.mainDetails=null,d._registerListeners(),d}var i=v.prototype;return i.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},i._registerListeners=function(){var o=this.hls;o.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.on(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.on(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),o.on(M.Events.LEVEL_LOADED,this.onLevelLoaded,this),o.on(M.Events.ERROR,this.onError,this),o.on(M.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),o.on(M.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),o.on(M.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),o.on(M.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),o.on(M.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},i._unregisterListeners=function(){var o=this.hls;o.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.off(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.off(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),o.off(M.Events.LEVEL_LOADED,this.onLevelLoaded,this),o.off(M.Events.ERROR,this.onError,this),o.off(M.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),o.off(M.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),o.off(M.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),o.off(M.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),o.off(M.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},i.startLoad=function(){this.stopLoad(),this.state=O.State.IDLE,this.setInterval(f),this.tick()},i.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},i.onLevelLoaded=function(o,d){this.mainDetails=d.details},i.onSubtitleFragProcessed=function(o,d){var e=d.frag,s=d.success;if(this.fragPrevious=e,this.state=O.State.IDLE,!!s){var l=this.tracksBuffered[this.currentTrackId];if(!!l){for(var n,u=e.start,c=0;c<l.length;c++)if(u>=l[c].start&&u<=l[c].end){n=l[c];break}var D=e.start+e.duration;n?n.end=D:(n={start:u,end:D},l.push(n)),this.fragmentTracker.fragBuffered(e)}}},i.onBufferFlushing=function(o,d){var e=d.startOffset,s=d.endOffset;if(e===0&&s!==Number.POSITIVE_INFINITY){var l=this.currentTrackId,n=this.levels;if(!n.length||!n[l]||!n[l].details)return;var u=n[l].details,c=u.targetduration,D=s-c;if(D<=0)return;d.endOffsetSubtitles=Math.max(0,D),this.tracksBuffered.forEach(function(L){for(var P=0;P<L.length;){if(L[P].end<=D){L.shift();continue}else if(L[P].start<D)L[P].start=D;else break;P++}}),this.fragmentTracker.removeFragmentsInRange(e,D,p.PlaylistLevelType.SUBTITLE)}},i.onError=function(o,d){var e,s=d.frag;!s||s.type!==p.PlaylistLevelType.SUBTITLE||((e=this.fragCurrent)!==null&&e!==void 0&&e.loader&&this.fragCurrent.loader.abort(),this.state=O.State.IDLE)},i.onSubtitleTracksUpdated=function(o,d){var e=this,s=d.subtitleTracks;this.tracksBuffered=[],this.levels=s.map(function(l){return new T.Level(l)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(l){e.tracksBuffered[l.id]=[]}),this.mediaBuffer=null},i.onSubtitleTrackSwitch=function(o,d){if(this.currentTrackId=d.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var e=this.levels[this.currentTrackId];e!=null&&e.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,e&&this.setInterval(f)},i.onSubtitleTrackLoaded=function(o,d){var e,s=d.details,l=d.id,n=this.currentTrackId,u=this.levels;if(!!u.length){var c=u[n];if(!(l>=u.length||l!==n||!c)){if(this.mediaBuffer=this.mediaBufferTimeRanges,s.live||(e=c.details)!==null&&e!==void 0&&e.live){var D=this.mainDetails;if(s.deltaUpdateFailed||!D)return;var L=D.fragments[0];if(!c.details)s.hasProgramDateTime&&D.hasProgramDateTime?Object(F.alignMediaPlaylistByPDT)(s,D):L&&Object(C.addSliding)(s,L.start);else{var P=this.alignPlaylists(s,c.details);P===0&&L&&Object(C.addSliding)(s,L.start)}}if(c.details=s,this.levelLastLoaded=l,this.tick(),s.live&&!this.fragCurrent&&this.media&&this.state===O.State.IDLE){var B=Object(A.findFragmentByPTS)(null,s.fragments,this.media.currentTime,0);B||(this.warn("Subtitle playlist not aligned with playback"),c.details=void 0)}}}},i._handleFragmentLoadComplete=function(o){var d=o.frag,e=o.payload,s=d.decryptdata,l=this.hls;if(!this.fragContextChanged(d)&&e&&e.byteLength>0&&s&&s.key&&s.iv&&s.method==="AES-128"){var n=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(e),s.key.buffer,s.iv.buffer).then(function(u){var c=performance.now();l.trigger(M.Events.FRAG_DECRYPTED,{frag:d,payload:u,stats:{tstart:n,tdecrypt:c}})})}},i.doTick=function(){if(!this.media){this.state=O.State.IDLE;return}if(this.state===O.State.IDLE){var o=this.currentTrackId,d=this.levels;if(!d.length||!d[o]||!d[o].details)return;var e=d[o].details,s=e.targetduration,l=this.config,n=this.media,u=I.BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],n.currentTime-s,l.maxBufferHole),c=u.end,D=u.len,L=this.getMaxBufferLength()+s;if(D>L)return;console.assert(e,"Subtitle track details are defined on idle subtitle stream controller tick");var P=e.fragments,B=P.length,x=e.edge,U,N=this.fragPrevious;if(c<x){var k=l.maxFragLookUpTolerance;U=Object(A.findFragmentByPTS)(N,P,Math.max(P[0].start,c),k),!U&&N&&N.start<P[0].start&&(U=P[0])}else U=P[B-1];if(U=this.mapToInitFragWhenRequired(U),!U||this.fragmentTracker.getState(U)!==R.FragmentState.NOT_LOADED)return;U.encrypted?this.loadKey(U,e):this.loadFragment(U,e,c)}},i.loadFragment=function(o,d,e){this.fragCurrent=o,o.sn==="initSegment"?this._loadInitSegment(o):h.prototype.loadFragment.call(this,o,d,e)},E(v,[{key:"mediaBufferTimeRanges",get:function(){return new a(this.tracksBuffered[this.currentTrackId]||[])}}]),v}(O.default),a=function(v){this.buffered=void 0;var i=function(o,d,e){if(d=d>>>0,d>e-1)throw new DOMException("Failed to execute '"+o+"' on 'TimeRanges': The index provided ("+d+") is greater than the maximum bound ("+e+")");return v[d][o]};this.buffered={get length(){return v.length},end:function(o){return i("end",o,v.length)},start:function(o){return i("start",o,v.length)}}}},"./src/controller/subtitle-track-controller.ts":function(G,b,y){"use strict";y.r(b);var M=y("./src/events.ts"),I=y("./src/utils/texttrack-utils.ts"),A=y("./src/controller/base-playlist-controller.ts"),F=y("./src/types/loader.ts");function C(E,m){for(var g=0;g<m.length;g++){var f=m[g];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(E,f.key,f)}}function R(E,m,g){return m&&C(E.prototype,m),g&&C(E,g),Object.defineProperty(E,"prototype",{writable:!1}),E}function O(E,m){E.prototype=Object.create(m.prototype),E.prototype.constructor=E,p(E,m)}function p(E,m){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(f,t){return f.__proto__=t,f},p(E,m)}var T=function(E){O(m,E);function m(f){var t;return t=E.call(this,f,"[subtitle-track-controller]")||this,t.media=null,t.tracks=[],t.groupId=null,t.tracksInGroup=[],t.trackId=-1,t.selectDefaultTrack=!0,t.queuedDefaultTrack=-1,t.trackChangeListener=function(){return t.onTextTracksChanged()},t.asyncPollTrackChange=function(){return t.pollTrackChange(0)},t.useTextTrackPolling=!1,t.subtitlePollingInterval=-1,t._subtitleDisplay=!0,t.registerListeners(),t}var g=m.prototype;return g.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,E.prototype.destroy.call(this)},g.registerListeners=function(){var t=this.hls;t.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(M.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(M.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(M.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(M.Events.ERROR,this.onError,this)},g.unregisterListeners=function(){var t=this.hls;t.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(M.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(M.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(M.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(M.Events.ERROR,this.onError,this)},g.onMediaAttached=function(t,a){this.media=a.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},g.pollTrackChange=function(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,t)},g.onMediaDetaching=function(){if(!!this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var t=S(this.media.textTracks);t.forEach(function(a){Object(I.clearCurrentCues)(a)}),this.subtitleTrack=-1,this.media=null}},g.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},g.onManifestParsed=function(t,a){this.tracks=a.subtitleTracks},g.onSubtitleTrackLoaded=function(t,a){var h=a.id,v=a.details,i=this.trackId,r=this.tracksInGroup[i];if(!r){this.warn("Invalid subtitle track id "+h);return}var o=r.details;r.details=a.details,this.log("subtitle track "+h+" loaded ["+v.startSN+"-"+v.endSN+"]"),h===this.trackId&&(this.retryCount=0,this.playlistLoaded(h,a,o))},g.onLevelLoading=function(t,a){this.switchLevel(a.level)},g.onLevelSwitching=function(t,a){this.switchLevel(a.level)},g.switchLevel=function(t){var a=this.hls.levels[t];if(!!(a!=null&&a.textGroupIds)){var h=a.textGroupIds[a.urlId];if(this.groupId!==h){var v=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,i=this.tracks.filter(function(d){return!h||d.groupId===h});this.tracksInGroup=i;var r=this.findTrackId(v?.name)||this.findTrackId();this.groupId=h;var o={subtitleTracks:i};this.log("Updating subtitle tracks, "+i.length+' track(s) found in "'+h+'" group-id'),this.hls.trigger(M.Events.SUBTITLE_TRACKS_UPDATED,o),r!==-1&&this.setSubtitleTrack(r,v)}}},g.findTrackId=function(t){for(var a=this.tracksInGroup,h=0;h<a.length;h++){var v=a[h];if((!this.selectDefaultTrack||v.default)&&(!t||t===v.name))return v.id}return-1},g.onError=function(t,a){E.prototype.onError.call(this,t,a),!(a.fatal||!a.context)&&a.context.type===F.PlaylistContextType.SUBTITLE_TRACK&&a.context.id===this.trackId&&a.context.groupId===this.groupId&&this.retryLoadingOrFail(a)},g.loadPlaylist=function(t){var a=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(a)){var h=a.id,v=a.groupId,i=a.url;if(t)try{i=t.addDirectives(i)}catch(r){this.warn("Could not construct new URL with HLS Delivery Directives: "+r)}this.log("Loading subtitle playlist for id "+h),this.hls.trigger(M.Events.SUBTITLE_TRACK_LOADING,{url:i,id:h,groupId:v,deliveryDirectives:t||null})}},g.toggleTrackModes=function(t){var a=this,h=this.media,v=this.trackId;if(!!h){var i=S(h.textTracks),r=i.filter(function(e){return e.groupId===a.groupId});if(t===-1)[].slice.call(i).forEach(function(e){e.mode="disabled"});else{var o=r[v];o&&(o.mode="disabled")}var d=r[t];d&&(d.mode=this.subtitleDisplay?"showing":"hidden")}},g.setSubtitleTrack=function(t,a){var h,v=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=t;return}if(this.trackId!==t&&this.toggleTrackModes(t),!(this.trackId===t&&(t===-1||(h=v[t])!==null&&h!==void 0&&h.details)||t<-1||t>=v.length)){this.clearTimer();var i=v[t];if(this.log("Switching to subtitle track "+t),this.trackId=t,i){var r=i.id,o=i.groupId,d=o===void 0?"":o,e=i.name,s=i.type,l=i.url;this.hls.trigger(M.Events.SUBTITLE_TRACK_SWITCH,{id:r,groupId:d,name:e,type:s,url:l});var n=this.switchParams(i.url,a?.details);this.loadPlaylist(n)}else this.hls.trigger(M.Events.SUBTITLE_TRACK_SWITCH,{id:t})}},g.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var t=-1,a=S(this.media.textTracks),h=0;h<a.length;h++)if(a[h].mode==="hidden")t=h;else if(a[h].mode==="showing"){t=h;break}this.subtitleTrack!==t&&(this.subtitleTrack=t)}},R(m,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(t){this._subtitleDisplay=t,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1;var a=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(t,a)}}]),m}(A.default);function S(E){for(var m=[],g=0;g<E.length;g++){var f=E[g];f.kind==="subtitles"&&f.label&&m.push(E[g])}return m}b.default=T},"./src/controller/timeline-controller.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"TimelineController",function(){return E});var M=y("./src/polyfills/number.ts"),I=y("./src/events.ts"),A=y("./src/utils/cea-608-parser.ts"),F=y("./src/utils/output-filter.ts"),C=y("./src/utils/webvtt-parser.ts"),R=y("./src/utils/texttrack-utils.ts"),O=y("./src/utils/imsc1-ttml-parser.ts"),p=y("./src/utils/mp4-tools.ts"),T=y("./src/types/loader.ts"),S=y("./src/utils/logger.ts"),E=function(){function t(h){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=f(),this.captionsProperties=void 0,this.hls=h,this.config=h.config,this.Cues=h.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var v=new F.default(this,"textTrack1"),i=new F.default(this,"textTrack2"),r=new F.default(this,"textTrack3"),o=new F.default(this,"textTrack4");this.cea608Parser1=new A.default(1,v,i),this.cea608Parser2=new A.default(3,r,o)}h.on(I.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),h.on(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this),h.on(I.Events.MANIFEST_LOADING,this.onManifestLoading,this),h.on(I.Events.MANIFEST_LOADED,this.onManifestLoaded,this),h.on(I.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),h.on(I.Events.FRAG_LOADING,this.onFragLoading,this),h.on(I.Events.FRAG_LOADED,this.onFragLoaded,this),h.on(I.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),h.on(I.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),h.on(I.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),h.on(I.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),h.on(I.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var a=t.prototype;return a.destroy=function(){var v=this.hls;v.off(I.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),v.off(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this),v.off(I.Events.MANIFEST_LOADING,this.onManifestLoading,this),v.off(I.Events.MANIFEST_LOADED,this.onManifestLoaded,this),v.off(I.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),v.off(I.Events.FRAG_LOADING,this.onFragLoading,this),v.off(I.Events.FRAG_LOADED,this.onFragLoaded,this),v.off(I.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),v.off(I.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),v.off(I.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),v.off(I.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),v.off(I.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},a.addCues=function(v,i,r,o,d){for(var e=!1,s=d.length;s--;){var l=d[s],n=g(l[0],l[1],i,r);if(n>=0&&(l[0]=Math.min(l[0],i),l[1]=Math.max(l[1],r),e=!0,n/(r-i)>.5))return}if(e||d.push([i,r]),this.config.renderTextTracksNatively){var u=this.captionsTracks[v];this.Cues.newCue(u,i,r,o)}else{var c=this.Cues.newCue(null,i,r,o);this.hls.trigger(I.Events.CUES_PARSED,{type:"captions",cues:c,track:v})}},a.onInitPtsFound=function(v,i){var r=this,o=i.frag,d=i.id,e=i.initPTS,s=i.timescale,l=this.unparsedVttFrags;d==="main"&&(this.initPTS[o.cc]=e,this.timescale[o.cc]=s),l.length&&(this.unparsedVttFrags=[],l.forEach(function(n){r.onFragLoaded(I.Events.FRAG_LOADED,n)}))},a.getExistingTrack=function(v){var i=this.media;if(i)for(var r=0;r<i.textTracks.length;r++){var o=i.textTracks[r];if(o[v])return o}return null},a.createCaptionsTrack=function(v){this.config.renderTextTracksNatively?this.createNativeTrack(v):this.createNonNativeTrack(v)},a.createNativeTrack=function(v){if(!this.captionsTracks[v]){var i=this.captionsProperties,r=this.captionsTracks,o=this.media,d=i[v],e=d.label,s=d.languageCode,l=this.getExistingTrack(v);if(l)r[v]=l,Object(R.clearCurrentCues)(r[v]),Object(R.sendAddTrackEvent)(r[v],o);else{var n=this.createTextTrack("captions",e,s);n&&(n[v]=!0,r[v]=n)}}},a.createNonNativeTrack=function(v){if(!this.nonNativeCaptionsTracks[v]){var i=this.captionsProperties[v];if(!!i){var r=i.label,o={_id:v,label:r,kind:"captions",default:i.media?!!i.media.default:!1,closedCaptions:i.media};this.nonNativeCaptionsTracks[v]=o,this.hls.trigger(I.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[o]})}}},a.createTextTrack=function(v,i,r){var o=this.media;if(!!o)return o.addTextTrack(v,i,r)},a.onMediaAttaching=function(v,i){this.media=i.media,this._cleanTracks()},a.onMediaDetaching=function(){var v=this.captionsTracks;Object.keys(v).forEach(function(i){Object(R.clearCurrentCues)(v[i]),delete v[i]}),this.nonNativeCaptionsTracks={}},a.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=f(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},a._cleanTracks=function(){var v=this.media;if(!!v){var i=v.textTracks;if(i)for(var r=0;r<i.length;r++)Object(R.clearCurrentCues)(i[r])}},a.onSubtitleTracksUpdated=function(v,i){var r=this;this.textTracks=[];var o=i.subtitleTracks||[],d=o.some(function(n){return n.textCodec===O.IMSC1_CODEC});if(this.config.enableWebVTT||d&&this.config.enableIMSC1){var e=this.tracks&&o&&this.tracks.length===o.length;if(this.tracks=o||[],this.config.renderTextTracksNatively){var s=this.media?this.media.textTracks:[];this.tracks.forEach(function(n,u){var c;if(u<s.length){for(var D=null,L=0;L<s.length;L++)if(m(s[L],n)){D=s[L];break}D&&(c=D)}if(c)Object(R.clearCurrentCues)(c);else{var P=r._captionsOrSubtitlesFromCharacteristics(n);c=r.createTextTrack(P,n.name,n.lang),c&&(c.mode="disabled")}c&&(c.groupId=n.groupId,r.textTracks.push(c))})}else if(!e&&this.tracks&&this.tracks.length){var l=this.tracks.map(function(n){return{label:n.name,kind:n.type.toLowerCase(),default:n.default,subtitleTrack:n}});this.hls.trigger(I.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:l})}}},a._captionsOrSubtitlesFromCharacteristics=function(v){var i;if((i=v.attrs)!==null&&i!==void 0&&i.CHARACTERISTICS){var r=/transcribes-spoken-dialog/gi.test(v.attrs.CHARACTERISTICS),o=/describes-music-and-sound/gi.test(v.attrs.CHARACTERISTICS);if(r&&o)return"captions"}return"subtitles"},a.onManifestLoaded=function(v,i){var r=this;this.config.enableCEA708Captions&&i.captions&&i.captions.forEach(function(o){var d=/(?:CC|SERVICE)([1-4])/.exec(o.instreamId);if(!!d){var e="textTrack"+d[1],s=r.captionsProperties[e];!s||(s.label=o.name,o.lang&&(s.languageCode=o.lang),s.media=o)}})},a.closedCaptionsForLevel=function(v){var i=this.hls.levels[v.level];return i?.attrs["CLOSED-CAPTIONS"]},a.onFragLoading=function(v,i){var r=this.cea608Parser1,o=this.cea608Parser2,d=this.lastSn,e=this.lastPartIndex;if(!(!this.enabled||!(r&&o))&&i.frag.type===T.PlaylistLevelType.MAIN){var s,l,n=i.frag.sn,u=(s=i==null||(l=i.part)===null||l===void 0?void 0:l.index)!=null?s:-1;n===d+1||n===d&&u===e+1||(r.reset(),o.reset()),this.lastSn=n,this.lastPartIndex=u}},a.onFragLoaded=function(v,i){var r=i.frag,o=i.payload,d=this.initPTS,e=this.unparsedVttFrags;if(r.type===T.PlaylistLevelType.SUBTITLE)if(o.byteLength){if(!Object(M.isFiniteNumber)(d[r.cc])){e.push(i),d.length&&this.hls.trigger(I.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Missing initial subtitle PTS")});return}var s=r.decryptdata,l="stats"in i;if(s==null||s.key==null||s.method!=="AES-128"||l){var n=this.tracks[r.level],u=this.vttCCs;u[r.cc]||(u[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),n&&n.textCodec===O.IMSC1_CODEC?this._parseIMSC1(r,o):this._parseVTTs(r,o,u)}}else this.hls.trigger(I.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})},a._parseIMSC1=function(v,i){var r=this,o=this.hls;Object(O.parseIMSC1)(i,this.initPTS[v.cc],this.timescale[v.cc],function(d){r._appendCues(d,v.level),o.trigger(I.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:v})},function(d){S.logger.log("Failed to parse IMSC1: "+d),o.trigger(I.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:v,error:d})})},a._parseVTTs=function(v,i,r){var o,d=this,e=this.hls,s=(o=v.initSegment)!==null&&o!==void 0&&o.data?Object(p.appendUint8Array)(v.initSegment.data,new Uint8Array(i)):i;Object(C.parseWebVTT)(s,this.initPTS[v.cc],this.timescale[v.cc],r,v.cc,v.start,function(l){d._appendCues(l,v.level),e.trigger(I.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:v})},function(l){d._fallbackToIMSC1(v,i),S.logger.log("Failed to parse VTT cue: "+l),e.trigger(I.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:v,error:l})})},a._fallbackToIMSC1=function(v,i){var r=this,o=this.tracks[v.level];o.textCodec||Object(O.parseIMSC1)(i,this.initPTS[v.cc],this.timescale[v.cc],function(){o.textCodec=O.IMSC1_CODEC,r._parseIMSC1(v,i)},function(){o.textCodec="wvtt"})},a._appendCues=function(v,i){var r=this.hls;if(this.config.renderTextTracksNatively){var o=this.textTracks[i];if(!o||o.mode==="disabled")return;v.forEach(function(s){return Object(R.addCueToTrack)(o,s)})}else{var d=this.tracks[i];if(!d)return;var e=d.default?"default":"subtitles"+i;r.trigger(I.Events.CUES_PARSED,{type:"subtitles",cues:v,track:e})}},a.onFragDecrypted=function(v,i){var r=i.frag;if(r.type===T.PlaylistLevelType.SUBTITLE){if(!Object(M.isFiniteNumber)(this.initPTS[r.cc])){this.unparsedVttFrags.push(i);return}this.onFragLoaded(I.Events.FRAG_LOADED,i)}},a.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},a.onFragParsingUserdata=function(v,i){var r=this.cea608Parser1,o=this.cea608Parser2;if(!(!this.enabled||!(r&&o))){var d=i.frag,e=i.samples;if(!(d.type===T.PlaylistLevelType.MAIN&&this.closedCaptionsForLevel(d)==="NONE"))for(var s=0;s<e.length;s++){var l=e[s].bytes;if(l){var n=this.extractCea608Data(l);r.addData(e[s].pts,n[0]),o.addData(e[s].pts,n[1])}}}},a.onBufferFlushing=function(v,i){var r=i.startOffset,o=i.endOffset,d=i.endOffsetSubtitles,e=i.type,s=this.media;if(!(!s||s.currentTime<o)){if(!e||e==="video"){var l=this.captionsTracks;Object.keys(l).forEach(function(u){return Object(R.removeCuesInRange)(l[u],r,o)})}if(this.config.renderTextTracksNatively&&r===0&&d!==void 0){var n=this.textTracks;Object.keys(n).forEach(function(u){return Object(R.removeCuesInRange)(n[u],r,d)})}}},a.extractCea608Data=function(v){for(var i=[[],[]],r=v[0]&31,o=2,d=0;d<r;d++){var e=v[o++],s=127&v[o++],l=127&v[o++];if(!(s===0&&l===0)){var n=(4&e)!==0;if(n){var u=3&e;(u===0||u===1)&&(i[u].push(s),i[u].push(l))}}}return i},t}();function m(t,a){return t&&t.label===a.name&&!(t.textTrack1||t.textTrack2)}function g(t,a,h,v){return Math.min(a,v)-Math.max(t,h)}function f(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}},"./src/crypt/aes-crypto.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"default",function(){return M});var M=function(){function I(F,C){this.subtle=void 0,this.aesIV=void 0,this.subtle=F,this.aesIV=C}var A=I.prototype;return A.decrypt=function(C,R){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},R,C)},I}()},"./src/crypt/aes-decryptor.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"removePadding",function(){return I}),y.d(b,"default",function(){return A});var M=y("./src/utils/typed-array.ts");function I(F){var C=F.byteLength,R=C&&new DataView(F.buffer).getUint8(C-1);return R?Object(M.sliceUint8)(F,0,C-R):F}var A=function(){function F(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var C=F.prototype;return C.uint8ArrayToUint32Array_=function(O){for(var p=new DataView(O),T=new Uint32Array(4),S=0;S<4;S++)T[S]=p.getUint32(S*4);return T},C.initTable=function(){var O=this.sBox,p=this.invSBox,T=this.subMix,S=T[0],E=T[1],m=T[2],g=T[3],f=this.invSubMix,t=f[0],a=f[1],h=f[2],v=f[3],i=new Uint32Array(256),r=0,o=0,d=0;for(d=0;d<256;d++)d<128?i[d]=d<<1:i[d]=d<<1^283;for(d=0;d<256;d++){var e=o^o<<1^o<<2^o<<3^o<<4;e=e>>>8^e&255^99,O[r]=e,p[e]=r;var s=i[r],l=i[s],n=i[l],u=i[e]*257^e*16843008;S[r]=u<<24|u>>>8,E[r]=u<<16|u>>>16,m[r]=u<<8|u>>>24,g[r]=u,u=n*16843009^l*65537^s*257^r*16843008,t[e]=u<<24|u>>>8,a[e]=u<<16|u>>>16,h[e]=u<<8|u>>>24,v[e]=u,r?(r=s^i[i[i[n^s]]],o^=i[i[o]]):r=o=1}},C.expandKey=function(O){for(var p=this.uint8ArrayToUint32Array_(O),T=!0,S=0;S<p.length&&T;)T=p[S]===this.key[S],S++;if(!T){this.key=p;var E=this.keySize=p.length;if(E!==4&&E!==6&&E!==8)throw new Error("Invalid aes key size="+E);var m=this.ksRows=(E+6+1)*4,g,f,t=this.keySchedule=new Uint32Array(m),a=this.invKeySchedule=new Uint32Array(m),h=this.sBox,v=this.rcon,i=this.invSubMix,r=i[0],o=i[1],d=i[2],e=i[3],s,l;for(g=0;g<m;g++){if(g<E){s=t[g]=p[g];continue}l=s,g%E===0?(l=l<<8|l>>>24,l=h[l>>>24]<<24|h[l>>>16&255]<<16|h[l>>>8&255]<<8|h[l&255],l^=v[g/E|0]<<24):E>6&&g%E===4&&(l=h[l>>>24]<<24|h[l>>>16&255]<<16|h[l>>>8&255]<<8|h[l&255]),t[g]=s=(t[g-E]^l)>>>0}for(f=0;f<m;f++)g=m-f,f&3?l=t[g]:l=t[g-4],f<4||g<=4?a[f]=l:a[f]=r[h[l>>>24]]^o[h[l>>>16&255]]^d[h[l>>>8&255]]^e[h[l&255]],a[f]=a[f]>>>0}},C.networkToHostOrderSwap=function(O){return O<<24|(O&65280)<<8|(O&16711680)>>8|O>>>24},C.decrypt=function(O,p,T){for(var S=this.keySize+6,E=this.invKeySchedule,m=this.invSBox,g=this.invSubMix,f=g[0],t=g[1],a=g[2],h=g[3],v=this.uint8ArrayToUint32Array_(T),i=v[0],r=v[1],o=v[2],d=v[3],e=new Int32Array(O),s=new Int32Array(e.length),l,n,u,c,D,L,P,B,x,U,N,k,K,w,W=this.networkToHostOrderSwap;p<e.length;){for(x=W(e[p]),U=W(e[p+1]),N=W(e[p+2]),k=W(e[p+3]),D=x^E[0],L=k^E[1],P=N^E[2],B=U^E[3],K=4,w=1;w<S;w++)l=f[D>>>24]^t[L>>16&255]^a[P>>8&255]^h[B&255]^E[K],n=f[L>>>24]^t[P>>16&255]^a[B>>8&255]^h[D&255]^E[K+1],u=f[P>>>24]^t[B>>16&255]^a[D>>8&255]^h[L&255]^E[K+2],c=f[B>>>24]^t[D>>16&255]^a[L>>8&255]^h[P&255]^E[K+3],D=l,L=n,P=u,B=c,K=K+4;l=m[D>>>24]<<24^m[L>>16&255]<<16^m[P>>8&255]<<8^m[B&255]^E[K],n=m[L>>>24]<<24^m[P>>16&255]<<16^m[B>>8&255]<<8^m[D&255]^E[K+1],u=m[P>>>24]<<24^m[B>>16&255]<<16^m[D>>8&255]<<8^m[L&255]^E[K+2],c=m[B>>>24]<<24^m[D>>16&255]<<16^m[L>>8&255]<<8^m[P&255]^E[K+3],s[p]=W(l^i),s[p+1]=W(c^r),s[p+2]=W(u^o),s[p+3]=W(n^d),i=x,r=U,o=N,d=k,p=p+4}return s.buffer},F}()},"./src/crypt/decrypter.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"default",function(){return p});var M=y("./src/crypt/aes-crypto.ts"),I=y("./src/crypt/fast-aes-key.ts"),A=y("./src/crypt/aes-decryptor.ts"),F=y("./src/utils/logger.ts"),C=y("./src/utils/mp4-tools.ts"),R=y("./src/utils/typed-array.ts"),O=16,p=function(){function T(E,m,g){var f=g===void 0?{}:g,t=f.removePKCS7Padding,a=t===void 0?!0:t;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=E,this.config=m,this.removePKCS7Padding=a,a)try{var h=self.crypto;h&&(this.subtle=h.subtle||h.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var S=T.prototype;return S.destroy=function(){this.observer=null},S.isSync=function(){return this.config.enableSoftwareAES},S.flush=function(){var m=this.currentResult;if(!m){this.reset();return}var g=new Uint8Array(m);return this.reset(),this.removePKCS7Padding?Object(A.removePadding)(g):g},S.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},S.decrypt=function(m,g,f,t){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(m),g,f);var a=this.flush();a&&t(a.buffer)}else this.webCryptoDecrypt(new Uint8Array(m),g,f).then(t)},S.softwareDecrypt=function(m,g,f){var t=this.currentIV,a=this.currentResult,h=this.remainderData;this.logOnce("JS AES decrypt"),h&&(m=Object(C.appendUint8Array)(h,m),this.remainderData=null);var v=this.getValidChunk(m);if(!v.length)return null;t&&(f=t);var i=this.softwareDecrypter;i||(i=this.softwareDecrypter=new A.default),i.expandKey(g);var r=a;return this.currentResult=i.decrypt(v.buffer,0,f),this.currentIV=Object(R.sliceUint8)(v,-16).buffer,r||null},S.webCryptoDecrypt=function(m,g,f){var t=this,a=this.subtle;return(this.key!==g||!this.fastAesKey)&&(this.key=g,this.fastAesKey=new I.default(a,g)),this.fastAesKey.expandKey().then(function(h){if(!a)return Promise.reject(new Error("web crypto not initialized"));var v=new M.default(a,f);return v.decrypt(m.buffer,h)}).catch(function(h){return t.onWebCryptoError(h,m,g,f)})},S.onWebCryptoError=function(m,g,f,t){return F.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",m),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(g,f,t)},S.getValidChunk=function(m){var g=m,f=m.length-m.length%O;return f!==m.length&&(g=Object(R.sliceUint8)(m,0,f),this.remainderData=Object(R.sliceUint8)(m,f)),g},S.logOnce=function(m){!this.logEnabled||(F.logger.log("[decrypter.ts]: "+m),this.logEnabled=!1)},T}()},"./src/crypt/fast-aes-key.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"default",function(){return M});var M=function(){function I(F,C){this.subtle=void 0,this.key=void 0,this.subtle=F,this.key=C}var A=I.prototype;return A.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},I}()},"./src/demux/aacdemuxer.ts":function(G,b,y){"use strict";y.r(b);var M=y("./src/demux/base-audio-demuxer.ts"),I=y("./src/demux/adts.ts"),A=y("./src/utils/logger.ts"),F=y("./src/demux/id3.ts");function C(p,T){p.prototype=Object.create(T.prototype),p.prototype.constructor=p,R(p,T)}function R(p,T){return R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(E,m){return E.__proto__=m,E},R(p,T)}var O=function(p){C(T,p);function T(E,m){var g;return g=p.call(this)||this,g.observer=void 0,g.config=void 0,g.observer=E,g.config=m,g}var S=T.prototype;return S.resetInitSegment=function(m,g,f,t){p.prototype.resetInitSegment.call(this,m,g,f,t),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:g,duration:t,inputTimeScale:9e4,dropped:0}},T.probe=function(m){if(!m)return!1;for(var g=F.getID3Data(m,0)||[],f=g.length,t=m.length;f<t;f++)if(I.probe(m,f))return A.logger.log("ADTS sync word found !"),!0;return!1},S.canParse=function(m,g){return I.canParse(m,g)},S.appendFrame=function(m,g,f){I.initTrackConfig(m,this.observer,g,f,m.manifestCodec);var t=I.appendFrame(m,g,f,this.basePTS,this.frameIndex);if(t&&t.missing===0)return t},T}(M.default);b.default=O},"./src/demux/adts.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"getAudioConfig",function(){return F}),y.d(b,"isHeaderPattern",function(){return C}),y.d(b,"getHeaderLength",function(){return R}),y.d(b,"getFullFrameLength",function(){return O}),y.d(b,"canGetFrameLength",function(){return p}),y.d(b,"isHeader",function(){return T}),y.d(b,"canParse",function(){return S}),y.d(b,"probe",function(){return E}),y.d(b,"initTrackConfig",function(){return m}),y.d(b,"getFrameDuration",function(){return g}),y.d(b,"parseFrameHeader",function(){return f}),y.d(b,"appendFrame",function(){return t});var M=y("./src/utils/logger.ts"),I=y("./src/errors.ts"),A=y("./src/events.ts");function F(a,h,v,i){var r,o,d,e,s=navigator.userAgent.toLowerCase(),l=i,n=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];r=((h[v+2]&192)>>>6)+1;var u=(h[v+2]&60)>>>2;if(u>n.length-1){a.trigger(A.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+u});return}return d=(h[v+2]&1)<<2,d|=(h[v+3]&192)>>>6,M.logger.log("manifest codec:"+i+", ADTS type:"+r+", samplingIndex:"+u),/firefox/i.test(s)?u>=6?(r=5,e=new Array(4),o=u-3):(r=2,e=new Array(2),o=u):s.indexOf("android")!==-1?(r=2,e=new Array(2),o=u):(r=5,e=new Array(4),i&&(i.indexOf("mp4a.40.29")!==-1||i.indexOf("mp4a.40.5")!==-1)||!i&&u>=6?o=u-3:((i&&i.indexOf("mp4a.40.2")!==-1&&(u>=6&&d===1||/vivaldi/i.test(s))||!i&&d===1)&&(r=2,e=new Array(2)),o=u)),e[0]=r<<3,e[0]|=(u&14)>>1,e[1]|=(u&1)<<7,e[1]|=d<<3,r===5&&(e[1]|=(o&14)>>1,e[2]=(o&1)<<7,e[2]|=2<<2,e[3]=0),{config:e,samplerate:n[u],channelCount:d,codec:"mp4a.40."+r,manifestCodec:l}}function C(a,h){return a[h]===255&&(a[h+1]&246)===240}function R(a,h){return a[h+1]&1?7:9}function O(a,h){return(a[h+3]&3)<<11|a[h+4]<<3|(a[h+5]&224)>>>5}function p(a,h){return h+5<a.length}function T(a,h){return h+1<a.length&&C(a,h)}function S(a,h){return p(a,h)&&C(a,h)&&O(a,h)<=a.length-h}function E(a,h){if(T(a,h)){var v=R(a,h);if(h+v>=a.length)return!1;var i=O(a,h);if(i<=v)return!1;var r=h+i;return r===a.length||T(a,r)}return!1}function m(a,h,v,i,r){if(!a.samplerate){var o=F(h,v,i,r);if(!o)return;a.config=o.config,a.samplerate=o.samplerate,a.channelCount=o.channelCount,a.codec=o.codec,a.manifestCodec=o.manifestCodec,M.logger.log("parsed codec:"+a.codec+", rate:"+o.samplerate+", channels:"+o.channelCount)}}function g(a){return 1024*9e4/a}function f(a,h){var v=R(a,h);if(h+v<=a.length){var i=O(a,h)-v;if(i>0)return{headerLength:v,frameLength:i}}}function t(a,h,v,i,r){var o=g(a.samplerate),d=i+r*o,e=f(h,v),s;if(e){var l=e.frameLength,n=e.headerLength,u=n+l,c=Math.max(0,v+u-h.length);c?(s=new Uint8Array(u-n),s.set(h.subarray(v+n,h.length),0)):s=h.subarray(v+n,v+u);var D={unit:s,pts:d};return c||a.samples.push(D),{sample:D,length:u,missing:c}}var L=h.length-v;s=new Uint8Array(L),s.set(h.subarray(v,h.length),0);var P={unit:s,pts:d};return{sample:P,length:L,missing:-1}}},"./src/demux/base-audio-demuxer.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"initPTSFn",function(){return p});var M=y("./src/polyfills/number.ts"),I=y("./src/demux/id3.ts"),A=y("./src/types/demuxer.ts"),F=y("./src/demux/dummy-demuxed-track.ts"),C=y("./src/utils/mp4-tools.ts"),R=y("./src/utils/typed-array.ts"),O=function(){function T(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null}var S=T.prototype;return S.resetInitSegment=function(m,g,f,t){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},S.resetTimeStamp=function(m){this.initPTS=m,this.resetContiguity()},S.resetContiguity=function(){this.basePTS=null,this.frameIndex=0},S.canParse=function(m,g){return!1},S.appendFrame=function(m,g,f){},S.demux=function(m,g){this.cachedData&&(m=Object(C.appendUint8Array)(this.cachedData,m),this.cachedData=null);var f=I.getID3Data(m,0),t=f?f.length:0,a,h,v=this._audioTrack,i=this._id3Track,r=f?I.getTimeStamp(f):void 0,o=m.length;for((this.basePTS===null||this.frameIndex===0&&Object(M.isFiniteNumber)(r))&&(this.basePTS=p(r,g,this.initPTS)),f&&f.length>0&&i.samples.push({pts:this.basePTS,dts:this.basePTS,data:f,type:A.MetadataSchema.audioId3}),h=this.basePTS;t<o;){if(this.canParse(m,t)){var d=this.appendFrame(v,m,t);d?(this.frameIndex++,h=d.sample.pts,t+=d.length,a=t):t=o}else I.canParse(m,t)?(f=I.getID3Data(m,t),i.samples.push({pts:h,dts:h,data:f,type:A.MetadataSchema.audioId3}),t+=f.length,a=t):t++;if(t===o&&a!==o){var e=Object(R.sliceUint8)(m,a);this.cachedData?this.cachedData=Object(C.appendUint8Array)(this.cachedData,e):this.cachedData=e}}return{audioTrack:v,videoTrack:Object(F.dummyTrack)(),id3Track:i,textTrack:Object(F.dummyTrack)()}},S.demuxSampleAes=function(m,g,f){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},S.flush=function(m){var g=this.cachedData;return g&&(this.cachedData=null,this.demux(g,0)),{audioTrack:this._audioTrack,videoTrack:Object(F.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(F.dummyTrack)()}},S.destroy=function(){},T}(),p=function(S,E,m){return Object(M.isFiniteNumber)(S)?S*90:E*9e4+(m||0)};b.default=O},"./src/demux/chunk-cache.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"default",function(){return M});var M=function(){function A(){this.chunks=[],this.dataLength=0}var F=A.prototype;return F.push=function(R){this.chunks.push(R),this.dataLength+=R.length},F.flush=function(){var R=this.chunks,O=this.dataLength,p;if(R.length)R.length===1?p=R[0]:p=I(R,O);else return new Uint8Array(0);return this.reset(),p},F.reset=function(){this.chunks.length=0,this.dataLength=0},A}();function I(A,F){for(var C=new Uint8Array(F),R=0,O=0;O<A.length;O++){var p=A[O];C.set(p,R),R+=p.length}return C}},"./src/demux/dummy-demuxed-track.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"dummyTrack",function(){return M});function M(I,A){return I===void 0&&(I=""),A===void 0&&(A=9e4),{type:I,id:-1,pid:-1,inputTimeScale:A,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":function(G,b,y){"use strict";y.r(b);var M=y("./src/utils/logger.ts"),I=function(){function A(C){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=C,this.bytesAvailable=C.byteLength,this.word=0,this.bitsAvailable=0}var F=A.prototype;return F.loadWord=function(){var R=this.data,O=this.bytesAvailable,p=R.byteLength-O,T=new Uint8Array(4),S=Math.min(4,O);if(S===0)throw new Error("no bytes available");T.set(R.subarray(p,p+S)),this.word=new DataView(T.buffer).getUint32(0),this.bitsAvailable=S*8,this.bytesAvailable-=S},F.skipBits=function(R){var O;this.bitsAvailable>R?(this.word<<=R,this.bitsAvailable-=R):(R-=this.bitsAvailable,O=R>>3,R-=O>>3,this.bytesAvailable-=O,this.loadWord(),this.word<<=R,this.bitsAvailable-=R)},F.readBits=function(R){var O=Math.min(this.bitsAvailable,R),p=this.word>>>32-O;return R>32&&M.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=O,this.bitsAvailable>0?this.word<<=O:this.bytesAvailable>0&&this.loadWord(),O=R-O,O>0&&this.bitsAvailable?p<<O|this.readBits(O):p},F.skipLZ=function(){var R;for(R=0;R<this.bitsAvailable;++R)if((this.word&2147483648>>>R)!==0)return this.word<<=R,this.bitsAvailable-=R,R;return this.loadWord(),R+this.skipLZ()},F.skipUEG=function(){this.skipBits(1+this.skipLZ())},F.skipEG=function(){this.skipBits(1+this.skipLZ())},F.readUEG=function(){var R=this.skipLZ();return this.readBits(R+1)-1},F.readEG=function(){var R=this.readUEG();return 1&R?1+R>>>1:-1*(R>>>1)},F.readBoolean=function(){return this.readBits(1)===1},F.readUByte=function(){return this.readBits(8)},F.readUShort=function(){return this.readBits(16)},F.readUInt=function(){return this.readBits(32)},F.skipScalingList=function(R){for(var O=8,p=8,T,S=0;S<R;S++)p!==0&&(T=this.readEG(),p=(O+T+256)%256),O=p===0?O:p},F.readSPS=function(){var R=0,O=0,p=0,T=0,S,E,m,g=this.readUByte.bind(this),f=this.readBits.bind(this),t=this.readUEG.bind(this),a=this.readBoolean.bind(this),h=this.skipBits.bind(this),v=this.skipEG.bind(this),i=this.skipUEG.bind(this),r=this.skipScalingList.bind(this);g();var o=g();if(f(5),h(3),g(),i(),o===100||o===110||o===122||o===244||o===44||o===83||o===86||o===118||o===128){var d=t();if(d===3&&h(1),i(),i(),h(1),a())for(E=d!==3?8:12,m=0;m<E;m++)a()&&(m<6?r(16):r(64))}i();var e=t();if(e===0)t();else if(e===1)for(h(1),v(),v(),S=t(),m=0;m<S;m++)v();i(),h(1);var s=t(),l=t(),n=f(1);n===0&&h(1),h(1),a()&&(R=t(),O=t(),p=t(),T=t());var u=[1,1];if(a()&&a()){var c=g();switch(c){case 1:u=[1,1];break;case 2:u=[12,11];break;case 3:u=[10,11];break;case 4:u=[16,11];break;case 5:u=[40,33];break;case 6:u=[24,11];break;case 7:u=[20,11];break;case 8:u=[32,11];break;case 9:u=[80,33];break;case 10:u=[18,11];break;case 11:u=[15,11];break;case 12:u=[64,33];break;case 13:u=[160,99];break;case 14:u=[4,3];break;case 15:u=[3,2];break;case 16:u=[2,1];break;case 255:{u=[g()<<8|g(),g()<<8|g()];break}}}return{width:Math.ceil((s+1)*16-R*2-O*2),height:(2-n)*(l+1)*16-(n?2:4)*(p+T),pixelRatio:u}},F.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},A}();b.default=I},"./src/demux/id3.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"isHeader",function(){return M}),y.d(b,"isFooter",function(){return I}),y.d(b,"getID3Data",function(){return A}),y.d(b,"canParse",function(){return C}),y.d(b,"getTimeStamp",function(){return R}),y.d(b,"isTimeStampFrame",function(){return O}),y.d(b,"getID3Frames",function(){return T}),y.d(b,"decodeFrame",function(){return S}),y.d(b,"utf8ArrayToStr",function(){return t}),y.d(b,"testables",function(){return a});var M=function(r,o){return o+10<=r.length&&r[o]===73&&r[o+1]===68&&r[o+2]===51&&r[o+3]<255&&r[o+4]<255&&r[o+6]<128&&r[o+7]<128&&r[o+8]<128&&r[o+9]<128},I=function(r,o){return o+10<=r.length&&r[o]===51&&r[o+1]===68&&r[o+2]===73&&r[o+3]<255&&r[o+4]<255&&r[o+6]<128&&r[o+7]<128&&r[o+8]<128&&r[o+9]<128},A=function(r,o){for(var d=o,e=0;M(r,o);){e+=10;var s=F(r,o+6);e+=s,I(r,o+10)&&(e+=10),o+=e}if(e>0)return r.subarray(d,d+e)},F=function(r,o){var d=0;return d=(r[o]&127)<<21,d|=(r[o+1]&127)<<14,d|=(r[o+2]&127)<<7,d|=r[o+3]&127,d},C=function(r,o){return M(r,o)&&F(r,o+6)+10<=r.length-o},R=function(r){for(var o=T(r),d=0;d<o.length;d++){var e=o[d];if(O(e))return f(e)}},O=function(r){return r&&r.key==="PRIV"&&r.info==="com.apple.streaming.transportStreamTimestamp"},p=function(r){var o=String.fromCharCode(r[0],r[1],r[2],r[3]),d=F(r,4),e=10;return{type:o,size:d,data:r.subarray(e,e+d)}},T=function(r){for(var o=0,d=[];M(r,o);){var e=F(r,o+6);o+=10;for(var s=o+e;o+8<s;){var l=p(r.subarray(o)),n=S(l);n&&d.push(n),o+=l.size+10}I(r,o)&&(o+=10)}return d},S=function(r){return r.type==="PRIV"?E(r):r.type[0]==="W"?g(r):m(r)},E=function(r){if(!(r.size<2)){var o=t(r.data,!0),d=new Uint8Array(r.data.subarray(o.length+1));return{key:r.type,info:o,data:d.buffer}}},m=function(r){if(!(r.size<2)){if(r.type==="TXXX"){var o=1,d=t(r.data.subarray(o),!0);o+=d.length+1;var e=t(r.data.subarray(o));return{key:r.type,info:d,data:e}}var s=t(r.data.subarray(1));return{key:r.type,data:s}}},g=function(r){if(r.type==="WXXX"){if(r.size<2)return;var o=1,d=t(r.data.subarray(o),!0);o+=d.length+1;var e=t(r.data.subarray(o));return{key:r.type,info:d,data:e}}var s=t(r.data);return{key:r.type,data:s}},f=function(r){if(r.data.byteLength===8){var o=new Uint8Array(r.data),d=o[3]&1,e=(o[4]<<23)+(o[5]<<15)+(o[6]<<7)+o[7];return e/=45,d&&(e+=4772185884e-2),Math.round(e)}},t=function(r,o){o===void 0&&(o=!1);var d=v();if(d){var e=d.decode(r);if(o){var s=e.indexOf("\0");return s!==-1?e.substring(0,s):e}return e.replace(/\0/g,"")}for(var l=r.length,n,u,c,D="",L=0;L<l;){if(n=r[L++],n===0&&o)return D;if(n===0||n===3)continue;switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:D+=String.fromCharCode(n);break;case 12:case 13:u=r[L++],D+=String.fromCharCode((n&31)<<6|u&63);break;case 14:u=r[L++],c=r[L++],D+=String.fromCharCode((n&15)<<12|(u&63)<<6|(c&63)<<0);break;default:}}return D},a={decodeTextFrame:m},h;function v(){return!h&&typeof self.TextDecoder<"u"&&(h=new self.TextDecoder("utf-8")),h}},"./src/demux/mp3demuxer.ts":function(G,b,y){"use strict";y.r(b);var M=y("./src/demux/base-audio-demuxer.ts"),I=y("./src/demux/id3.ts"),A=y("./src/utils/logger.ts"),F=y("./src/demux/mpegaudio.ts");function C(p,T){p.prototype=Object.create(T.prototype),p.prototype.constructor=p,R(p,T)}function R(p,T){return R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(E,m){return E.__proto__=m,E},R(p,T)}var O=function(p){C(T,p);function T(){return p.apply(this,arguments)||this}var S=T.prototype;return S.resetInitSegment=function(m,g,f,t){p.prototype.resetInitSegment.call(this,m,g,f,t),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:g,duration:t,inputTimeScale:9e4,dropped:0}},T.probe=function(m){if(!m)return!1;for(var g=I.getID3Data(m,0)||[],f=g.length,t=m.length;f<t;f++)if(F.probe(m,f))return A.logger.log("MPEG Audio sync word found !"),!0;return!1},S.canParse=function(m,g){return F.canParse(m,g)},S.appendFrame=function(m,g,f){if(this.basePTS!==null)return F.appendFrame(m,g,f,this.basePTS,this.frameIndex)},T}(M.default);b.default=O},"./src/demux/mp4demuxer.ts":function(G,b,y){"use strict";y.r(b);var M=y("./src/polyfills/number.ts"),I=y("./src/types/demuxer.ts"),A=y("./src/utils/mp4-tools.ts"),F=y("./src/demux/dummy-demuxed-track.ts"),C=/\/emsg[-/]ID3/i,R=function(){function O(T,S){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=S}var p=O.prototype;return p.resetTimeStamp=function(){},p.resetInitSegment=function(S,E,m,g){var f=Object(A.parseInitSegment)(S),t=this.videoTrack=Object(F.dummyTrack)("video",1),a=this.audioTrack=Object(F.dummyTrack)("audio",1),h=this.txtTrack=Object(F.dummyTrack)("text",1);if(this.id3Track=Object(F.dummyTrack)("id3",1),this.timeOffset=0,f.video){var v=f.video,i=v.id,r=v.timescale,o=v.codec;t.id=i,t.timescale=h.timescale=r,t.codec=o}if(f.audio){var d=f.audio,e=d.id,s=d.timescale,l=d.codec;a.id=e,a.timescale=s,a.codec=l}h.id=A.RemuxerTrackIdConfig.text,t.sampleDuration=0,t.duration=a.duration=g},p.resetContiguity=function(){},O.probe=function(S){return S=S.length>16384?S.subarray(0,16384):S,Object(A.findBox)(S,["moof"]).length>0},p.demux=function(S,E){this.timeOffset=E;var m=S,g=this.videoTrack,f=this.txtTrack;if(this.config.progressive){this.remainderData&&(m=Object(A.appendUint8Array)(this.remainderData,S));var t=Object(A.segmentValidRange)(m);this.remainderData=t.remainder,g.samples=t.valid||new Uint8Array}else g.samples=m;var a=this.extractID3Track(g,E);return f.samples=Object(A.parseSamples)(E,g),{videoTrack:g,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}},p.flush=function(){var S=this.timeOffset,E=this.videoTrack,m=this.txtTrack;E.samples=this.remainderData||new Uint8Array,this.remainderData=null;var g=this.extractID3Track(E,this.timeOffset);return m.samples=Object(A.parseSamples)(S,E),{videoTrack:E,audioTrack:Object(F.dummyTrack)(),id3Track:g,textTrack:Object(F.dummyTrack)()}},p.extractID3Track=function(S,E){var m=this.id3Track;if(S.samples.length){var g=Object(A.findBox)(S.samples,["emsg"]);g&&g.forEach(function(f){var t=Object(A.parseEmsg)(f);if(C.test(t.schemeIdUri)){var a=Object(M.isFiniteNumber)(t.presentationTime)?t.presentationTime/t.timeScale:E+t.presentationTimeDelta/t.timeScale,h=t.payload;m.samples.push({data:h,len:h.byteLength,dts:a,pts:a,type:I.MetadataSchema.emsg})}})}return m},p.demuxSampleAes=function(S,E,m){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},p.destroy=function(){},O}();b.default=R},"./src/demux/mpegaudio.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"appendFrame",function(){return R}),y.d(b,"parseHeader",function(){return O}),y.d(b,"isHeaderPattern",function(){return p}),y.d(b,"isHeader",function(){return T}),y.d(b,"canParse",function(){return S}),y.d(b,"probe",function(){return E});var M=null,I=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],A=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],F=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],C=[0,1,1,4];function R(m,g,f,t,a){if(!(f+24>g.length)){var h=O(g,f);if(h&&f+h.frameLength<=g.length){var v=h.samplesPerFrame*9e4/h.sampleRate,i=t+a*v,r={unit:g.subarray(f,f+h.frameLength),pts:i,dts:i};return m.config=[],m.channelCount=h.channelCount,m.samplerate=h.sampleRate,m.samples.push(r),{sample:r,length:h.frameLength,missing:0}}}}function O(m,g){var f=m[g+1]>>3&3,t=m[g+1]>>1&3,a=m[g+2]>>4&15,h=m[g+2]>>2&3;if(f!==1&&a!==0&&a!==15&&h!==3){var v=m[g+2]>>1&1,i=m[g+3]>>6,r=f===3?3-t:t===3?3:4,o=I[r*14+a-1]*1e3,d=f===3?0:f===2?1:2,e=A[d*3+h],s=i===3?1:2,l=F[f][t],n=C[t],u=l*8*n,c=Math.floor(l*o/e+v)*n;if(M===null){var D=navigator.userAgent||"",L=D.match(/Chrome\/(\d+)/i);M=L?parseInt(L[1]):0}var P=!!M&&M<=87;return P&&t===2&&o>=224e3&&i===0&&(m[g+3]=m[g+3]|128),{sampleRate:e,channelCount:s,frameLength:c,samplesPerFrame:u}}}function p(m,g){return m[g]===255&&(m[g+1]&224)===224&&(m[g+1]&6)!==0}function T(m,g){return g+1<m.length&&p(m,g)}function S(m,g){var f=4;return p(m,g)&&f<=m.length-g}function E(m,g){if(g+1<m.length&&p(m,g)){var f=4,t=O(m,g),a=f;t!=null&&t.frameLength&&(a=t.frameLength);var h=g+a;return h===m.length||T(m,h)}return!1}},"./src/demux/sample-aes.ts":function(G,b,y){"use strict";y.r(b);var M=y("./src/crypt/decrypter.ts"),I=y("./src/demux/tsdemuxer.ts"),A=function(){function F(R,O,p){this.keyData=void 0,this.decrypter=void 0,this.keyData=p,this.decrypter=new M.default(R,O,{removePKCS7Padding:!1})}var C=F.prototype;return C.decryptBuffer=function(O,p){this.decrypter.decrypt(O,this.keyData.key.buffer,this.keyData.iv.buffer,p)},C.decryptAacSample=function(O,p,T,S){var E=O[p].unit;if(!(E.length<=16)){var m=E.subarray(16,E.length-E.length%16),g=m.buffer.slice(m.byteOffset,m.byteOffset+m.length),f=this;this.decryptBuffer(g,function(t){var a=new Uint8Array(t);E.set(a,16),S||f.decryptAacSamples(O,p+1,T)})}},C.decryptAacSamples=function(O,p,T){for(;;p++){if(p>=O.length){T();return}if(!(O[p].unit.length<32)){var S=this.decrypter.isSync();if(this.decryptAacSample(O,p,T,S),!S)return}}},C.getAvcEncryptedData=function(O){for(var p=Math.floor((O.length-48)/160)*16+16,T=new Int8Array(p),S=0,E=32;E<O.length-16;E+=160,S+=16)T.set(O.subarray(E,E+16),S);return T},C.getAvcDecryptedUnit=function(O,p){for(var T=new Uint8Array(p),S=0,E=32;E<O.length-16;E+=160,S+=16)O.set(T.subarray(S,S+16),E);return O},C.decryptAvcSample=function(O,p,T,S,E,m){var g=Object(I.discardEPB)(E.data),f=this.getAvcEncryptedData(g),t=this;this.decryptBuffer(f.buffer,function(a){E.data=t.getAvcDecryptedUnit(g,a),m||t.decryptAvcSamples(O,p,T+1,S)})},C.decryptAvcSamples=function(O,p,T,S){if(O instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;p++,T=0){if(p>=O.length){S();return}for(var E=O[p].units;!(T>=E.length);T++){var m=E[T];if(!(m.data.length<=48||m.type!==1&&m.type!==5)){var g=this.decrypter.isSync();if(this.decryptAvcSample(O,p,T,S,m,g),!g)return}}}},F}();b.default=A},"./src/demux/transmuxer-interface.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"default",function(){return E});var M=y("./node_modules/webworkify-webpack/index.js"),I=y.n(M),A=y("./src/events.ts"),F=y("./src/demux/transmuxer.ts"),C=y("./src/utils/logger.ts"),R=y("./src/errors.ts"),O=y("./src/utils/mediasource-helper.ts"),p=y("./node_modules/eventemitter3/index.js"),T=y.n(p),S=Object(O.getMediaSource)()||{isTypeSupported:function(){return!1}},E=function(){function m(f,t,a,h){var v=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=f,this.id=t,this.onTransmuxComplete=a,this.onFlush=h;var i=f.config,r=function(l,n){n=n||{},n.frag=v.frag,n.id=v.id,f.trigger(l,n)};this.observer=new p.EventEmitter,this.observer.on(A.Events.FRAG_DECRYPTED,r),this.observer.on(A.Events.ERROR,r);var o={mp4:S.isTypeSupported("video/mp4"),mpeg:S.isTypeSupported("audio/mpeg"),mp3:S.isTypeSupported('audio/mp4; codecs="mp3"')},d=navigator.vendor;if(i.enableWorker&&typeof Worker<"u"){C.logger.log("demuxing in webworker");var e;try{e=this.worker=M("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),e.addEventListener("message",this.onwmsg),e.onerror=function(s){f.trigger(A.Events.ERROR,{type:R.ErrorTypes.OTHER_ERROR,details:R.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(s.message+"  ("+s.filename+":"+s.lineno+")")})},e.postMessage({cmd:"init",typeSupported:o,vendor:d,id:t,config:JSON.stringify(i)})}catch(s){C.logger.warn("Error in worker:",s),C.logger.error("Error while initializing DemuxerWorker, fallback to inline"),e&&self.URL.revokeObjectURL(e.objectURL),this.transmuxer=new F.default(this.observer,o,i,d,t),this.worker=null}}else this.transmuxer=new F.default(this.observer,o,i,d,t)}var g=m.prototype;return g.destroy=function(){var t=this.worker;if(t)t.removeEventListener("message",this.onwmsg),t.terminate(),this.worker=null,this.onwmsg=void 0;else{var a=this.transmuxer;a&&(a.destroy(),this.transmuxer=null)}var h=this.observer;h&&h.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},g.push=function(t,a,h,v,i,r,o,d,e,s){var l,n,u=this;e.transmuxing.start=self.performance.now();var c=this.transmuxer,D=this.worker,L=r?r.start:i.start,P=i.decryptdata,B=this.frag,x=!(B&&i.cc===B.cc),U=!(B&&e.level===B.level),N=B?e.sn-B.sn:-1,k=this.part?e.part-this.part.index:-1,K=N===0&&e.id>1&&e.id===B?.stats.chunkCount,w=!U&&(N===1||N===0&&(k===1||K&&k<=0)),W=self.performance.now();(U||N||i.stats.parsing.start===0)&&(i.stats.parsing.start=W),r&&(k||!w)&&(r.stats.parsing.start=W);var H=!(B&&((l=i.initSegment)===null||l===void 0?void 0:l.url)===((n=B.initSegment)===null||n===void 0?void 0:n.url)),j=new F.TransmuxState(x,w,d,U,L,H);if(!w||x||H){C.logger.log("[transmuxer-interface, "+i.type+"]: Starting new transmux session for sn: "+e.sn+" p: "+e.part+" level: "+e.level+" id: "+e.id+`
        discontinuity: `+x+`
        trackSwitch: `+U+`
        contiguous: `+w+`
        accurateTimeOffset: `+d+`
        timeOffset: `+L+`
        initSegmentChange: `+H);var Y=new F.TransmuxConfig(h,v,a,o,s);this.configureTransmuxer(Y)}if(this.frag=i,this.part=r,D)D.postMessage({cmd:"demux",data:t,decryptdata:P,chunkMeta:e,state:j},t instanceof ArrayBuffer?[t]:[]);else if(c){var X=c.push(t,P,e,j);Object(F.isPromise)(X)?X.then(function(z){u.handleTransmuxComplete(z)}):this.handleTransmuxComplete(X)}},g.flush=function(t){var a=this;t.transmuxing.start=self.performance.now();var h=this.transmuxer,v=this.worker;if(v)v.postMessage({cmd:"flush",chunkMeta:t});else if(h){var i=h.flush(t);Object(F.isPromise)(i)?i.then(function(r){a.handleFlushResult(r,t)}):this.handleFlushResult(i,t)}},g.handleFlushResult=function(t,a){var h=this;t.forEach(function(v){h.handleTransmuxComplete(v)}),this.onFlush(a)},g.onWorkerMessage=function(t){var a=t.data,h=this.hls;switch(a.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(a.data);break}case"flush":{this.onFlush(a.data);break}case"workerLog":C.logger[a.data.logType]&&C.logger[a.data.logType](a.data.message);break;default:{a.data=a.data||{},a.data.frag=this.frag,a.data.id=this.id,h.trigger(a.event,a.data);break}}},g.configureTransmuxer=function(t){var a=this.worker,h=this.transmuxer;a?a.postMessage({cmd:"configure",config:t}):h&&h.configure(t)},g.handleTransmuxComplete=function(t){t.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(t)},m}()},"./src/demux/transmuxer-worker.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"default",function(){return R});var M=y("./src/demux/transmuxer.ts"),I=y("./src/events.ts"),A=y("./src/utils/logger.ts"),F=y("./node_modules/eventemitter3/index.js"),C=y.n(F);function R(E){var m=new F.EventEmitter,g=function(a,h){E.postMessage({event:a,data:h})};m.on(I.Events.FRAG_DECRYPTED,g),m.on(I.Events.ERROR,g);var f=function(){var a=function(i){var r=function(d){g("workerLog",{logType:i,message:d})};A.logger[i]=r};for(var h in A.logger)a(h)};E.addEventListener("message",function(t){var a=t.data;switch(a.cmd){case"init":{var h=JSON.parse(a.config);E.transmuxer=new M.default(m,a.typeSupported,h,a.vendor,a.id),Object(A.enableLogs)(h.debug),f(),g("init",null);break}case"configure":{E.transmuxer.configure(a.config);break}case"demux":{var v=E.transmuxer.push(a.data,a.decryptdata,a.chunkMeta,a.state);Object(M.isPromise)(v)?v.then(function(o){O(E,o)}):O(E,v);break}case"flush":{var i=a.chunkMeta,r=E.transmuxer.flush(i);Object(M.isPromise)(r)?r.then(function(o){T(E,o,i)}):T(E,r,i);break}default:break}})}function O(E,m){if(S(m.remuxResult))return!1;var g=[],f=m.remuxResult,t=f.audio,a=f.video;return t&&p(g,t),a&&p(g,a),E.postMessage({event:"transmuxComplete",data:m},g),!0}function p(E,m){m.data1&&E.push(m.data1.buffer),m.data2&&E.push(m.data2.buffer)}function T(E,m,g){var f=m.reduce(function(t,a){return O(E,a)||t},!1);f||E.postMessage({event:"transmuxComplete",data:m[0]}),E.postMessage({event:"flush",data:g})}function S(E){return!E.audio&&!E.video&&!E.text&&!E.id3&&!E.initSegment}},"./src/demux/transmuxer.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"default",function(){return g}),y.d(b,"isPromise",function(){return a}),y.d(b,"TransmuxConfig",function(){return h}),y.d(b,"TransmuxState",function(){return v});var M=y("./src/events.ts"),I=y("./src/errors.ts"),A=y("./src/crypt/decrypter.ts"),F=y("./src/demux/aacdemuxer.ts"),C=y("./src/demux/mp4demuxer.ts"),R=y("./src/demux/tsdemuxer.ts"),O=y("./src/demux/mp3demuxer.ts"),p=y("./src/remux/mp4-remuxer.ts"),T=y("./src/remux/passthrough-remuxer.ts"),S=y("./src/utils/logger.ts"),E;try{E=self.performance.now.bind(self.performance)}catch{S.logger.debug("Unable to use Performance API on this environment"),E=self.Date.now}var m=[{demux:R.default,remux:p.default},{demux:C.default,remux:T.default},{demux:F.default,remux:p.default},{demux:O.default,remux:p.default}],g=function(){function i(o,d,e,s,l){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=o,this.typeSupported=d,this.config=e,this.vendor=s,this.id=l}var r=i.prototype;return r.configure=function(d){this.transmuxConfig=d,this.decrypter&&this.decrypter.reset()},r.push=function(d,e,s,l){var n=this,u=s.transmuxing;u.executeStart=E();var c=new Uint8Array(d),D=this.config,L=this.currentTransmuxState,P=this.transmuxConfig;l&&(this.currentTransmuxState=l);var B=l||L,x=B.contiguous,U=B.discontinuity,N=B.trackSwitch,k=B.accurateTimeOffset,K=B.timeOffset,w=B.initSegmentChange,W=P.audioCodec,H=P.videoCodec,j=P.defaultInitPts,Y=P.duration,X=P.initSegmentData;(U||N||w)&&this.resetInitSegment(X,W,H,Y),(U||w)&&this.resetInitialTimestamp(j),x||this.resetContiguity();var z=f(c,e);if(z&&z.method==="AES-128"){var _=this.getDecrypter();if(D.enableSoftwareAES){var Q=_.softwareDecrypt(c,z.key.buffer,z.iv.buffer);if(!Q)return u.executeEnd=E(),t(s);c=new Uint8Array(Q)}else return this.decryptionPromise=_.webCryptoDecrypt(c,z.key.buffer,z.iv.buffer).then(function(J){var Z=n.push(J,null,s);return n.decryptionPromise=null,Z}),this.decryptionPromise}this.needsProbing(c,U,N)&&this.configureTransmuxer(c,P);var $=this.transmux(c,z,K,k,s),V=this.currentTransmuxState;return V.contiguous=!0,V.discontinuity=!1,V.trackSwitch=!1,u.executeEnd=E(),$},r.flush=function(d){var e=this,s=d.transmuxing;s.executeStart=E();var l=this.decrypter,n=this.currentTransmuxState,u=this.decryptionPromise;if(u)return u.then(function(){return e.flush(d)});var c=[],D=n.timeOffset;if(l){var L=l.flush();L&&c.push(this.push(L,null,d))}var P=this.demuxer,B=this.remuxer;if(!P||!B)return this.observer.emit(M.Events.ERROR,M.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),s.executeEnd=E(),[t(d)];var x=P.flush(D);return a(x)?x.then(function(U){return e.flushRemux(c,U,d),c}):(this.flushRemux(c,x,d),c)},r.flushRemux=function(d,e,s){var l=e.audioTrack,n=e.videoTrack,u=e.id3Track,c=e.textTrack,D=this.currentTransmuxState,L=D.accurateTimeOffset,P=D.timeOffset;S.logger.log("[transmuxer.ts]: Flushed fragment "+s.sn+(s.part>-1?" p: "+s.part:"")+" of level "+s.level);var B=this.remuxer.remux(l,n,u,c,P,L,!0,this.id);d.push({remuxResult:B,chunkMeta:s}),s.transmuxing.executeEnd=E()},r.resetInitialTimestamp=function(d){var e=this.demuxer,s=this.remuxer;!e||!s||(e.resetTimeStamp(d),s.resetTimeStamp(d))},r.resetContiguity=function(){var d=this.demuxer,e=this.remuxer;!d||!e||(d.resetContiguity(),e.resetNextTimestamp())},r.resetInitSegment=function(d,e,s,l){var n=this.demuxer,u=this.remuxer;!n||!u||(n.resetInitSegment(d,e,s,l),u.resetInitSegment(d,e,s))},r.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},r.transmux=function(d,e,s,l,n){var u;return e&&e.method==="SAMPLE-AES"?u=this.transmuxSampleAes(d,e,s,l,n):u=this.transmuxUnencrypted(d,s,l,n),u},r.transmuxUnencrypted=function(d,e,s,l){var n=this.demuxer.demux(d,e,!1,!this.config.progressive),u=n.audioTrack,c=n.videoTrack,D=n.id3Track,L=n.textTrack,P=this.remuxer.remux(u,c,D,L,e,s,!1,this.id);return{remuxResult:P,chunkMeta:l}},r.transmuxSampleAes=function(d,e,s,l,n){var u=this;return this.demuxer.demuxSampleAes(d,e,s).then(function(c){var D=u.remuxer.remux(c.audioTrack,c.videoTrack,c.id3Track,c.textTrack,s,l,!1,u.id);return{remuxResult:D,chunkMeta:n}})},r.configureTransmuxer=function(d,e){for(var s=this.config,l=this.observer,n=this.typeSupported,u=this.vendor,c=e.audioCodec,D=e.defaultInitPts,L=e.duration,P=e.initSegmentData,B=e.videoCodec,x,U=0,N=m.length;U<N;U++)if(m[U].demux.probe(d)){x=m[U];break}x||(S.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),x={demux:C.default,remux:T.default});var k=this.demuxer,K=this.remuxer,w=x.remux,W=x.demux;(!K||!(K instanceof w))&&(this.remuxer=new w(l,s,n,u)),(!k||!(k instanceof W))&&(this.demuxer=new W(l,s,n),this.probe=W.probe),this.resetInitSegment(P,c,B,L),this.resetInitialTimestamp(D)},r.needsProbing=function(d,e,s){return!this.demuxer||!this.remuxer||e||s},r.getDecrypter=function(){var d=this.decrypter;return d||(d=this.decrypter=new A.default(this.observer,this.config)),d},i}();function f(i,r){var o=null;return i.byteLength>0&&r!=null&&r.key!=null&&r.iv!==null&&r.method!=null&&(o=r),o}var t=function(r){return{remuxResult:{},chunkMeta:r}};function a(i){return"then"in i&&i.then instanceof Function}var h=function(r,o,d,e,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=r,this.videoCodec=o,this.initSegmentData=d,this.duration=e,this.defaultInitPts=s},v=function(r,o,d,e,s,l){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=r,this.contiguous=o,this.accurateTimeOffset=d,this.trackSwitch=e,this.timeOffset=s,this.initSegmentChange=l}},"./src/demux/tsdemuxer.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"discardEPB",function(){return h});var M=y("./src/demux/adts.ts"),I=y("./src/demux/mpegaudio.ts"),A=y("./src/demux/exp-golomb.ts"),F=y("./src/demux/sample-aes.ts"),C=y("./src/events.ts"),R=y("./src/utils/mp4-tools.ts"),O=y("./src/utils/logger.ts"),p=y("./src/errors.ts"),T=y("./src/types/demuxer.ts");function S(){return S=Object.assign?Object.assign.bind():function(v){for(var i=1;i<arguments.length;i++){var r=arguments[i];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(v[o]=r[o])}return v},S.apply(this,arguments)}var E=function(){function v(r,o,d){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=r,this.config=o,this.typeSupported=d}v.probe=function(o){return o[0]===71&&o[188]===71},v.createTrack=function(o,d){return{container:o==="video"||o==="audio"?"video/mp2t":void 0,type:o,id:R.RemuxerTrackIdConfig[o],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:o==="audio"?d:void 0}};var i=v.prototype;return i.resetInitSegment=function(o,d,e,s){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=v.createTrack("video"),this._audioTrack=v.createTrack("audio",s),this._id3Track=v.createTrack("id3"),this._txtTrack=v.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=d,this.videoCodec=e,this._duration=s},i.resetTimeStamp=function(){},i.resetContiguity=function(){var o=this._audioTrack,d=this._avcTrack,e=this._id3Track;o&&(o.pesData=null),d&&(d.pesData=null),e&&(e.pesData=null),this.aacOverFlow=null},i.demux=function(o,d,e,s){e===void 0&&(e=!1),s===void 0&&(s=!1),e||(this.sampleAes=null);var l,n=this._avcTrack,u=this._audioTrack,c=this._id3Track,D=this._txtTrack,L=n.pid,P=n.pesData,B=u.pid,x=c.pid,U=u.pesData,N=c.pesData,k=null,K=this.pmtParsed,w=this._pmtId,W=o.length;if(this.remainderData&&(o=Object(R.appendUint8Array)(this.remainderData,o),W=o.length,this.remainderData=null),W<188&&!s)return this.remainderData=o,{audioTrack:u,videoTrack:n,id3Track:c,textTrack:D};W-=W%188,W<o.byteLength&&!s&&(this.remainderData=new Uint8Array(o.buffer,W,o.buffer.byteLength-W));for(var H=0,j=0;j<W;j+=188)if(o[j]===71){var Y=!!(o[j+1]&64),X=((o[j+1]&31)<<8)+o[j+2],z=(o[j+3]&48)>>4,_=void 0;if(z>1){if(_=j+5+o[j+4],_===j+188)continue}else _=j+4;switch(X){case L:Y&&(P&&(l=t(P))&&this.parseAVCPES(n,D,l,!1),P={data:[],size:0}),P&&(P.data.push(o.subarray(_,j+188)),P.size+=j+188-_);break;case B:if(Y){if(U&&(l=t(U)))switch(u.segmentCodec){case"aac":this.parseAACPES(u,l);break;case"mp3":this.parseMPEGPES(u,l);break}U={data:[],size:0}}U&&(U.data.push(o.subarray(_,j+188)),U.size+=j+188-_);break;case x:Y&&(N&&(l=t(N))&&this.parseID3PES(c,l),N={data:[],size:0}),N&&(N.data.push(o.subarray(_,j+188)),N.size+=j+188-_);break;case 0:Y&&(_+=o[_]+1),w=this._pmtId=g(o,_);break;case w:{Y&&(_+=o[_]+1);var Q=f(o,_,this.typeSupported,e);L=Q.avc,L>0&&(n.pid=L),B=Q.audio,B>0&&(u.pid=B,u.segmentCodec=Q.segmentCodec),x=Q.id3,x>0&&(c.pid=x),k!==null&&!K&&(O.logger.log("unknown PID '"+k+"' in TS found"),k=null),K=this.pmtParsed=!0;break}case 17:case 8191:break;default:k=X;break}}else H++;H>0&&this.observer.emit(C.Events.ERROR,C.Events.ERROR,{type:p.ErrorTypes.MEDIA_ERROR,details:p.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+H+" TS packet/s that do not start with 0x47"}),n.pesData=P,u.pesData=U,c.pesData=N;var $={audioTrack:u,videoTrack:n,id3Track:c,textTrack:D};return s&&this.extractRemainingSamples($),$},i.flush=function(){var o=this.remainderData;this.remainderData=null;var d;return o?d=this.demux(o,-1,!1,!0):d={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(d),this.sampleAes?this.decrypt(d,this.sampleAes):d},i.extractRemainingSamples=function(o){var d=o.audioTrack,e=o.videoTrack,s=o.id3Track,l=o.textTrack,n=e.pesData,u=d.pesData,c=s.pesData,D;if(n&&(D=t(n))?(this.parseAVCPES(e,l,D,!0),e.pesData=null):e.pesData=n,u&&(D=t(u))){switch(d.segmentCodec){case"aac":this.parseAACPES(d,D);break;case"mp3":this.parseMPEGPES(d,D);break}d.pesData=null}else u!=null&&u.size&&O.logger.log("last AAC PES packet truncated,might overlap between fragments"),d.pesData=u;c&&(D=t(c))?(this.parseID3PES(s,D),s.pesData=null):s.pesData=c},i.demuxSampleAes=function(o,d,e){var s=this.demux(o,e,!0,!this.config.progressive),l=this.sampleAes=new F.default(this.observer,this.config,d);return this.decrypt(s,l)},i.decrypt=function(o,d){return new Promise(function(e){var s=o.audioTrack,l=o.videoTrack;s.samples&&s.segmentCodec==="aac"?d.decryptAacSamples(s.samples,0,function(){l.samples?d.decryptAvcSamples(l.samples,0,0,function(){e(o)}):e(o)}):l.samples&&d.decryptAvcSamples(l.samples,0,0,function(){e(o)})})},i.destroy=function(){this._duration=0},i.parseAVCPES=function(o,d,e,s){var l=this,n=this.parseAVCNALu(o,e.data),u=!1,c=this.avcSample,D,L=!1;e.data=null,c&&n.length&&!o.audFound&&(a(c,o),c=this.avcSample=m(!1,e.pts,e.dts,"")),n.forEach(function(P){switch(P.type){case 1:{D=!0,c||(c=l.avcSample=m(!0,e.pts,e.dts,"")),u&&(c.debug+="NDR "),c.frame=!0;var B=P.data;if(L&&B.length>4){var x=new A.default(B).readSliceType();(x===2||x===4||x===7||x===9)&&(c.key=!0)}break}case 5:D=!0,c||(c=l.avcSample=m(!0,e.pts,e.dts,"")),u&&(c.debug+="IDR "),c.key=!0,c.frame=!0;break;case 6:{D=!0,u&&c&&(c.debug+="SEI "),Object(R.parseSEIMessageFromNALu)(h(P.data),e.pts,d.samples);break}case 7:if(D=!0,L=!0,u&&c&&(c.debug+="SPS "),!o.sps){var U=new A.default(P.data),N=U.readSPS();o.width=N.width,o.height=N.height,o.pixelRatio=N.pixelRatio,o.sps=[P.data],o.duration=l._duration;for(var k=P.data.subarray(1,4),K="avc1.",w=0;w<3;w++){var W=k[w].toString(16);W.length<2&&(W="0"+W),K+=W}o.codec=K}break;case 8:D=!0,u&&c&&(c.debug+="PPS "),o.pps||(o.pps=[P.data]);break;case 9:D=!1,o.audFound=!0,c&&a(c,o),c=l.avcSample=m(!1,e.pts,e.dts,u?"AUD ":"");break;case 12:D=!0;break;default:D=!1,c&&(c.debug+="unknown NAL "+P.type+" ");break}if(c&&D){var H=c.units;H.push(P)}}),s&&c&&(a(c,o),this.avcSample=null)},i.getLastNalUnit=function(o){var d,e=this.avcSample,s;if((!e||e.units.length===0)&&(e=o[o.length-1]),(d=e)!==null&&d!==void 0&&d.units){var l=e.units;s=l[l.length-1]}return s},i.parseAVCNALu=function(o,d){var e=d.byteLength,s=o.naluState||0,l=s,n=[],u=0,c,D,L,P=-1,B=0;for(s===-1&&(P=0,B=d[0]&31,s=0,u=1);u<e;){if(c=d[u++],!s){s=c?0:1;continue}if(s===1){s=c?0:2;continue}if(!c)s=3;else if(c===1){if(P>=0){var x={data:d.subarray(P,u-s-1),type:B};n.push(x)}else{var U=this.getLastNalUnit(o.samples);if(U&&(l&&u<=4-l&&U.state&&(U.data=U.data.subarray(0,U.data.byteLength-l)),D=u-s-1,D>0)){var N=new Uint8Array(U.data.byteLength+D);N.set(U.data,0),N.set(d.subarray(0,D),U.data.byteLength),U.data=N,U.state=0}}u<e?(L=d[u]&31,P=u,B=L,s=0):s=-1}else s=0}if(P>=0&&s>=0){var k={data:d.subarray(P,e),type:B,state:s};n.push(k)}if(n.length===0){var K=this.getLastNalUnit(o.samples);if(K){var w=new Uint8Array(K.data.byteLength+d.byteLength);w.set(K.data,0),w.set(d,K.data.byteLength),K.data=w}}return o.naluState=s,n},i.parseAACPES=function(o,d){var e=0,s=this.aacOverFlow,l=d.data;if(s){this.aacOverFlow=null;var n=s.missing,u=s.sample.unit.byteLength;if(n===-1){var c=new Uint8Array(u+l.byteLength);c.set(s.sample.unit,0),c.set(l,u),l=c}else{var D=u-n;s.sample.unit.set(l.subarray(0,n),D),o.samples.push(s.sample),e=s.missing}}var L,P;for(L=e,P=l.length;L<P-1&&!M.isHeader(l,L);L++);if(L!==e){var B,x;if(L<P-1?(B="AAC PES did not start with ADTS header,offset:"+L,x=!1):(B="no ADTS header found in AAC PES",x=!0),O.logger.warn("parsing error:"+B),this.observer.emit(C.Events.ERROR,C.Events.ERROR,{type:p.ErrorTypes.MEDIA_ERROR,details:p.ErrorDetails.FRAG_PARSING_ERROR,fatal:x,reason:B}),x)return}M.initTrackConfig(o,this.observer,l,L,this.audioCodec);var U;if(d.pts!==void 0)U=d.pts;else if(s){var N=M.getFrameDuration(o.samplerate);U=s.sample.pts+N}else{O.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var k=0,K;L<P;)if(K=M.appendFrame(o,l,L,U,k),L+=K.length,K.missing){this.aacOverFlow=K;break}else for(k++;L<P-1&&!M.isHeader(l,L);L++);},i.parseMPEGPES=function(o,d){var e=d.data,s=e.length,l=0,n=0,u=d.pts;if(u===void 0){O.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;n<s;)if(I.isHeader(e,n)){var c=I.appendFrame(o,e,n,u,l);if(c)n+=c.length,l++;else break}else n++},i.parseID3PES=function(o,d){if(d.pts===void 0){O.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}var e=S({},d,{type:this._avcTrack?T.MetadataSchema.emsg:T.MetadataSchema.audioId3});o.samples.push(e)},v}();function m(v,i,r,o){return{key:v,frame:!1,pts:i,dts:r,units:[],debug:o,length:0}}function g(v,i){return(v[i+10]&31)<<8|v[i+11]}function f(v,i,r,o){var d={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},e=(v[i+1]&15)<<8|v[i+2],s=i+3+e-4,l=(v[i+10]&15)<<8|v[i+11];for(i+=12+l;i<s;){var n=(v[i+1]&31)<<8|v[i+2];switch(v[i]){case 207:if(!o){O.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:d.audio===-1&&(d.audio=n);break;case 21:d.id3===-1&&(d.id3=n);break;case 219:if(!o){O.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:d.avc===-1&&(d.avc=n);break;case 3:case 4:r.mpeg!==!0&&r.mp3!==!0?O.logger.log("MPEG audio found, not supported in this browser"):d.audio===-1&&(d.audio=n,d.segmentCodec="mp3");break;case 36:O.logger.warn("Unsupported HEVC stream type found");break;default:break}i+=((v[i+3]&15)<<8|v[i+4])+5}return d}function t(v){var i=0,r,o,d,e,s,l=v.data;if(!v||v.size===0)return null;for(;l[0].length<19&&l.length>1;){var n=new Uint8Array(l[0].length+l[1].length);n.set(l[0]),n.set(l[1],l[0].length),l[0]=n,l.splice(1,1)}r=l[0];var u=(r[0]<<16)+(r[1]<<8)+r[2];if(u===1){if(o=(r[4]<<8)+r[5],o&&o>v.size-6)return null;var c=r[7];c&192&&(e=(r[9]&14)*536870912+(r[10]&255)*4194304+(r[11]&254)*16384+(r[12]&255)*128+(r[13]&254)/2,c&64?(s=(r[14]&14)*536870912+(r[15]&255)*4194304+(r[16]&254)*16384+(r[17]&255)*128+(r[18]&254)/2,e-s>60*9e4&&(O.logger.warn(Math.round((e-s)/9e4)+"s delta between PTS and DTS, align them"),e=s)):s=e),d=r[8];var D=d+9;if(v.size<=D)return null;v.size-=D;for(var L=new Uint8Array(v.size),P=0,B=l.length;P<B;P++){r=l[P];var x=r.byteLength;if(D)if(D>x){D-=x;continue}else r=r.subarray(D),x-=D,D=0;L.set(r,i),i+=x}return o&&(o-=d+3),{data:L,pts:e,dts:s,len:o}}return null}function a(v,i){if(v.units.length&&v.frame){if(v.pts===void 0){var r=i.samples,o=r.length;if(o){var d=r[o-1];v.pts=d.pts,v.dts=d.dts}else{i.dropped++;return}}i.samples.push(v)}v.debug.length&&O.logger.log(v.pts+"/"+v.dts+":"+v.debug)}function h(v){for(var i=v.byteLength,r=[],o=1;o<i-2;)v[o]===0&&v[o+1]===0&&v[o+2]===3?(r.push(o+2),o+=2):o++;if(r.length===0)return v;var d=i-r.length,e=new Uint8Array(d),s=0;for(o=0;o<d;s++,o++)s===r[0]&&(s++,r.shift()),e[o]=v[s];return e}b.default=E},"./src/errors.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"ErrorTypes",function(){return M}),y.d(b,"ErrorDetails",function(){return I});var M;(function(A){A.NETWORK_ERROR="networkError",A.MEDIA_ERROR="mediaError",A.KEY_SYSTEM_ERROR="keySystemError",A.MUX_ERROR="muxError",A.OTHER_ERROR="otherError"})(M||(M={}));var I;(function(A){A.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",A.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",A.KEY_SYSTEM_NO_SESSION="keySystemNoSession",A.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",A.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",A.MANIFEST_LOAD_ERROR="manifestLoadError",A.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",A.MANIFEST_PARSING_ERROR="manifestParsingError",A.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",A.LEVEL_EMPTY_ERROR="levelEmptyError",A.LEVEL_LOAD_ERROR="levelLoadError",A.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",A.LEVEL_SWITCH_ERROR="levelSwitchError",A.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",A.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",A.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",A.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",A.FRAG_LOAD_ERROR="fragLoadError",A.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",A.FRAG_DECRYPT_ERROR="fragDecryptError",A.FRAG_PARSING_ERROR="fragParsingError",A.REMUX_ALLOC_ERROR="remuxAllocError",A.KEY_LOAD_ERROR="keyLoadError",A.KEY_LOAD_TIMEOUT="keyLoadTimeOut",A.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",A.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",A.BUFFER_APPEND_ERROR="bufferAppendError",A.BUFFER_APPENDING_ERROR="bufferAppendingError",A.BUFFER_STALLED_ERROR="bufferStalledError",A.BUFFER_FULL_ERROR="bufferFullError",A.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",A.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",A.INTERNAL_EXCEPTION="internalException",A.INTERNAL_ABORTED="aborted",A.UNKNOWN="unknown"})(I||(I={}))},"./src/events.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"Events",function(){return M});var M;(function(I){I.MEDIA_ATTACHING="hlsMediaAttaching",I.MEDIA_ATTACHED="hlsMediaAttached",I.MEDIA_DETACHING="hlsMediaDetaching",I.MEDIA_DETACHED="hlsMediaDetached",I.BUFFER_RESET="hlsBufferReset",I.BUFFER_CODECS="hlsBufferCodecs",I.BUFFER_CREATED="hlsBufferCreated",I.BUFFER_APPENDING="hlsBufferAppending",I.BUFFER_APPENDED="hlsBufferAppended",I.BUFFER_EOS="hlsBufferEos",I.BUFFER_FLUSHING="hlsBufferFlushing",I.BUFFER_FLUSHED="hlsBufferFlushed",I.MANIFEST_LOADING="hlsManifestLoading",I.MANIFEST_LOADED="hlsManifestLoaded",I.MANIFEST_PARSED="hlsManifestParsed",I.LEVEL_SWITCHING="hlsLevelSwitching",I.LEVEL_SWITCHED="hlsLevelSwitched",I.LEVEL_LOADING="hlsLevelLoading",I.LEVEL_LOADED="hlsLevelLoaded",I.LEVEL_UPDATED="hlsLevelUpdated",I.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",I.LEVELS_UPDATED="hlsLevelsUpdated",I.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",I.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",I.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",I.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",I.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",I.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",I.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",I.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",I.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",I.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",I.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",I.CUES_PARSED="hlsCuesParsed",I.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",I.INIT_PTS_FOUND="hlsInitPtsFound",I.FRAG_LOADING="hlsFragLoading",I.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",I.FRAG_LOADED="hlsFragLoaded",I.FRAG_DECRYPTED="hlsFragDecrypted",I.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",I.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",I.FRAG_PARSING_METADATA="hlsFragParsingMetadata",I.FRAG_PARSED="hlsFragParsed",I.FRAG_BUFFERED="hlsFragBuffered",I.FRAG_CHANGED="hlsFragChanged",I.FPS_DROP="hlsFpsDrop",I.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",I.ERROR="hlsError",I.DESTROYING="hlsDestroying",I.KEY_LOADING="hlsKeyLoading",I.KEY_LOADED="hlsKeyLoaded",I.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",I.BACK_BUFFER_REACHED="hlsBackBufferReached"})(M||(M={}))},"./src/hls.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"default",function(){return i});var M=y("./node_modules/url-toolkit/src/url-toolkit.js"),I=y.n(M),A=y("./src/loader/playlist-loader.ts"),F=y("./src/loader/key-loader.ts"),C=y("./src/controller/id3-track-controller.ts"),R=y("./src/controller/latency-controller.ts"),O=y("./src/controller/level-controller.ts"),p=y("./src/controller/fragment-tracker.ts"),T=y("./src/controller/stream-controller.ts"),S=y("./src/is-supported.ts"),E=y("./src/utils/logger.ts"),m=y("./src/config.ts"),g=y("./node_modules/eventemitter3/index.js"),f=y.n(g),t=y("./src/events.ts"),a=y("./src/errors.ts");function h(r,o){for(var d=0;d<o.length;d++){var e=o[d];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(r,e.key,e)}}function v(r,o,d){return o&&h(r.prototype,o),d&&h(r,d),Object.defineProperty(r,"prototype",{writable:!1}),r}var i=function(){r.isSupported=function(){return Object(S.isSupported)()};function r(d){d===void 0&&(d={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new g.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var e=this.config=Object(m.mergeConfig)(r.DefaultConfig,d);this.userConfig=d,Object(E.enableLogs)(e.debug),this._autoLevelCapping=-1,e.progressive&&Object(m.enableStreamingMode)(e);var s=e.abrController,l=e.bufferController,n=e.capLevelController,u=e.fpsController,c=this.abrController=new s(this),D=this.bufferController=new l(this),L=this.capLevelController=new n(this),P=new u(this),B=new A.default(this),x=new F.default(this),U=new C.default(this),N=this.levelController=new O.default(this),k=new p.FragmentTracker(this),K=this.streamController=new T.default(this,k);L.setStreamController(K),P.setStreamController(K);var w=[B,x,N,K];this.networkControllers=w;var W=[c,D,L,P,U,k];this.audioTrackController=this.createController(e.audioTrackController,null,w),this.createController(e.audioStreamController,k,w),this.subtitleTrackController=this.createController(e.subtitleTrackController,null,w),this.createController(e.subtitleStreamController,k,w),this.createController(e.timelineController,null,W),this.emeController=this.createController(e.emeController,null,W),this.cmcdController=this.createController(e.cmcdController,null,W),this.latencyController=this.createController(R.default,null,W),this.coreComponents=W}var o=r.prototype;return o.createController=function(e,s,l){if(e){var n=s?new e(this,s):new e(this);return l&&l.push(n),n}return null},o.on=function(e,s,l){l===void 0&&(l=this),this._emitter.on(e,s,l)},o.once=function(e,s,l){l===void 0&&(l=this),this._emitter.once(e,s,l)},o.removeAllListeners=function(e){this._emitter.removeAllListeners(e)},o.off=function(e,s,l,n){l===void 0&&(l=this),this._emitter.off(e,s,l,n)},o.listeners=function(e){return this._emitter.listeners(e)},o.emit=function(e,s,l){return this._emitter.emit(e,s,l)},o.trigger=function(e,s){if(this.config.debug)return this.emit(e,e,s);try{return this.emit(e,e,s)}catch(l){E.logger.error("An internal error happened while handling event "+e+'. Error message: "'+l.message+'". Here is a stacktrace:',l),this.trigger(t.Events.ERROR,{type:a.ErrorTypes.OTHER_ERROR,details:a.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:e,error:l})}return!1},o.listenerCount=function(e){return this._emitter.listenerCount(e)},o.destroy=function(){E.logger.log("destroy"),this.trigger(t.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(e){return e.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(e){return e.destroy()}),this.coreComponents.length=0},o.attachMedia=function(e){E.logger.log("attachMedia"),this._media=e,this.trigger(t.Events.MEDIA_ATTACHING,{media:e})},o.detachMedia=function(){E.logger.log("detachMedia"),this.trigger(t.Events.MEDIA_DETACHING,void 0),this._media=null},o.loadSource=function(e){this.stopLoad();var s=this.media,l=this.url,n=this.url=M.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});E.logger.log("loadSource:"+n),s&&l&&l!==n&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(s)),this.trigger(t.Events.MANIFEST_LOADING,{url:e})},o.startLoad=function(e){e===void 0&&(e=-1),E.logger.log("startLoad("+e+")"),this.networkControllers.forEach(function(s){s.startLoad(e)})},o.stopLoad=function(){E.logger.log("stopLoad"),this.networkControllers.forEach(function(e){e.stopLoad()})},o.swapAudioCodec=function(){E.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},o.recoverMediaError=function(){E.logger.log("recoverMediaError");var e=this._media;this.detachMedia(),e&&this.attachMedia(e)},o.removeLevel=function(e,s){s===void 0&&(s=0),this.levelController.removeLevel(e,s)},v(r,[{key:"levels",get:function(){var e=this.levelController.levels;return e||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){E.logger.log("set currentLevel:"+e),this.loadLevel=e,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){E.logger.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){E.logger.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){E.logger.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){E.logger.log("set startLevel:"+e),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(e){var s=!!e;s!==this.config.capLevelToPlayerSize&&(s?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=s)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){this._autoLevelCapping!==e&&(E.logger.log("set autoLevelCapping:"+e),this._autoLevelCapping=e)}},{key:"bandwidthEstimate",get:function(){var e=this.abrController.bwEstimator;return e?e.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var e=this.levels,s=this.config.minAutoBitrate;if(!e)return 0;for(var l=e.length,n=0;n<l;n++)if(e[n].maxBitrate>=s)return n;return 0}},{key:"maxAutoLevel",get:function(){var e=this.levels,s=this.autoLevelCapping,l;return s===-1&&e&&e.length?l=e.length-1:l=s,l}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var s=this.audioTrackController;s&&(s.audioTrack=e)}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var s=this.subtitleTrackController;s&&(s.subtitleTrack=e)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return e?e.subtitleDisplay:!1},set:function(e){var s=this.subtitleTrackController;s&&(s.subtitleDisplay=e)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(e){this.config.lowLatencyMode=e}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.2.4"}},{key:"Events",get:function(){return t.Events}},{key:"ErrorTypes",get:function(){return a.ErrorTypes}},{key:"ErrorDetails",get:function(){return a.ErrorDetails}},{key:"DefaultConfig",get:function(){return r.defaultConfig?r.defaultConfig:m.hlsDefaultConfig},set:function(e){r.defaultConfig=e}}]),r}();i.defaultConfig=void 0},"./src/is-supported.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"isSupported",function(){return A}),y.d(b,"changeTypeSupported",function(){return F});var M=y("./src/utils/mediasource-helper.ts");function I(){return self.SourceBuffer||self.WebKitSourceBuffer}function A(){var C=Object(M.getMediaSource)();if(!C)return!1;var R=I(),O=C&&typeof C.isTypeSupported=="function"&&C.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),p=!R||R.prototype&&typeof R.prototype.appendBuffer=="function"&&typeof R.prototype.remove=="function";return!!O&&!!p}function F(){var C,R=I();return typeof(R==null||(C=R.prototype)===null||C===void 0?void 0:C.changeType)=="function"}},"./src/loader/date-range.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"DateRangeAttribute",function(){return O}),y.d(b,"DateRange",function(){return p});var M=y("./src/polyfills/number.ts"),I=y("./src/utils/attr-list.ts"),A=y("./src/utils/logger.ts");function F(){return F=Object.assign?Object.assign.bind():function(T){for(var S=1;S<arguments.length;S++){var E=arguments[S];for(var m in E)Object.prototype.hasOwnProperty.call(E,m)&&(T[m]=E[m])}return T},F.apply(this,arguments)}function C(T,S){for(var E=0;E<S.length;E++){var m=S[E];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(T,m.key,m)}}function R(T,S,E){return S&&C(T.prototype,S),E&&C(T,E),Object.defineProperty(T,"prototype",{writable:!1}),T}var O;(function(T){T.ID="ID",T.CLASS="CLASS",T.START_DATE="START-DATE",T.DURATION="DURATION",T.END_DATE="END-DATE",T.END_ON_NEXT="END-ON-NEXT",T.PLANNED_DURATION="PLANNED-DURATION",T.SCTE35_OUT="SCTE35-OUT",T.SCTE35_IN="SCTE35-IN"})(O||(O={}));var p=function(){function T(S,E){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,E){var m=E.attr;for(var g in m)if(Object.prototype.hasOwnProperty.call(S,g)&&S[g]!==m[g]){A.logger.warn('DATERANGE tag attribute: "'+g+'" does not match for tags with ID: "'+S.ID+'"'),this._badValueForSameId=g;break}S=F(new I.AttrList({}),m,S)}if(this.attr=S,this._startDate=new Date(S[O.START_DATE]),O.END_DATE in this.attr){var f=new Date(this.attr[O.END_DATE]);Object(M.isFiniteNumber)(f.getTime())&&(this._endDate=f)}}return R(T,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var E=this.duration;return E!==null?new Date(this._startDate.getTime()+E*1e3):null}},{key:"duration",get:function(){if(O.DURATION in this.attr){var E=this.attr.decimalFloatingPoint(O.DURATION);if(Object(M.isFiniteNumber)(E))return E}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return O.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(O.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(O.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&Object(M.isFiniteNumber)(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),T}()},"./src/loader/fragment-loader.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"default",function(){return E}),y.d(b,"LoadError",function(){return g});var M=y("./src/polyfills/number.ts"),I=y("./src/errors.ts");function A(f,t){f.prototype=Object.create(t.prototype),f.prototype.constructor=f,p(f,t)}function F(f){var t=typeof Map=="function"?new Map:void 0;return F=function(h){if(h===null||!O(h))return h;if(typeof h!="function")throw new TypeError("Super expression must either be null or a function");if(typeof t<"u"){if(t.has(h))return t.get(h);t.set(h,v)}function v(){return C(h,arguments,T(this).constructor)}return v.prototype=Object.create(h.prototype,{constructor:{value:v,enumerable:!1,writable:!0,configurable:!0}}),p(v,h)},F(f)}function C(f,t,a){return R()?C=Reflect.construct.bind():C=function(v,i,r){var o=[null];o.push.apply(o,i);var d=Function.bind.apply(v,o),e=new d;return r&&p(e,r.prototype),e},C.apply(null,arguments)}function R(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function O(f){return Function.toString.call(f).indexOf("[native code]")!==-1}function p(f,t){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(h,v){return h.__proto__=v,h},p(f,t)}function T(f){return T=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},T(f)}var S=Math.pow(2,17),E=function(){function f(a){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=a}var t=f.prototype;return t.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},t.abort=function(){this.loader&&this.loader.abort()},t.load=function(h,v){var i=this,r=h.url;if(!r)return Promise.reject(new g({type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:h,networkDetails:null},"Fragment does not have a "+(r?"part list":"url")));this.abort();var o=this.config,d=o.fLoader,e=o.loader;return new Promise(function(s,l){i.loader&&i.loader.destroy();var n=i.loader=h.loader=d?new d(o):new e(o),u=m(h),c={timeout:o.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:o.fragLoadingMaxRetryTimeout,highWaterMark:h.sn==="initSegment"?1/0:S};h.stats=n.stats,n.load(u,c,{onSuccess:function(L,P,B,x){i.resetLoader(h,n),s({frag:h,part:null,payload:L.data,networkDetails:x})},onError:function(L,P,B){i.resetLoader(h,n),l(new g({type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:h,response:L,networkDetails:B}))},onAbort:function(L,P,B){i.resetLoader(h,n),l(new g({type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:h,networkDetails:B}))},onTimeout:function(L,P,B){i.resetLoader(h,n),l(new g({type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:h,networkDetails:B}))},onProgress:function(L,P,B,x){v&&v({frag:h,part:null,payload:B,networkDetails:x})}})})},t.loadPart=function(h,v,i){var r=this;this.abort();var o=this.config,d=o.fLoader,e=o.loader;return new Promise(function(s,l){r.loader&&r.loader.destroy();var n=r.loader=h.loader=d?new d(o):new e(o),u=m(h,v),c={timeout:o.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:o.fragLoadingMaxRetryTimeout,highWaterMark:S};v.stats=n.stats,n.load(u,c,{onSuccess:function(L,P,B,x){r.resetLoader(h,n),r.updateStatsFromPart(h,v);var U={frag:h,part:v,payload:L.data,networkDetails:x};i(U),s(U)},onError:function(L,P,B){r.resetLoader(h,n),l(new g({type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:h,part:v,response:L,networkDetails:B}))},onAbort:function(L,P,B){h.stats.aborted=v.stats.aborted,r.resetLoader(h,n),l(new g({type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:h,part:v,networkDetails:B}))},onTimeout:function(L,P,B){r.resetLoader(h,n),l(new g({type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:h,part:v,networkDetails:B}))}})})},t.updateStatsFromPart=function(h,v){var i=h.stats,r=v.stats,o=r.total;if(i.loaded+=r.loaded,o){var d=Math.round(h.duration/v.duration),e=Math.min(Math.round(i.loaded/o),d),s=d-e,l=s*Math.round(i.loaded/e);i.total=i.loaded+l}else i.total=Math.max(i.loaded,i.total);var n=i.loading,u=r.loading;n.start?n.first+=u.first-u.start:(n.start=u.start,n.first=u.first),n.end=u.end},t.resetLoader=function(h,v){h.loader=null,this.loader===v&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),v.destroy()},f}();function m(f,t){t===void 0&&(t=null);var a=t||f,h={frag:f,part:t,responseType:"arraybuffer",url:a.url,headers:{},rangeStart:0,rangeEnd:0},v=a.byteRangeStartOffset,i=a.byteRangeEndOffset;return Object(M.isFiniteNumber)(v)&&Object(M.isFiniteNumber)(i)&&(h.rangeStart=v,h.rangeEnd=i),h}var g=function(f){A(t,f);function t(a){for(var h,v=arguments.length,i=new Array(v>1?v-1:0),r=1;r<v;r++)i[r-1]=arguments[r];return h=f.call.apply(f,[this].concat(i))||this,h.data=void 0,h.data=a,h}return t}(F(Error))},"./src/loader/fragment.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"ElementaryStreamTypes",function(){return E}),y.d(b,"BaseSegment",function(){return m}),y.d(b,"Fragment",function(){return g}),y.d(b,"Part",function(){return f});var M=y("./src/polyfills/number.ts"),I=y("./node_modules/url-toolkit/src/url-toolkit.js"),A=y.n(I),F=y("./src/utils/logger.ts"),C=y("./src/loader/level-key.ts"),R=y("./src/loader/load-stats.ts");function O(t,a){t.prototype=Object.create(a.prototype),t.prototype.constructor=t,p(t,a)}function p(t,a){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(v,i){return v.__proto__=i,v},p(t,a)}function T(t,a){for(var h=0;h<a.length;h++){var v=a[h];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(t,v.key,v)}}function S(t,a,h){return a&&T(t.prototype,a),h&&T(t,h),Object.defineProperty(t,"prototype",{writable:!1}),t}var E;(function(t){t.AUDIO="audio",t.VIDEO="video",t.AUDIOVIDEO="audiovideo"})(E||(E={}));var m=function(){function t(h){var v;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(v={},v[E.AUDIO]=null,v[E.VIDEO]=null,v[E.AUDIOVIDEO]=null,v),this.baseurl=h}var a=t.prototype;return a.setByteRange=function(v,i){var r=v.split("@",2),o=[];r.length===1?o[0]=i?i.byteRangeEndOffset:0:o[0]=parseInt(r[1]),o[1]=parseInt(r[0])+o[0],this._byteRange=o},S(t,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(I.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(v){this._url=v}}]),t}(),g=function(t){O(a,t);function a(v,i){var r;return r=t.call(this,i)||this,r._decryptdata=null,r.rawProgramDateTime=null,r.programDateTime=null,r.tagList=[],r.duration=0,r.sn=0,r.levelkey=void 0,r.type=void 0,r.loader=null,r.level=-1,r.cc=0,r.startPTS=void 0,r.endPTS=void 0,r.appendedPTS=void 0,r.startDTS=void 0,r.endDTS=void 0,r.start=0,r.deltaPTS=void 0,r.maxStartPTS=void 0,r.minEndPTS=void 0,r.stats=new R.LoadStats,r.urlId=0,r.data=void 0,r.bitrateTest=!1,r.title=null,r.initSegment=null,r.type=v,r}var h=a.prototype;return h.createInitializationVector=function(i){for(var r=new Uint8Array(16),o=12;o<16;o++)r[o]=i>>8*(15-o)&255;return r},h.setDecryptDataFromLevelKey=function(i,r){var o=i;return i?.method==="AES-128"&&i.uri&&!i.iv&&(o=C.LevelKey.fromURI(i.uri),o.method=i.method,o.iv=this.createInitializationVector(r),o.keyFormat="identity"),o},h.setElementaryStreamInfo=function(i,r,o,d,e,s){s===void 0&&(s=!1);var l=this.elementaryStreams,n=l[i];if(!n){l[i]={startPTS:r,endPTS:o,startDTS:d,endDTS:e,partial:s};return}n.startPTS=Math.min(n.startPTS,r),n.endPTS=Math.max(n.endPTS,o),n.startDTS=Math.min(n.startDTS,d),n.endDTS=Math.max(n.endDTS,e)},h.clearElementaryStreamInfo=function(){var i=this.elementaryStreams;i[E.AUDIO]=null,i[E.VIDEO]=null,i[E.AUDIOVIDEO]=null},S(a,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var i=this.sn;typeof i!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&F.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),i=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,i)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(M.isFiniteNumber)(this.programDateTime))return null;var i=Object(M.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+i*1e3}},{key:"encrypted",get:function(){var i;return!!((i=this.decryptdata)!==null&&i!==void 0&&i.keyFormat&&this.decryptdata.uri)}}]),a}(m),f=function(t){O(a,t);function a(h,v,i,r,o){var d;d=t.call(this,i)||this,d.fragOffset=0,d.duration=0,d.gap=!1,d.independent=!1,d.relurl=void 0,d.fragment=void 0,d.index=void 0,d.stats=new R.LoadStats,d.duration=h.decimalFloatingPoint("DURATION"),d.gap=h.bool("GAP"),d.independent=h.bool("INDEPENDENT"),d.relurl=h.enumeratedString("URI"),d.fragment=v,d.index=r;var e=h.enumeratedString("BYTERANGE");return e&&d.setByteRange(e,o),o&&(d.fragOffset=o.fragOffset+o.duration),d}return S(a,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var v=this.elementaryStreams;return!!(v.audio||v.video||v.audiovideo)}}]),a}(m)},"./src/loader/key-loader.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"default",function(){return F});var M=y("./src/events.ts"),I=y("./src/errors.ts"),A=y("./src/utils/logger.ts"),F=function(){function C(O){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=O,this.registerListeners()}var R=C.prototype;return R.startLoad=function(p){},R.stopLoad=function(){this.destroyInternalLoaders()},R.registerListeners=function(){this.hls.on(M.Events.KEY_LOADING,this.onKeyLoading,this)},R.unregisterListeners=function(){this.hls.off(M.Events.KEY_LOADING,this.onKeyLoading)},R.destroyInternalLoaders=function(){for(var p in this.loaders){var T=this.loaders[p];T&&T.destroy()}this.loaders={}},R.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},R.onKeyLoading=function(p,T){var S=T.frag,E=S.type,m=this.loaders[E];if(!S.decryptdata){A.logger.warn("Missing decryption data on fragment in onKeyLoading");return}var g=S.decryptdata.uri;if(g!==this.decrypturl||this.decryptkey===null){var f=this.hls.config;if(m&&(A.logger.warn("abort previous key loader for type:"+E),m.abort()),!g){A.logger.warn("key uri is falsy");return}var t=f.loader,a=S.loader=this.loaders[E]=new t(f);this.decrypturl=g,this.decryptkey=null;var h={url:g,frag:S,responseType:"arraybuffer"},v={timeout:f.fragLoadingTimeOut,maxRetry:0,retryDelay:f.fragLoadingRetryDelay,maxRetryDelay:f.fragLoadingMaxRetryTimeout,highWaterMark:0},i={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};a.load(h,v,i)}else this.decryptkey&&(S.decryptdata.key=this.decryptkey,this.hls.trigger(M.Events.KEY_LOADED,{frag:S}))},R.loadsuccess=function(p,T,S){var E=S.frag;if(!E.decryptdata){A.logger.error("after key load, decryptdata unset");return}this.decryptkey=E.decryptdata.key=new Uint8Array(p.data),E.loader=null,delete this.loaders[E.type],this.hls.trigger(M.Events.KEY_LOADED,{frag:E})},R.loaderror=function(p,T){var S=T.frag,E=S.loader;E&&E.abort(),delete this.loaders[S.type],this.hls.trigger(M.Events.ERROR,{type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:S,response:p})},R.loadtimeout=function(p,T){var S=T.frag,E=S.loader;E&&E.abort(),delete this.loaders[S.type],this.hls.trigger(M.Events.ERROR,{type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:S})},C}()},"./src/loader/level-details.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"LevelDetails",function(){return C});var M=y("./src/polyfills/number.ts");function I(R,O){for(var p=0;p<O.length;p++){var T=O[p];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(R,T.key,T)}}function A(R,O,p){return O&&I(R.prototype,O),p&&I(R,p),Object.defineProperty(R,"prototype",{writable:!1}),R}var F=10,C=function(){function R(p){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.dateRanges={},this.url=p}var O=R.prototype;return O.reloaded=function(T){if(!T){this.advanced=!0,this.updated=!0;return}var S=this.lastPartSn-T.lastPartSn,E=this.lastPartIndex-T.lastPartIndex;this.updated=this.endSN!==T.endSN||!!E||!!S,this.advanced=this.endSN>T.endSN||S>0||S===0&&E>0,this.updated||this.advanced?this.misses=Math.floor(T.misses*.6):this.misses=T.misses+1,this.availabilityDelay=T.availabilityDelay},A(R,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?Object(M.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||F}},{key:"drift",get:function(){var T=this.driftEndTime-this.driftStartTime;if(T>0){var S=this.driftEnd-this.driftStart;return S*1e3/T}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var T;return(T=this.partList)!==null&&T!==void 0&&T.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var T;return(T=this.fragments)!==null&&T!==void 0&&T.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var T;return(T=this.partList)!==null&&T!==void 0&&T.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var T;return(T=this.partList)!==null&&T!==void 0&&T.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),R}()},"./src/loader/level-key.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"LevelKey",function(){return C});var M=y("./node_modules/url-toolkit/src/url-toolkit.js"),I=y.n(M);function A(R,O){for(var p=0;p<O.length;p++){var T=O[p];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(R,T.key,T)}}function F(R,O,p){return O&&A(R.prototype,O),p&&A(R,p),Object.defineProperty(R,"prototype",{writable:!1}),R}var C=function(){R.fromURL=function(p,T){return new R(p,T)},R.fromURI=function(p){return new R(p)};function R(O,p){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,p?this._uri=Object(M.buildAbsoluteURL)(O,p,{alwaysNormalize:!0}):this._uri=O}return F(R,[{key:"uri",get:function(){return this._uri}}]),R}()},"./src/loader/load-stats.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"LoadStats",function(){return M});var M=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"default",function(){return h});var M=y("./src/polyfills/number.ts"),I=y("./node_modules/url-toolkit/src/url-toolkit.js"),A=y.n(I),F=y("./src/loader/date-range.ts"),C=y("./src/loader/fragment.ts"),R=y("./src/loader/level-details.ts"),O=y("./src/loader/level-key.ts"),p=y("./src/utils/attr-list.ts"),T=y("./src/utils/logger.ts"),S=y("./src/utils/codecs.ts"),E=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,m=/#EXT-X-MEDIA:(.*)/g,g=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),f=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),t=/\.(mp4|m4s|m4v|m4a)$/i;function a(e){var s,l;return t.test((s=(l=I.parseURL(e))===null||l===void 0?void 0:l.path)!=null?s:"")}var h=function(){function e(){}return e.findGroup=function(l,n){for(var u=0;u<l.length;u++){var c=l[u];if(c.id===n)return c}},e.convertAVC1ToAVCOTI=function(l){var n=l.split(".");if(n.length>2){var u=n.shift()+".";return u+=parseInt(n.shift()).toString(16),u+=("000"+parseInt(n.shift()).toString(16)).slice(-4),u}return l},e.resolve=function(l,n){return I.buildAbsoluteURL(n,l,{alwaysNormalize:!0})},e.parseMasterPlaylist=function(l,n){var u=[],c=[],D={},L=!1;E.lastIndex=0;for(var P;(P=E.exec(l))!=null;)if(P[1]){var B,x=new p.AttrList(P[1]),U={attrs:x,bitrate:x.decimalInteger("AVERAGE-BANDWIDTH")||x.decimalInteger("BANDWIDTH"),name:x.NAME,url:e.resolve(P[2],n)},N=x.decimalResolution("RESOLUTION");N&&(U.width=N.width,U.height=N.height),v((x.CODECS||"").split(/[ ,]+/).filter(function(w){return w}),U),U.videoCodec&&U.videoCodec.indexOf("avc1")!==-1&&(U.videoCodec=e.convertAVC1ToAVCOTI(U.videoCodec)),(B=U.unknownCodecs)!==null&&B!==void 0&&B.length||c.push(U),u.push(U)}else if(P[3]){var k=new p.AttrList(P[3]);k["DATA-ID"]&&(L=!0,D[k["DATA-ID"]]=k)}var K=c.length>0&&c.length<u.length;return{levels:K?c:u,sessionData:L?D:null}},e.parseMasterPlaylistMedia=function(l,n,u,c){c===void 0&&(c=[]);var D,L=[],P=0;for(m.lastIndex=0;(D=m.exec(l))!==null;){var B=new p.AttrList(D[1]);if(B.TYPE===u){var x={attrs:B,bitrate:0,id:P++,groupId:B["GROUP-ID"],instreamId:B["INSTREAM-ID"],name:B.NAME||B.LANGUAGE||"",type:u,default:B.bool("DEFAULT"),autoselect:B.bool("AUTOSELECT"),forced:B.bool("FORCED"),lang:B.LANGUAGE,url:B.URI?e.resolve(B.URI,n):""};if(c.length){var U=e.findGroup(c,x.groupId)||c[0];i(x,U,"audioCodec"),i(x,U,"textCodec")}L.push(x)}}return L},e.parseLevelPlaylist=function(l,n,u,c,D){var L=new R.LevelDetails(n),P=L.fragments,B=null,x=0,U=0,N=0,k=0,K=null,w=new C.Fragment(c,n),W,H,j,Y=-1,X=!1;for(g.lastIndex=0,L.m3u8=l;(W=g.exec(l))!==null;){X&&(X=!1,w=new C.Fragment(c,n),w.start=N,w.sn=x,w.cc=k,w.level=u,B&&(w.initSegment=B,w.rawProgramDateTime=B.rawProgramDateTime,B.rawProgramDateTime=null));var z=W[1];if(z){w.duration=parseFloat(z);var _=(" "+W[2]).slice(1);w.title=_||null,w.tagList.push(_?["INF",z,_]:["INF",z])}else if(W[3])Object(M.isFiniteNumber)(w.duration)&&(w.start=N,j&&(w.levelkey=j),w.sn=x,w.level=u,w.cc=k,w.urlId=D,P.push(w),w.relurl=(" "+W[3]).slice(1),o(w,K),K=w,N+=w.duration,x++,U=0,X=!0);else if(W[4]){var Q=(" "+W[4]).slice(1);K?w.setByteRange(Q,K):w.setByteRange(Q)}else if(W[5])w.rawProgramDateTime=(" "+W[5]).slice(1),w.tagList.push(["PROGRAM-DATE-TIME",w.rawProgramDateTime]),Y===-1&&(Y=P.length);else{if(W=W[0].match(f),!W){T.logger.warn("No matches on slow regex match for level playlist!");continue}for(H=1;H<W.length&&!(typeof W[H]<"u");H++);var $=(" "+W[H]).slice(1),V=(" "+W[H+1]).slice(1),J=W[H+2]?(" "+W[H+2]).slice(1):"";switch($){case"PLAYLIST-TYPE":L.type=V.toUpperCase();break;case"MEDIA-SEQUENCE":x=L.startSN=parseInt(V);break;case"SKIP":{var Z=new p.AttrList(V),q=Z.decimalInteger("SKIPPED-SEGMENTS");if(Object(M.isFiniteNumber)(q)){L.skippedSegments=q;for(var ot=q;ot--;)P.unshift(null);x+=q}var tt=Z.enumeratedString("RECENTLY-REMOVED-DATERANGES");tt&&(L.recentlyRemovedDateranges=tt.split("	"));break}case"TARGETDURATION":L.targetduration=parseFloat(V);break;case"VERSION":L.version=parseInt(V);break;case"EXTM3U":break;case"ENDLIST":L.live=!1;break;case"#":(V||J)&&w.tagList.push(J?[V,J]:[V]);break;case"DISCONTINUITY":k++,w.tagList.push(["DIS"]);break;case"GAP":w.tagList.push([$]);break;case"BITRATE":w.tagList.push([$,V]);break;case"DATERANGE":{var ut=new p.AttrList(V),nt=new F.DateRange(ut,L.dateRanges[ut.ID]);nt.isValid||L.skippedSegments?L.dateRanges[nt.id]=nt:T.logger.warn('Ignoring invalid DATERANGE tag: "'+V+'"'),w.tagList.push(["EXT-X-DATERANGE",V]);break}case"DISCONTINUITY-SEQUENCE":k=parseInt(V);break;case"KEY":{var ft,rt=new p.AttrList(V),ht=rt.enumeratedString("METHOD"),ct=rt.URI,gt=rt.hexadecimalInteger("IV"),dt=rt.enumeratedString("KEYFORMATVERSIONS"),Tt=rt.enumeratedString("KEYID"),lt=(ft=rt.enumeratedString("KEYFORMAT"))!=null?ft:"identity",yt=["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"];if(yt.indexOf(lt)>-1){T.logger.warn("Keyformat "+lt+" is not supported from the manifest");continue}else if(lt!=="identity")continue;ht&&(j=O.LevelKey.fromURL(n,ct),ct&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(ht)>=0&&(j.method=ht,j.keyFormat=lt,Tt&&(j.keyID=Tt),dt&&(j.keyFormatVersions=dt),j.iv=gt));break}case"START":{var it=new p.AttrList(V),st=it.decimalFloatingPoint("TIME-OFFSET");Object(M.isFiniteNumber)(st)&&(L.startTimeOffset=st);break}case"MAP":{var mt=new p.AttrList(V);if(w.duration){var at=new C.Fragment(c,n);d(at,mt,u,j),B=at,w.initSegment=B,B.rawProgramDateTime&&!w.rawProgramDateTime&&(w.rawProgramDateTime=B.rawProgramDateTime)}else d(w,mt,u,j),B=w,X=!0;break}case"SERVER-CONTROL":{var et=new p.AttrList(V);L.canBlockReload=et.bool("CAN-BLOCK-RELOAD"),L.canSkipUntil=et.optionalFloat("CAN-SKIP-UNTIL",0),L.canSkipDateRanges=L.canSkipUntil>0&&et.bool("CAN-SKIP-DATERANGES"),L.partHoldBack=et.optionalFloat("PART-HOLD-BACK",0),L.holdBack=et.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var St=new p.AttrList(V);L.partTarget=St.decimalFloatingPoint("PART-TARGET");break}case"PART":{var vt=L.partList;vt||(vt=L.partList=[]);var At=U>0?vt[vt.length-1]:void 0,Rt=U++,Et=new C.Part(new p.AttrList(V),w,n,Rt,At);vt.push(Et),w.duration+=Et.duration;break}case"PRELOAD-HINT":{var bt=new p.AttrList(V);L.preloadHint=bt;break}case"RENDITION-REPORT":{var Pt=new p.AttrList(V);L.renditionReports=L.renditionReports||[],L.renditionReports.push(Pt);break}default:T.logger.warn("line parsed but not handled: "+W);break}}}K&&!K.relurl?(P.pop(),N-=K.duration,L.partList&&(L.fragmentHint=K)):L.partList&&(o(w,K),w.cc=k,L.fragmentHint=w);var Lt=P.length,Ot=P[0],Dt=P[Lt-1];if(N+=L.skippedSegments*L.targetduration,N>0&&Lt&&Dt){L.averagetargetduration=N/Lt;var Mt=Dt.sn;L.endSN=Mt!=="initSegment"?Mt:0,Ot&&(L.startCC=Ot.cc,Ot.initSegment||L.fragments.every(function(It){return It.relurl&&a(It.relurl)})&&(T.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),w=new C.Fragment(c,n),w.relurl=Dt.relurl,w.level=u,w.sn="initSegment",Ot.initSegment=w,L.needSidxRanges=!0))}else L.endSN=0,L.startCC=0;return L.fragmentHint&&(N+=L.fragmentHint.duration),L.totalduration=N,L.endCC=k,Y>0&&r(P,Y),L},e}();function v(e,s){["video","audio","text"].forEach(function(l){var n=e.filter(function(c){return Object(S.isCodecType)(c,l)});if(n.length){var u=n.filter(function(c){return c.lastIndexOf("avc1",0)===0||c.lastIndexOf("mp4a",0)===0});s[l+"Codec"]=u.length>0?u[0]:n[0],e=e.filter(function(c){return n.indexOf(c)===-1})}}),s.unknownCodecs=e}function i(e,s,l){var n=s[l];n&&(e[l]=n)}function r(e,s){for(var l=e[s],n=s;n--;){var u=e[n];if(!u)return;u.programDateTime=l.programDateTime-u.duration*1e3,l=u}}function o(e,s){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):s!=null&&s.programDateTime&&(e.programDateTime=s.endProgramDateTime),Object(M.isFiniteNumber)(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}function d(e,s,l,n){e.relurl=s.URI,s.BYTERANGE&&e.setByteRange(s.BYTERANGE),e.level=l,e.sn="initSegment",n&&(e.levelkey=n),e.initSegment=null}},"./src/loader/playlist-loader.ts":function(G,b,y){"use strict";y.r(b);var M=y("./src/polyfills/number.ts"),I=y("./src/events.ts"),A=y("./src/errors.ts"),F=y("./src/utils/logger.ts"),C=y("./src/utils/mp4-tools.ts"),R=y("./src/loader/m3u8-parser.ts"),O=y("./src/types/loader.ts"),p=y("./src/utils/attr-list.ts");function T(m){var g=m.type;switch(g){case O.PlaylistContextType.AUDIO_TRACK:return O.PlaylistLevelType.AUDIO;case O.PlaylistContextType.SUBTITLE_TRACK:return O.PlaylistLevelType.SUBTITLE;default:return O.PlaylistLevelType.MAIN}}function S(m,g){var f=m.url;return(f===void 0||f.indexOf("data:")===0)&&(f=g.url),f}var E=function(){function m(f){this.hls=void 0,this.loaders=Object.create(null),this.hls=f,this.registerListeners()}var g=m.prototype;return g.startLoad=function(t){},g.stopLoad=function(){this.destroyInternalLoaders()},g.registerListeners=function(){var t=this.hls;t.on(I.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(I.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(I.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.on(I.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},g.unregisterListeners=function(){var t=this.hls;t.off(I.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(I.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(I.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.off(I.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},g.createInternalLoader=function(t){var a=this.hls.config,h=a.pLoader,v=a.loader,i=h||v,r=new i(a);return t.loader=r,this.loaders[t.type]=r,r},g.getInternalLoader=function(t){return this.loaders[t.type]},g.resetInternalLoader=function(t){this.loaders[t]&&delete this.loaders[t]},g.destroyInternalLoaders=function(){for(var t in this.loaders){var a=this.loaders[t];a&&a.destroy(),this.resetInternalLoader(t)}},g.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},g.onManifestLoading=function(t,a){var h=a.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:O.PlaylistContextType.MANIFEST,url:h,deliveryDirectives:null})},g.onLevelLoading=function(t,a){var h=a.id,v=a.level,i=a.url,r=a.deliveryDirectives;this.load({id:h,groupId:null,level:v,responseType:"text",type:O.PlaylistContextType.LEVEL,url:i,deliveryDirectives:r})},g.onAudioTrackLoading=function(t,a){var h=a.id,v=a.groupId,i=a.url,r=a.deliveryDirectives;this.load({id:h,groupId:v,level:null,responseType:"text",type:O.PlaylistContextType.AUDIO_TRACK,url:i,deliveryDirectives:r})},g.onSubtitleTrackLoading=function(t,a){var h=a.id,v=a.groupId,i=a.url,r=a.deliveryDirectives;this.load({id:h,groupId:v,level:null,responseType:"text",type:O.PlaylistContextType.SUBTITLE_TRACK,url:i,deliveryDirectives:r})},g.load=function(t){var a,h=this.hls.config,v=this.getInternalLoader(t);if(v){var i=v.context;if(i&&i.url===t.url){F.logger.trace("[playlist-loader]: playlist request ongoing");return}F.logger.log("[playlist-loader]: aborting previous loader for type: "+t.type),v.abort()}var r,o,d,e;switch(t.type){case O.PlaylistContextType.MANIFEST:r=h.manifestLoadingMaxRetry,o=h.manifestLoadingTimeOut,d=h.manifestLoadingRetryDelay,e=h.manifestLoadingMaxRetryTimeout;break;case O.PlaylistContextType.LEVEL:case O.PlaylistContextType.AUDIO_TRACK:case O.PlaylistContextType.SUBTITLE_TRACK:r=0,o=h.levelLoadingTimeOut;break;default:r=h.levelLoadingMaxRetry,o=h.levelLoadingTimeOut,d=h.levelLoadingRetryDelay,e=h.levelLoadingMaxRetryTimeout;break}if(v=this.createInternalLoader(t),(a=t.deliveryDirectives)!==null&&a!==void 0&&a.part){var s;if(t.type===O.PlaylistContextType.LEVEL&&t.level!==null?s=this.hls.levels[t.level].details:t.type===O.PlaylistContextType.AUDIO_TRACK&&t.id!==null?s=this.hls.audioTracks[t.id].details:t.type===O.PlaylistContextType.SUBTITLE_TRACK&&t.id!==null&&(s=this.hls.subtitleTracks[t.id].details),s){var l=s.partTarget,n=s.targetduration;l&&n&&(o=Math.min(Math.max(l*3,n*.8)*1e3,o))}}var u={timeout:o,maxRetry:r,retryDelay:d,maxRetryDelay:e,highWaterMark:0},c={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};v.load(t,u,c)},g.loadsuccess=function(t,a,h,v){if(v===void 0&&(v=null),h.isSidxRequest){this.handleSidxRequest(t,h),this.handlePlaylistLoaded(t,a,h,v);return}this.resetInternalLoader(h.type);var i=t.data;if(i.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(t,h,"no EXTM3U delimiter",v);return}a.parsing.start=performance.now(),i.indexOf("#EXTINF:")>0||i.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(t,a,h,v):this.handleMasterPlaylist(t,a,h,v)},g.loaderror=function(t,a,h){h===void 0&&(h=null),this.handleNetworkError(a,h,!1,t)},g.loadtimeout=function(t,a,h){h===void 0&&(h=null),this.handleNetworkError(a,h,!0)},g.handleMasterPlaylist=function(t,a,h,v){var i=this.hls,r=t.data,o=S(t,h),d=R.default.parseMasterPlaylist(r,o),e=d.levels,s=d.sessionData;if(!e.length){this.handleManifestParsingError(t,h,"no level found in manifest",v);return}var l=e.map(function(P){return{id:P.attrs.AUDIO,audioCodec:P.audioCodec}}),n=e.map(function(P){return{id:P.attrs.SUBTITLES,textCodec:P.textCodec}}),u=R.default.parseMasterPlaylistMedia(r,o,"AUDIO",l),c=R.default.parseMasterPlaylistMedia(r,o,"SUBTITLES",n),D=R.default.parseMasterPlaylistMedia(r,o,"CLOSED-CAPTIONS");if(u.length){var L=u.some(function(P){return!P.url});!L&&e[0].audioCodec&&!e[0].attrs.AUDIO&&(F.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),u.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new p.AttrList({}),bitrate:0,url:""}))}i.trigger(I.Events.MANIFEST_LOADED,{levels:e,audioTracks:u,subtitles:c,captions:D,url:o,stats:a,networkDetails:v,sessionData:s})},g.handleTrackOrLevelPlaylist=function(t,a,h,v){var i=this.hls,r=h.id,o=h.level,d=h.type,e=S(t,h),s=Object(M.isFiniteNumber)(r)?r:0,l=Object(M.isFiniteNumber)(o)?o:s,n=T(h),u=R.default.parseLevelPlaylist(t.data,e,l,n,s);if(!u.fragments.length){i.trigger(I.Events.ERROR,{type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:e,reason:"no fragments found in level",level:typeof h.level=="number"?h.level:void 0});return}if(d===O.PlaylistContextType.MANIFEST){var c={attrs:new p.AttrList({}),bitrate:0,details:u,name:"",url:e};i.trigger(I.Events.MANIFEST_LOADED,{levels:[c],audioTracks:[],url:e,stats:a,networkDetails:v,sessionData:null})}if(a.parsing.end=performance.now(),u.needSidxRanges){var D,L=(D=u.fragments[0].initSegment)===null||D===void 0?void 0:D.url;this.load({url:L,isSidxRequest:!0,type:d,level:o,levelDetails:u,id:r,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null});return}h.levelDetails=u,this.handlePlaylistLoaded(t,a,h,v)},g.handleSidxRequest=function(t,a){var h=new Uint8Array(t.data),v=Object(C.findBox)(h,["sidx"])[0];if(!!v){var i=Object(C.parseSegmentIndex)(v);if(!!i){var r=i.references,o=a.levelDetails;r.forEach(function(d,e){var s=d.info,l=o.fragments[e];if(l.byteRange.length===0&&l.setByteRange(String(1+s.end-s.start)+"@"+String(s.start)),l.initSegment){var n=Object(C.findBox)(h,["moov"])[0],u=n?n.length:null;l.initSegment.setByteRange(String(u)+"@0")}})}}},g.handleManifestParsingError=function(t,a,h,v){this.hls.trigger(I.Events.ERROR,{type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:a.type===O.PlaylistContextType.MANIFEST,url:t.url,reason:h,response:t,context:a,networkDetails:v})},g.handleNetworkError=function(t,a,h,v){h===void 0&&(h=!1),F.logger.warn("[playlist-loader]: A network "+(h?"timeout":"error")+" occurred while loading "+t.type+" level: "+t.level+" id: "+t.id+' group-id: "'+t.groupId+'"');var i=A.ErrorDetails.UNKNOWN,r=!1,o=this.getInternalLoader(t);switch(t.type){case O.PlaylistContextType.MANIFEST:i=h?A.ErrorDetails.MANIFEST_LOAD_TIMEOUT:A.ErrorDetails.MANIFEST_LOAD_ERROR,r=!0;break;case O.PlaylistContextType.LEVEL:i=h?A.ErrorDetails.LEVEL_LOAD_TIMEOUT:A.ErrorDetails.LEVEL_LOAD_ERROR,r=!1;break;case O.PlaylistContextType.AUDIO_TRACK:i=h?A.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:A.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,r=!1;break;case O.PlaylistContextType.SUBTITLE_TRACK:i=h?A.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:A.ErrorDetails.SUBTITLE_LOAD_ERROR,r=!1;break}o&&this.resetInternalLoader(t.type);var d={type:A.ErrorTypes.NETWORK_ERROR,details:i,fatal:r,url:t.url,loader:o,context:t,networkDetails:a};v&&(d.response=v),this.hls.trigger(I.Events.ERROR,d)},g.handlePlaylistLoaded=function(t,a,h,v){var i=h.type,r=h.level,o=h.id,d=h.groupId,e=h.loader,s=h.levelDetails,l=h.deliveryDirectives;if(!(s!=null&&s.targetduration)){this.handleManifestParsingError(t,h,"invalid target duration",v);return}if(!!e)switch(s.live&&(e.getCacheAge&&(s.ageHeader=e.getCacheAge()||0),(!e.getCacheAge||isNaN(s.ageHeader))&&(s.ageHeader=0)),i){case O.PlaylistContextType.MANIFEST:case O.PlaylistContextType.LEVEL:this.hls.trigger(I.Events.LEVEL_LOADED,{details:s,level:r||0,id:o||0,stats:a,networkDetails:v,deliveryDirectives:l});break;case O.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(I.Events.AUDIO_TRACK_LOADED,{details:s,id:o||0,groupId:d||"",stats:a,networkDetails:v,deliveryDirectives:l});break;case O.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(I.Events.SUBTITLE_TRACK_LOADED,{details:s,id:o||0,groupId:d||"",stats:a,networkDetails:v,deliveryDirectives:l});break}},m}();b.default=E},"./src/polyfills/number.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"isFiniteNumber",function(){return M}),y.d(b,"MAX_SAFE_INTEGER",function(){return I});var M=Number.isFinite||function(A){return typeof A=="number"&&isFinite(A)},I=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(G,b,y){"use strict";y.r(b);var M=function(){function I(){}return I.getSilentFrame=function(F,C){switch(F){case"mp4a.40.2":if(C===1)return new Uint8Array([0,200,0,128,35,128]);if(C===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(C===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(C===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(C===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(C===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(C===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(C===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(C===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},I}();b.default=M},"./src/remux/mp4-generator.ts":function(G,b,y){"use strict";y.r(b);var M=Math.pow(2,32)-1,I=function(){function A(){}return A.init=function(){A.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var C;for(C in A.types)A.types.hasOwnProperty(C)&&(A.types[C]=[C.charCodeAt(0),C.charCodeAt(1),C.charCodeAt(2),C.charCodeAt(3)]);var R=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),O=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);A.HDLR_TYPES={video:R,audio:O};var p=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),T=new Uint8Array([0,0,0,0,0,0,0,0]);A.STTS=A.STSC=A.STCO=T,A.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),A.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),A.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),A.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var S=new Uint8Array([105,115,111,109]),E=new Uint8Array([97,118,99,49]),m=new Uint8Array([0,0,0,1]);A.FTYP=A.box(A.types.ftyp,S,m,S,E),A.DINF=A.box(A.types.dinf,A.box(A.types.dref,p))},A.box=function(C){for(var R=8,O=arguments.length,p=new Array(O>1?O-1:0),T=1;T<O;T++)p[T-1]=arguments[T];for(var S=p.length,E=S;S--;)R+=p[S].byteLength;var m=new Uint8Array(R);for(m[0]=R>>24&255,m[1]=R>>16&255,m[2]=R>>8&255,m[3]=R&255,m.set(C,4),S=0,R=8;S<E;S++)m.set(p[S],R),R+=p[S].byteLength;return m},A.hdlr=function(C){return A.box(A.types.hdlr,A.HDLR_TYPES[C])},A.mdat=function(C){return A.box(A.types.mdat,C)},A.mdhd=function(C,R){R*=C;var O=Math.floor(R/(M+1)),p=Math.floor(R%(M+1));return A.box(A.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,C>>24&255,C>>16&255,C>>8&255,C&255,O>>24,O>>16&255,O>>8&255,O&255,p>>24,p>>16&255,p>>8&255,p&255,85,196,0,0]))},A.mdia=function(C){return A.box(A.types.mdia,A.mdhd(C.timescale,C.duration),A.hdlr(C.type),A.minf(C))},A.mfhd=function(C){return A.box(A.types.mfhd,new Uint8Array([0,0,0,0,C>>24,C>>16&255,C>>8&255,C&255]))},A.minf=function(C){return C.type==="audio"?A.box(A.types.minf,A.box(A.types.smhd,A.SMHD),A.DINF,A.stbl(C)):A.box(A.types.minf,A.box(A.types.vmhd,A.VMHD),A.DINF,A.stbl(C))},A.moof=function(C,R,O){return A.box(A.types.moof,A.mfhd(C),A.traf(O,R))},A.moov=function(C){for(var R=C.length,O=[];R--;)O[R]=A.trak(C[R]);return A.box.apply(null,[A.types.moov,A.mvhd(C[0].timescale,C[0].duration)].concat(O).concat(A.mvex(C)))},A.mvex=function(C){for(var R=C.length,O=[];R--;)O[R]=A.trex(C[R]);return A.box.apply(null,[A.types.mvex].concat(O))},A.mvhd=function(C,R){R*=C;var O=Math.floor(R/(M+1)),p=Math.floor(R%(M+1)),T=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,C>>24&255,C>>16&255,C>>8&255,C&255,O>>24,O>>16&255,O>>8&255,O&255,p>>24,p>>16&255,p>>8&255,p&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return A.box(A.types.mvhd,T)},A.sdtp=function(C){var R=C.samples||[],O=new Uint8Array(4+R.length),p,T;for(p=0;p<R.length;p++)T=R[p].flags,O[p+4]=T.dependsOn<<4|T.isDependedOn<<2|T.hasRedundancy;return A.box(A.types.sdtp,O)},A.stbl=function(C){return A.box(A.types.stbl,A.stsd(C),A.box(A.types.stts,A.STTS),A.box(A.types.stsc,A.STSC),A.box(A.types.stsz,A.STSZ),A.box(A.types.stco,A.STCO))},A.avc1=function(C){var R=[],O=[],p,T,S;for(p=0;p<C.sps.length;p++)T=C.sps[p],S=T.byteLength,R.push(S>>>8&255),R.push(S&255),R=R.concat(Array.prototype.slice.call(T));for(p=0;p<C.pps.length;p++)T=C.pps[p],S=T.byteLength,O.push(S>>>8&255),O.push(S&255),O=O.concat(Array.prototype.slice.call(T));var E=A.box(A.types.avcC,new Uint8Array([1,R[3],R[4],R[5],255,224|C.sps.length].concat(R).concat([C.pps.length]).concat(O))),m=C.width,g=C.height,f=C.pixelRatio[0],t=C.pixelRatio[1];return A.box(A.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,m>>8&255,m&255,g>>8&255,g&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),E,A.box(A.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),A.box(A.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,f&255,t>>24,t>>16&255,t>>8&255,t&255])))},A.esds=function(C){var R=C.config.length;return new Uint8Array([0,0,0,0,3,23+R,0,1,0,4,15+R,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([R]).concat(C.config).concat([6,1,2]))},A.mp4a=function(C){var R=C.samplerate;return A.box(A.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,C.channelCount,0,16,0,0,0,0,R>>8&255,R&255,0,0]),A.box(A.types.esds,A.esds(C)))},A.mp3=function(C){var R=C.samplerate;return A.box(A.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,C.channelCount,0,16,0,0,0,0,R>>8&255,R&255,0,0]))},A.stsd=function(C){return C.type==="audio"?C.segmentCodec==="mp3"&&C.codec==="mp3"?A.box(A.types.stsd,A.STSD,A.mp3(C)):A.box(A.types.stsd,A.STSD,A.mp4a(C)):A.box(A.types.stsd,A.STSD,A.avc1(C))},A.tkhd=function(C){var R=C.id,O=C.duration*C.timescale,p=C.width,T=C.height,S=Math.floor(O/(M+1)),E=Math.floor(O%(M+1));return A.box(A.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,R>>24&255,R>>16&255,R>>8&255,R&255,0,0,0,0,S>>24,S>>16&255,S>>8&255,S&255,E>>24,E>>16&255,E>>8&255,E&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,p>>8&255,p&255,0,0,T>>8&255,T&255,0,0]))},A.traf=function(C,R){var O=A.sdtp(C),p=C.id,T=Math.floor(R/(M+1)),S=Math.floor(R%(M+1));return A.box(A.types.traf,A.box(A.types.tfhd,new Uint8Array([0,0,0,0,p>>24,p>>16&255,p>>8&255,p&255])),A.box(A.types.tfdt,new Uint8Array([1,0,0,0,T>>24,T>>16&255,T>>8&255,T&255,S>>24,S>>16&255,S>>8&255,S&255])),A.trun(C,O.length+16+20+8+16+8+8),O)},A.trak=function(C){return C.duration=C.duration||4294967295,A.box(A.types.trak,A.tkhd(C),A.mdia(C))},A.trex=function(C){var R=C.id;return A.box(A.types.trex,new Uint8Array([0,0,0,0,R>>24,R>>16&255,R>>8&255,R&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},A.trun=function(C,R){var O=C.samples||[],p=O.length,T=12+16*p,S=new Uint8Array(T),E,m,g,f,t,a;for(R+=8+T,S.set([C.type==="video"?1:0,0,15,1,p>>>24&255,p>>>16&255,p>>>8&255,p&255,R>>>24&255,R>>>16&255,R>>>8&255,R&255],0),E=0;E<p;E++)m=O[E],g=m.duration,f=m.size,t=m.flags,a=m.cts,S.set([g>>>24&255,g>>>16&255,g>>>8&255,g&255,f>>>24&255,f>>>16&255,f>>>8&255,f&255,t.isLeading<<2|t.dependsOn,t.isDependedOn<<6|t.hasRedundancy<<4|t.paddingValue<<1|t.isNonSync,t.degradPrio&240<<8,t.degradPrio&15,a>>>24&255,a>>>16&255,a>>>8&255,a&255],12+16*E);return A.box(A.types.trun,S)},A.initSegment=function(C){A.types||A.init();var R=A.moov(C),O=new Uint8Array(A.FTYP.byteLength+R.byteLength);return O.set(A.FTYP),O.set(R,A.FTYP.byteLength),O},A}();I.types=void 0,I.HDLR_TYPES=void 0,I.STTS=void 0,I.STSC=void 0,I.STCO=void 0,I.STSZ=void 0,I.VMHD=void 0,I.SMHD=void 0,I.STSD=void 0,I.FTYP=void 0,I.DINF=void 0,b.default=I},"./src/remux/mp4-remuxer.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"default",function(){return t}),y.d(b,"normalizePts",function(){return a}),y.d(b,"flushTextTrackMetadataCueSamples",function(){return v}),y.d(b,"flushTextTrackUserdataCueSamples",function(){return i});var M=y("./src/polyfills/number.ts"),I=y("./src/remux/aac-helper.ts"),A=y("./src/remux/mp4-generator.ts"),F=y("./src/events.ts"),C=y("./src/errors.ts"),R=y("./src/utils/logger.ts"),O=y("./src/types/loader.ts"),p=y("./src/utils/timescale-conversion.ts");function T(){return T=Object.assign?Object.assign.bind():function(d){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var l in s)Object.prototype.hasOwnProperty.call(s,l)&&(d[l]=s[l])}return d},T.apply(this,arguments)}var S=10*1e3,E=1024,m=1152,g=null,f=null,t=function(){function d(s,l,n,u){if(u===void 0&&(u=""),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=s,this.config=l,this.typeSupported=n,this.ISGenerated=!1,g===null){var c=navigator.userAgent||"",D=c.match(/Chrome\/(\d+)/i);g=D?parseInt(D[1]):0}if(f===null){var L=navigator.userAgent.match(/Safari\/(\d+)/i);f=L?parseInt(L[1]):0}}var e=d.prototype;return e.destroy=function(){},e.resetTimeStamp=function(l){R.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=l},e.resetNextTimestamp=function(){R.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},e.resetInitSegment=function(){R.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},e.getVideoStartPts=function(l){var n=!1,u=l.reduce(function(c,D){var L=D.pts-c;return L<-4294967296?(n=!0,a(c,D.pts)):L>0?c:D.pts},l[0].pts);return n&&R.logger.debug("PTS rollover detected"),u},e.remux=function(l,n,u,c,D,L,P,B){var x,U,N,k,K,w,W=D,H=D,j=l.pid>-1,Y=n.pid>-1,X=n.samples.length,z=l.samples.length>0,_=P&&X>0||X>1,Q=(!j||z)&&(!Y||_)||this.ISGenerated||P;if(Q){this.ISGenerated||(N=this.generateIS(l,n,D));var $=this.isVideoContiguous,V=-1,J;if(_&&(V=h(n.samples),!$&&this.config.forceKeyFrameOnDiscontinuity))if(w=!0,V>0){R.logger.warn("[mp4-remuxer]: Dropped "+V+" out of "+X+" video samples due to a missing keyframe");var Z=this.getVideoStartPts(n.samples);n.samples=n.samples.slice(V),n.dropped+=V,H+=(n.samples[0].pts-Z)/n.inputTimeScale,J=H}else V===-1&&(R.logger.warn("[mp4-remuxer]: No keyframe found out of "+X+" video samples"),w=!1);if(this.ISGenerated){if(z&&_){var q=this.getVideoStartPts(n.samples),ot=a(l.samples[0].pts,q)-q,tt=ot/n.inputTimeScale;W+=Math.max(0,tt),H+=Math.max(0,-tt)}if(z){if(l.samplerate||(R.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),N=this.generateIS(l,n,D)),U=this.remuxAudio(l,W,this.isAudioContiguous,L,Y||_||B===O.PlaylistLevelType.AUDIO?H:void 0),_){var ut=U?U.endPTS-U.startPTS:0;n.inputTimeScale||(R.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),N=this.generateIS(l,n,D)),x=this.remuxVideo(n,H,$,ut)}}else _&&(x=this.remuxVideo(n,H,$,0));x&&(x.firstKeyFrame=V,x.independent=V!==-1,x.firstKeyFramePTS=J)}}return this.ISGenerated&&(u.samples.length&&(K=v(u,D,this._initPTS,this._initDTS)),c.samples.length&&(k=i(c,D,this._initPTS))),{audio:U,video:x,initSegment:N,independent:w,text:k,id3:K}},e.generateIS=function(l,n,u){var c=l.samples,D=n.samples,L=this.typeSupported,P={},B=!Object(M.isFiniteNumber)(this._initPTS),x="audio/mp4",U,N,k;if(B&&(U=N=1/0),l.config&&c.length){switch(l.timescale=l.samplerate,l.segmentCodec){case"mp3":L.mpeg?(x="audio/mpeg",l.codec=""):L.mp3&&(l.codec="mp3");break}P.audio={id:"audio",container:x,codec:l.codec,initSegment:l.segmentCodec==="mp3"&&L.mpeg?new Uint8Array(0):A.default.initSegment([l]),metadata:{channelCount:l.channelCount}},B&&(k=l.inputTimeScale,U=N=c[0].pts-Math.round(k*u))}if(n.sps&&n.pps&&D.length&&(n.timescale=n.inputTimeScale,P.video={id:"main",container:"video/mp4",codec:n.codec,initSegment:A.default.initSegment([n]),metadata:{width:n.width,height:n.height}},B)){k=n.inputTimeScale;var K=this.getVideoStartPts(D),w=Math.round(k*u);N=Math.min(N,a(D[0].dts,K)-w),U=Math.min(U,K-w)}if(Object.keys(P).length)return this.ISGenerated=!0,B&&(this._initPTS=U,this._initDTS=N),{tracks:P,initPTS:U,timescale:k}},e.remuxVideo=function(l,n,u,c){var D=l.inputTimeScale,L=l.samples,P=[],B=L.length,x=this._initPTS,U=this.nextAvcDts,N=8,k=this.videoSampleDuration,K,w,W=Number.POSITIVE_INFINITY,H=Number.NEGATIVE_INFINITY,j=!1;if(!u||U===null){var Y=n*D,X=L[0].pts-a(L[0].dts,L[0].pts);U=Y-X}for(var z=0;z<B;z++){var _=L[z];_.pts=a(_.pts-x,U),_.dts=a(_.dts-x,U),_.dts<L[z>0?z-1:z].dts&&(j=!0)}j&&L.sort(function(xt,kt){var _t=xt.dts-kt.dts,Vt=xt.pts-kt.pts;return _t||Vt}),K=L[0].dts,w=L[L.length-1].dts;var Q=w-K,$=Q?Math.round(Q/(B-1)):k||l.inputTimeScale/30;if(u){var V=K-U,J=V>$,Z=V<-1;if(J||Z){J?R.logger.warn("AVC: "+Object(p.toMsFromMpegTsClock)(V,!0)+" ms ("+V+"dts) hole between fragments detected, filling it"):R.logger.warn("AVC: "+Object(p.toMsFromMpegTsClock)(-V,!0)+" ms ("+V+"dts) overlapping between fragments detected"),K=U;var q=L[0].pts-V;L[0].dts=K,L[0].pts=q,R.logger.log("Video: First PTS/DTS adjusted: "+Object(p.toMsFromMpegTsClock)(q,!0)+"/"+Object(p.toMsFromMpegTsClock)(K,!0)+", delta: "+Object(p.toMsFromMpegTsClock)(V,!0)+" ms")}}K=Math.max(0,K);for(var ot=0,tt=0,ut=0;ut<B;ut++){for(var nt=L[ut],ft=nt.units,rt=ft.length,ht=0,ct=0;ct<rt;ct++)ht+=ft[ct].data.length;tt+=ht,ot+=rt,nt.length=ht,nt.dts=Math.max(nt.dts,K),W=Math.min(nt.pts,W),H=Math.max(nt.pts,H)}w=L[B-1].dts;var gt=tt+4*ot+8,dt;try{dt=new Uint8Array(gt)}catch{this.observer.emit(F.Events.ERROR,F.Events.ERROR,{type:C.ErrorTypes.MUX_ERROR,details:C.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:gt,reason:"fail allocating video mdat "+gt});return}var Tt=new DataView(dt.buffer);Tt.setUint32(0,gt),dt.set(A.default.types.mdat,4);for(var lt=!1,yt=Number.POSITIVE_INFINITY,it=Number.POSITIVE_INFINITY,st=Number.NEGATIVE_INFINITY,mt=Number.NEGATIVE_INFINITY,at=0;at<B;at++){for(var et=L[at],St=et.units,vt=0,At=0,Rt=St.length;At<Rt;At++){var Et=St[At],bt=Et.data,Pt=Et.data.byteLength;Tt.setUint32(N,Pt),N+=4,dt.set(bt,N),N+=Pt,vt+=4+Pt}var Lt=void 0;if(at<B-1)k=L[at+1].dts-et.dts,Lt=L[at+1].pts-et.pts;else{var Ot=this.config,Dt=at>0?et.dts-L[at-1].dts:$;if(Lt=at>0?et.pts-L[at-1].pts:$,Ot.stretchShortVideoTrack&&this.nextAudioPts!==null){var Mt=Math.floor(Ot.maxBufferHole*D),It=(c?W+c*D:this.nextAudioPts)-et.pts;It>Mt?(k=It-Dt,k<0?k=Dt:lt=!0,R.logger.log("[mp4-remuxer]: It is approximately "+It/90+" ms to the next segment; using duration "+k/90+" ms for the last video frame.")):k=Dt}else k=Dt}var wt=Math.round(et.pts-et.dts);yt=Math.min(yt,k),st=Math.max(st,k),it=Math.min(it,Lt),mt=Math.max(mt,Lt),P.push(new r(et.key,k,vt,wt))}if(P.length){if(g){if(g<70){var Bt=P[0].flags;Bt.dependsOn=2,Bt.isNonSync=0}}else if(f&&mt-it<st-yt&&$/st<.025&&P[0].cts===0){R.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var Ft=K,pt=0,Ut=P.length;pt<Ut;pt++){var Nt=Ft+P[pt].duration,Kt=Ft+P[pt].cts;if(pt<Ut-1){var Wt=Nt+P[pt+1].cts;P[pt].duration=Wt-Kt}else P[pt].duration=pt?P[pt-1].duration:$;P[pt].cts=0,Ft=Nt}}}console.assert(k!==null,"mp4SampleDuration must be computed"),k=lt||!k?$:k,this.nextAvcDts=U=w+k,this.videoSampleDuration=k,this.isVideoContiguous=!0;var Gt=A.default.moof(l.sequenceNumber++,K,T({},l,{samples:P})),jt="video",Ht={data1:Gt,data2:dt,startPTS:W/D,endPTS:(H+k)/D,startDTS:K/D,endDTS:U/D,type:jt,hasAudio:!1,hasVideo:!0,nb:P.length,dropped:l.dropped};return l.samples=[],l.dropped=0,console.assert(dt.length,"MDAT length must not be zero"),Ht},e.remuxAudio=function(l,n,u,c,D){var L=l.inputTimeScale,P=l.samplerate?l.samplerate:L,B=L/P,x=l.segmentCodec==="aac"?E:m,U=x*B,N=this._initPTS,k=l.segmentCodec==="mp3"&&this.typeSupported.mpeg,K=[],w=D!==void 0,W=l.samples,H=k?0:8,j=this.nextAudioPts||-1,Y=n*L;if(this.isAudioContiguous=u=u||W.length&&j>0&&(c&&Math.abs(Y-j)<9e3||Math.abs(a(W[0].pts-N,Y)-j)<20*U),W.forEach(function(Et){Et.pts=a(Et.pts-N,Y)}),!u||j<0){if(W=W.filter(function(Et){return Et.pts>=0}),!W.length)return;D===0?j=0:c&&!w?j=Math.max(0,Y):j=W[0].pts}if(l.segmentCodec==="aac")for(var X=this.config.maxAudioFramesDrift,z=0,_=j;z<W.length;z++){var Q=W[z],$=Q.pts,V=$-_,J=Math.abs(1e3*V/L);if(V<=-X*U&&w)z===0&&(R.logger.warn("Audio frame @ "+($/L).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*V/L)+" ms."),this.nextAudioPts=j=_=$);else if(V>=X*U&&J<S&&w){var Z=Math.round(V/U);_=$-Z*U,_<0&&(Z--,_+=U),z===0&&(this.nextAudioPts=j=_),R.logger.warn("[mp4-remuxer]: Injecting "+Z+" audio frame @ "+(_/L).toFixed(3)+"s due to "+Math.round(1e3*V/L)+" ms gap.");for(var q=0;q<Z;q++){var ot=Math.max(_,0),tt=I.default.getSilentFrame(l.manifestCodec||l.codec,l.channelCount);tt||(R.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),tt=Q.unit.subarray()),W.splice(z,0,{unit:tt,pts:ot}),_+=U,z++}}Q.pts=_,_+=U}for(var ut=null,nt=null,ft,rt=0,ht=W.length;ht--;)rt+=W[ht].unit.byteLength;for(var ct=0,gt=W.length;ct<gt;ct++){var dt=W[ct],Tt=dt.unit,lt=dt.pts;if(nt!==null){var yt=K[ct-1];yt.duration=Math.round((lt-nt)/B)}else if(u&&l.segmentCodec==="aac"&&(lt=j),ut=lt,rt>0){rt+=H;try{ft=new Uint8Array(rt)}catch{this.observer.emit(F.Events.ERROR,F.Events.ERROR,{type:C.ErrorTypes.MUX_ERROR,details:C.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:rt,reason:"fail allocating audio mdat "+rt});return}if(!k){var it=new DataView(ft.buffer);it.setUint32(0,rt),ft.set(A.default.types.mdat,4)}}else return;ft.set(Tt,H);var st=Tt.byteLength;H+=st,K.push(new r(!0,x,st,0)),nt=lt}var mt=K.length;if(!!mt){var at=K[K.length-1];this.nextAudioPts=j=nt+B*at.duration;var et=k?new Uint8Array(0):A.default.moof(l.sequenceNumber++,ut/B,T({},l,{samples:K}));l.samples=[];var St=ut/L,vt=j/L,At="audio",Rt={data1:et,data2:ft,startPTS:St,endPTS:vt,startDTS:St,endDTS:vt,type:At,hasAudio:!0,hasVideo:!1,nb:mt};return this.isAudioContiguous=!0,console.assert(ft.length,"MDAT length must not be zero"),Rt}},e.remuxEmptyAudio=function(l,n,u,c){var D=l.inputTimeScale,L=l.samplerate?l.samplerate:D,P=D/L,B=this.nextAudioPts,x=(B!==null?B:c.startDTS*D)+this._initDTS,U=c.endDTS*D+this._initDTS,N=P*E,k=Math.ceil((U-x)/N),K=I.default.getSilentFrame(l.manifestCodec||l.codec,l.channelCount);if(R.logger.warn("[mp4-remuxer]: remux empty Audio"),!K){R.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var w=[],W=0;W<k;W++){var H=x+W*N;w.push({unit:K,pts:H,dts:H})}return l.samples=w,this.remuxAudio(l,n,u,!1)},d}();function a(d,e){var s;if(e===null)return d;for(e<d?s=-8589934592:s=8589934592;Math.abs(d-e)>4294967296;)d+=s;return d}function h(d){for(var e=0;e<d.length;e++)if(d[e].key)return e;return-1}function v(d,e,s,l){var n=d.samples.length;if(!!n){for(var u=d.inputTimeScale,c=0;c<n;c++){var D=d.samples[c];D.pts=a(D.pts-s,e*u)/u,D.dts=a(D.dts-l,e*u)/u}var L=d.samples;return d.samples=[],{samples:L}}}function i(d,e,s){var l=d.samples.length;if(!!l){for(var n=d.inputTimeScale,u=0;u<l;u++){var c=d.samples[u];c.pts=a(c.pts-s,e*n)/n}d.samples.sort(function(L,P){return L.pts-P.pts});var D=d.samples;return d.samples=[],{samples:D}}}var r=function(e,s,l,n){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=s,this.size=l,this.cts=n,this.flags=new o(e)},o=function(e){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=e?2:1,this.isNonSync=e?0:1}},"./src/remux/passthrough-remuxer.ts":function(G,b,y){"use strict";y.r(b);var M=y("./src/polyfills/number.ts"),I=y("./src/remux/mp4-remuxer.ts"),A=y("./src/utils/mp4-tools.ts"),F=y("./src/loader/fragment.ts"),C=y("./src/utils/logger.ts"),R=function(){function p(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}var T=p.prototype;return T.destroy=function(){},T.resetTimeStamp=function(E){this.initPTS=E,this.lastEndTime=null},T.resetNextTimestamp=function(){this.lastEndTime=null},T.resetInitSegment=function(E,m,g){this.audioCodec=m,this.videoCodec=g,this.generateInitSegment(E),this.emitInitSegment=!0},T.generateInitSegment=function(E){var m=this.audioCodec,g=this.videoCodec;if(!E||!E.byteLength){this.initTracks=void 0,this.initData=void 0;return}var f=this.initData=Object(A.parseInitSegment)(E);m||(m=O(f.audio,F.ElementaryStreamTypes.AUDIO)),g||(g=O(f.video,F.ElementaryStreamTypes.VIDEO));var t={};f.audio&&f.video?t.audiovideo={container:"video/mp4",codec:m+","+g,initSegment:E,id:"main"}:f.audio?t.audio={container:"audio/mp4",codec:m,initSegment:E,id:"audio"}:f.video?t.video={container:"video/mp4",codec:g,initSegment:E,id:"main"}:C.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=t},T.remux=function(E,m,g,f,t){var a,h=this.initPTS,v=this.lastEndTime,i={audio:void 0,video:void 0,text:f,id3:g,initSegment:void 0};Object(M.isFiniteNumber)(v)||(v=this.lastEndTime=t||0);var r=m.samples;if(!r||!r.length)return i;var o={initPTS:void 0,timescale:1},d=this.initData;if((!d||!d.length)&&(this.generateInitSegment(r),d=this.initData),!d||!d.length)return C.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),i;this.emitInitSegment&&(o.tracks=this.initTracks,this.emitInitSegment=!1);var e=Object(A.getStartDTS)(d,r);Object(M.isFiniteNumber)(h)||(this.initPTS=o.initPTS=h=e-t);var s=Object(A.getDuration)(r,d),l=E?e-h:v,n=l+s;Object(A.offsetStartDTS)(d,r,h),s>0?this.lastEndTime=n:(C.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var u=!!d.audio,c=!!d.video,D="";u&&(D+="audio"),c&&(D+="video");var L={data1:r,startPTS:l,startDTS:l,endPTS:n,endDTS:n,type:D,hasAudio:u,hasVideo:c,nb:1,dropped:0};i.audio=L.type==="audio"?L:void 0,i.video=L.type!=="audio"?L:void 0,i.initSegment=o;var P=(a=this.initPTS)!=null?a:0;return i.id3=Object(I.flushTextTrackMetadataCueSamples)(g,t,P,P),f.samples.length&&(i.text=Object(I.flushTextTrackUserdataCueSamples)(f,t,P)),i},p}();function O(p,T){var S=p?.codec;return S&&S.length>4?S:S==="hvc1"||S==="hev1"?"hvc1.1.c.L120.90":S==="av01"?"av01.0.04M.08":S==="avc1"||T===F.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}b.default=R},"./src/task-loop.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"default",function(){return M});var M=function(){function I(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var A=I.prototype;return A.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},A.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},A.onHandlerDestroyed=function(){},A.hasInterval=function(){return!!this._tickInterval},A.hasNextTick=function(){return!!this._tickTimer},A.setInterval=function(C){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,C),!0)},A.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},A.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},A.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},A.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},A.doTick=function(){},I}()},"./src/types/cmcd.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"CMCDVersion",function(){return M}),y.d(b,"CMCDObjectType",function(){return I}),y.d(b,"CMCDStreamingFormat",function(){return A}),y.d(b,"CMCDStreamType",function(){return F});var M=1,I;(function(C){C.MANIFEST="m",C.AUDIO="a",C.VIDEO="v",C.MUXED="av",C.INIT="i",C.CAPTION="c",C.TIMED_TEXT="tt",C.KEY="k",C.OTHER="o"})(I||(I={}));var A;(function(C){C.DASH="d",C.HLS="h",C.SMOOTH="s",C.OTHER="o"})(A||(A={}));var F;(function(C){C.VOD="v",C.LIVE="l"})(F||(F={}))},"./src/types/demuxer.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"MetadataSchema",function(){return M});var M;(function(I){I.audioId3="org.id3",I.dateRange="com.apple.quicktime.HLS",I.emsg="https://aomedia.org/emsg/ID3"})(M||(M={}))},"./src/types/level.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"HlsSkip",function(){return A}),y.d(b,"getSkipValue",function(){return F}),y.d(b,"HlsUrlParameters",function(){return C}),y.d(b,"Level",function(){return R});function M(O,p){for(var T=0;T<p.length;T++){var S=p[T];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(O,S.key,S)}}function I(O,p,T){return p&&M(O.prototype,p),T&&M(O,T),Object.defineProperty(O,"prototype",{writable:!1}),O}var A;(function(O){O.No="",O.Yes="YES",O.v2="v2"})(A||(A={}));function F(O,p){var T=O.canSkipUntil,S=O.canSkipDateRanges,E=O.endSN,m=p!==void 0?p-E:0;return T&&m<T?S?A.v2:A.Yes:A.No}var C=function(){function O(T,S,E){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=T,this.part=S,this.skip=E}var p=O.prototype;return p.addDirectives=function(S){var E=new self.URL(S);return this.msn!==void 0&&E.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&E.searchParams.set("_HLS_part",this.part.toString()),this.skip&&E.searchParams.set("_HLS_skip",this.skip),E.toString()},O}(),R=function(){function O(p){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[p.url],this.attrs=p.attrs,this.bitrate=p.bitrate,p.details&&(this.details=p.details),this.id=p.id||0,this.name=p.name,this.width=p.width||0,this.height=p.height||0,this.audioCodec=p.audioCodec,this.videoCodec=p.videoCodec,this.unknownCodecs=p.unknownCodecs,this.codecSet=[p.videoCodec,p.audioCodec].filter(function(T){return T}).join(",").replace(/\.[^.,]+/g,"")}return I(O,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(T){var S=T%this.url.length;this._urlId!==S&&(this.details=void 0,this._urlId=S)}}]),O}()},"./src/types/loader.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"PlaylistContextType",function(){return M}),y.d(b,"PlaylistLevelType",function(){return I});var M;(function(A){A.MANIFEST="manifest",A.LEVEL="level",A.AUDIO_TRACK="audioTrack",A.SUBTITLE_TRACK="subtitleTrack"})(M||(M={}));var I;(function(A){A.MAIN="main",A.AUDIO="audio",A.SUBTITLE="subtitle"})(I||(I={}))},"./src/types/transmuxer.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"ChunkMetadata",function(){return M});var M=function(F,C,R,O,p,T){O===void 0&&(O=0),p===void 0&&(p=-1),T===void 0&&(T=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=I(),this.buffering={audio:I(),video:I(),audiovideo:I()},this.level=F,this.sn=C,this.id=R,this.size=O,this.part=p,this.partial=T};function I(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"AttrList",function(){return A});var M=/^(\d+)x(\d+)$/,I=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,A=function(){function F(R){typeof R=="string"&&(R=F.parseAttrList(R));for(var O in R)R.hasOwnProperty(O)&&(this[O]=R[O])}var C=F.prototype;return C.decimalInteger=function(O){var p=parseInt(this[O],10);return p>Number.MAX_SAFE_INTEGER?1/0:p},C.hexadecimalInteger=function(O){if(this[O]){var p=(this[O]||"0x").slice(2);p=(p.length&1?"0":"")+p;for(var T=new Uint8Array(p.length/2),S=0;S<p.length/2;S++)T[S]=parseInt(p.slice(S*2,S*2+2),16);return T}else return null},C.hexadecimalIntegerAsNumber=function(O){var p=parseInt(this[O],16);return p>Number.MAX_SAFE_INTEGER?1/0:p},C.decimalFloatingPoint=function(O){return parseFloat(this[O])},C.optionalFloat=function(O,p){var T=this[O];return T?parseFloat(T):p},C.enumeratedString=function(O){return this[O]},C.bool=function(O){return this[O]==="YES"},C.decimalResolution=function(O){var p=M.exec(this[O]);if(p!==null)return{width:parseInt(p[1],10),height:parseInt(p[2],10)}},F.parseAttrList=function(O){var p,T={},S='"';for(I.lastIndex=0;(p=I.exec(O))!==null;){var E=p[2];E.indexOf(S)===0&&E.lastIndexOf(S)===E.length-1&&(E=E.slice(1,-1)),T[p[1]]=E}return T},F}()},"./src/utils/binary-search.ts":function(G,b,y){"use strict";y.r(b);var M={search:function(A,F){for(var C=0,R=A.length-1,O=null,p=null;C<=R;){O=(C+R)/2|0,p=A[O];var T=F(p);if(T>0)C=O+1;else if(T<0)R=O-1;else return p}return null}};b.default=M},"./src/utils/buffer-helper.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"BufferHelper",function(){return A});var M=y("./src/utils/logger.ts"),I={length:0,start:function(){return 0},end:function(){return 0}},A=function(){function F(){}return F.isBuffered=function(R,O){try{if(R){for(var p=F.getBuffered(R),T=0;T<p.length;T++)if(O>=p.start(T)&&O<=p.end(T))return!0}}catch{}return!1},F.bufferInfo=function(R,O,p){try{if(R){var T=F.getBuffered(R),S=[],E;for(E=0;E<T.length;E++)S.push({start:T.start(E),end:T.end(E)});return this.bufferedInfo(S,O,p)}}catch{}return{len:0,start:O,end:O,nextStart:void 0}},F.bufferedInfo=function(R,O,p){O=Math.max(0,O),R.sort(function(r,o){var d=r.start-o.start;return d||o.end-r.end});var T=[];if(p)for(var S=0;S<R.length;S++){var E=T.length;if(E){var m=T[E-1].end;R[S].start-m<p?R[S].end>m&&(T[E-1].end=R[S].end):T.push(R[S])}else T.push(R[S])}else T=R;for(var g=0,f,t=O,a=O,h=0;h<T.length;h++){var v=T[h].start,i=T[h].end;if(O+p>=v&&O<i)t=v,a=i,g=a-O;else if(O+p<v){f=v;break}}return{len:g,start:t||0,end:a||0,nextStart:f}},F.getBuffered=function(R){try{return R.buffered}catch(O){return M.logger.log("failed to get media.buffered",O),I}},F}()},"./src/utils/cea-608-parser.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"Row",function(){return a}),y.d(b,"CaptionScreen",function(){return h});var M=y("./src/utils/logger.ts"),I={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},A=function(s){var l=s;return I.hasOwnProperty(s)&&(l=I[s]),String.fromCharCode(l)},F=15,C=100,R={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},O={17:2,18:4,21:6,22:8,23:10,19:13,20:15},p={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},T={25:2,26:4,29:6,30:8,31:10,27:13,28:15},S=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],E;(function(e){e[e.ERROR=0]="ERROR",e[e.TEXT=1]="TEXT",e[e.WARNING=2]="WARNING",e[e.INFO=2]="INFO",e[e.DEBUG=3]="DEBUG",e[e.DATA=3]="DATA"})(E||(E={}));var m=function(){function e(){this.time=null,this.verboseLevel=E.ERROR}var s=e.prototype;return s.log=function(n,u){this.verboseLevel>=n&&M.logger.log(this.time+" ["+n+"] "+u)},e}(),g=function(s){for(var l=[],n=0;n<s.length;n++)l.push(s[n].toString(16));return l},f=function(){function e(l,n,u,c,D){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=l||"white",this.underline=n||!1,this.italics=u||!1,this.background=c||"black",this.flash=D||!1}var s=e.prototype;return s.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},s.setStyles=function(n){for(var u=["foreground","underline","italics","background","flash"],c=0;c<u.length;c++){var D=u[c];n.hasOwnProperty(D)&&(this[D]=n[D])}},s.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},s.equals=function(n){return this.foreground===n.foreground&&this.underline===n.underline&&this.italics===n.italics&&this.background===n.background&&this.flash===n.flash},s.copy=function(n){this.foreground=n.foreground,this.underline=n.underline,this.italics=n.italics,this.background=n.background,this.flash=n.flash},s.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},e}(),t=function(){function e(l,n,u,c,D,L){this.uchar=void 0,this.penState=void 0,this.uchar=l||" ",this.penState=new f(n,u,c,D,L)}var s=e.prototype;return s.reset=function(){this.uchar=" ",this.penState.reset()},s.setChar=function(n,u){this.uchar=n,this.penState.copy(u)},s.setPenState=function(n){this.penState.copy(n)},s.equals=function(n){return this.uchar===n.uchar&&this.penState.equals(n.penState)},s.copy=function(n){this.uchar=n.uchar,this.penState.copy(n.penState)},s.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},e}(),a=function(){function e(l){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var n=0;n<C;n++)this.chars.push(new t);this.logger=l,this.pos=0,this.currPenState=new f}var s=e.prototype;return s.equals=function(n){for(var u=!0,c=0;c<C;c++)if(!this.chars[c].equals(n.chars[c])){u=!1;break}return u},s.copy=function(n){for(var u=0;u<C;u++)this.chars[u].copy(n.chars[u])},s.isEmpty=function(){for(var n=!0,u=0;u<C;u++)if(!this.chars[u].isEmpty()){n=!1;break}return n},s.setCursor=function(n){this.pos!==n&&(this.pos=n),this.pos<0?(this.logger.log(E.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>C&&(this.logger.log(E.DEBUG,"Too large cursor position "+this.pos),this.pos=C)},s.moveCursor=function(n){var u=this.pos+n;if(n>1)for(var c=this.pos+1;c<u+1;c++)this.chars[c].setPenState(this.currPenState);this.setCursor(u)},s.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},s.insertChar=function(n){n>=144&&this.backSpace();var u=A(n);if(this.pos>=C){this.logger.log(E.ERROR,"Cannot insert "+n.toString(16)+" ("+u+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(u,this.currPenState),this.moveCursor(1)},s.clearFromPos=function(n){var u;for(u=n;u<C;u++)this.chars[u].reset()},s.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},s.clearToEndOfRow=function(){this.clearFromPos(this.pos)},s.getTextString=function(){for(var n=[],u=!0,c=0;c<C;c++){var D=this.chars[c].uchar;D!==" "&&(u=!1),n.push(D)}return u?"":n.join("")},s.setPenStyles=function(n){this.currPenState.setStyles(n);var u=this.chars[this.pos];u.setPenState(this.currPenState)},e}(),h=function(){function e(l){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var n=0;n<F;n++)this.rows.push(new a(l));this.logger=l,this.currRow=F-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var s=e.prototype;return s.reset=function(){for(var n=0;n<F;n++)this.rows[n].clear();this.currRow=F-1},s.equals=function(n){for(var u=!0,c=0;c<F;c++)if(!this.rows[c].equals(n.rows[c])){u=!1;break}return u},s.copy=function(n){for(var u=0;u<F;u++)this.rows[u].copy(n.rows[u])},s.isEmpty=function(){for(var n=!0,u=0;u<F;u++)if(!this.rows[u].isEmpty()){n=!1;break}return n},s.backSpace=function(){var n=this.rows[this.currRow];n.backSpace()},s.clearToEndOfRow=function(){var n=this.rows[this.currRow];n.clearToEndOfRow()},s.insertChar=function(n){var u=this.rows[this.currRow];u.insertChar(n)},s.setPen=function(n){var u=this.rows[this.currRow];u.setPenStyles(n)},s.moveCursor=function(n){var u=this.rows[this.currRow];u.moveCursor(n)},s.setCursor=function(n){this.logger.log(E.INFO,"setCursor: "+n);var u=this.rows[this.currRow];u.setCursor(n)},s.setPAC=function(n){this.logger.log(E.INFO,"pacData = "+JSON.stringify(n));var u=n.row-1;if(this.nrRollUpRows&&u<this.nrRollUpRows-1&&(u=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==u){for(var c=0;c<F;c++)this.rows[c].clear();var D=this.currRow+1-this.nrRollUpRows,L=this.lastOutputScreen;if(L){var P=L.rows[D].cueStartTime,B=this.logger.time;if(P&&B!==null&&P<B)for(var x=0;x<this.nrRollUpRows;x++)this.rows[u-this.nrRollUpRows+x+1].copy(L.rows[D+x])}}this.currRow=u;var U=this.rows[this.currRow];if(n.indent!==null){var N=n.indent,k=Math.max(N-1,0);U.setCursor(n.indent),n.color=U.chars[k].penState.foreground}var K={foreground:n.color,underline:n.underline,italics:n.italics,background:"black",flash:!1};this.setPen(K)},s.setBkgData=function(n){this.logger.log(E.INFO,"bkgData = "+JSON.stringify(n)),this.backSpace(),this.setPen(n),this.insertChar(32)},s.setRollUpRows=function(n){this.nrRollUpRows=n},s.rollUp=function(){if(this.nrRollUpRows===null){this.logger.log(E.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(E.TEXT,this.getDisplayText());var n=this.currRow+1-this.nrRollUpRows,u=this.rows.splice(n,1)[0];u.clear(),this.rows.splice(this.currRow,0,u),this.logger.log(E.INFO,"Rolling up")},s.getDisplayText=function(n){n=n||!1;for(var u=[],c="",D=-1,L=0;L<F;L++){var P=this.rows[L].getTextString();P&&(D=L+1,n?u.push("Row "+D+": '"+P+"'"):u.push(P.trim()))}return u.length>0&&(n?c="["+u.join(" | ")+"]":c=u.join(`
`)),c},s.getTextAndFormat=function(){return this.rows},e}(),v=function(){function e(l,n,u){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=l,this.outputFilter=n,this.mode=null,this.verbose=0,this.displayedMemory=new h(u),this.nonDisplayedMemory=new h(u),this.lastOutputScreen=new h(u),this.currRollUpRow=this.displayedMemory.rows[F-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=u}var s=e.prototype;return s.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[F-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},s.getHandler=function(){return this.outputFilter},s.setHandler=function(n){this.outputFilter=n},s.setPAC=function(n){this.writeScreen.setPAC(n)},s.setBkgData=function(n){this.writeScreen.setBkgData(n)},s.setMode=function(n){n!==this.mode&&(this.mode=n,this.logger.log(E.INFO,"MODE="+n),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=n)},s.insertChars=function(n){for(var u=0;u<n.length;u++)this.writeScreen.insertChar(n[u]);var c=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(E.INFO,c+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(E.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},s.ccRCL=function(){this.logger.log(E.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},s.ccBS=function(){this.logger.log(E.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},s.ccAOF=function(){},s.ccAON=function(){},s.ccDER=function(){this.logger.log(E.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},s.ccRU=function(n){this.logger.log(E.INFO,"RU("+n+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(n)},s.ccFON=function(){this.logger.log(E.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},s.ccRDC=function(){this.logger.log(E.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},s.ccTR=function(){this.logger.log(E.INFO,"TR"),this.setMode("MODE_TEXT")},s.ccRTD=function(){this.logger.log(E.INFO,"RTD"),this.setMode("MODE_TEXT")},s.ccEDM=function(){this.logger.log(E.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},s.ccCR=function(){this.logger.log(E.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},s.ccENM=function(){this.logger.log(E.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},s.ccEOC=function(){if(this.logger.log(E.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var n=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=n,this.writeScreen=this.nonDisplayedMemory,this.logger.log(E.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},s.ccTO=function(n){this.logger.log(E.INFO,"TO("+n+") - Tab Offset"),this.writeScreen.moveCursor(n)},s.ccMIDROW=function(n){var u={flash:!1};if(u.underline=n%2===1,u.italics=n>=46,u.italics)u.foreground="white";else{var c=Math.floor(n/2)-16,D=["white","green","blue","cyan","red","yellow","magenta"];u.foreground=D[c]}this.logger.log(E.INFO,"MIDROW: "+JSON.stringify(u)),this.writeScreen.setPen(u)},s.outputDataUpdate=function(n){n===void 0&&(n=!1);var u=this.logger.time;u!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=u:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,u,this.lastOutputScreen),n&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:u),this.lastOutputScreen.copy(this.displayedMemory))},s.cueSplitAtTime=function(n){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,n,this.displayedMemory),this.cueStartTime=n))},e}(),i=function(){function e(l,n,u){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var c=new m;this.channels=[null,new v(l,n,c),new v(l+1,u,c)],this.cmdHistory=d(),this.logger=c}var s=e.prototype;return s.getHandler=function(n){return this.channels[n].getHandler()},s.setHandler=function(n,u){this.channels[n].setHandler(u)},s.addData=function(n,u){var c,D,L,P=!1;this.logger.time=n;for(var B=0;B<u.length;B+=2)if(D=u[B]&127,L=u[B+1]&127,!(D===0&&L===0)){if(this.logger.log(E.DATA,"["+g([u[B],u[B+1]])+"] -> ("+g([D,L])+")"),c=this.parseCmd(D,L),c||(c=this.parseMidrow(D,L)),c||(c=this.parsePAC(D,L)),c||(c=this.parseBackgroundAttributes(D,L)),!c&&(P=this.parseChars(D,L),P)){var x=this.currentChannel;if(x&&x>0){var U=this.channels[x];U.insertChars(P)}else this.logger.log(E.WARNING,"No channel found yet. TEXT-MODE?")}!c&&!P&&this.logger.log(E.WARNING,"Couldn't parse cleaned data "+g([D,L])+" orig: "+g([u[B],u[B+1]]))}},s.parseCmd=function(n,u){var c=this.cmdHistory,D=(n===20||n===28||n===21||n===29)&&u>=32&&u<=47,L=(n===23||n===31)&&u>=33&&u<=35;if(!(D||L))return!1;if(o(n,u,c))return r(null,null,c),this.logger.log(E.DEBUG,"Repeated command ("+g([n,u])+") is dropped"),!0;var P=n===20||n===21||n===23?1:2,B=this.channels[P];return n===20||n===21||n===28||n===29?u===32?B.ccRCL():u===33?B.ccBS():u===34?B.ccAOF():u===35?B.ccAON():u===36?B.ccDER():u===37?B.ccRU(2):u===38?B.ccRU(3):u===39?B.ccRU(4):u===40?B.ccFON():u===41?B.ccRDC():u===42?B.ccTR():u===43?B.ccRTD():u===44?B.ccEDM():u===45?B.ccCR():u===46?B.ccENM():u===47&&B.ccEOC():B.ccTO(u-32),r(n,u,c),this.currentChannel=P,!0},s.parseMidrow=function(n,u){var c=0;if((n===17||n===25)&&u>=32&&u<=47){if(n===17?c=1:c=2,c!==this.currentChannel)return this.logger.log(E.ERROR,"Mismatch channel in midrow parsing"),!1;var D=this.channels[c];return D?(D.ccMIDROW(u),this.logger.log(E.DEBUG,"MIDROW ("+g([n,u])+")"),!0):!1}return!1},s.parsePAC=function(n,u){var c,D=this.cmdHistory,L=(n>=17&&n<=23||n>=25&&n<=31)&&u>=64&&u<=127,P=(n===16||n===24)&&u>=64&&u<=95;if(!(L||P))return!1;if(o(n,u,D))return r(null,null,D),!0;var B=n<=23?1:2;u>=64&&u<=95?c=B===1?R[n]:p[n]:c=B===1?O[n]:T[n];var x=this.channels[B];return x?(x.setPAC(this.interpretPAC(c,u)),r(n,u,D),this.currentChannel=B,!0):!1},s.interpretPAC=function(n,u){var c,D={color:null,italics:!1,indent:null,underline:!1,row:n};return u>95?c=u-96:c=u-64,D.underline=(c&1)===1,c<=13?D.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(c/2)]:c<=15?(D.italics=!0,D.color="white"):D.indent=Math.floor((c-16)/2)*4,D},s.parseChars=function(n,u){var c,D=null,L=null;if(n>=25?(c=2,L=n-8):(c=1,L=n),L>=17&&L<=19){var P;L===17?P=u+80:L===18?P=u+112:P=u+144,this.logger.log(E.INFO,"Special char '"+A(P)+"' in channel "+c),D=[P]}else n>=32&&n<=127&&(D=u===0?[n]:[n,u]);if(D){var B=g(D);this.logger.log(E.DEBUG,"Char codes =  "+B.join(",")),r(n,u,this.cmdHistory)}return D},s.parseBackgroundAttributes=function(n,u){var c=(n===16||n===24)&&u>=32&&u<=47,D=(n===23||n===31)&&u>=45&&u<=47;if(!(c||D))return!1;var L,P={};n===16||n===24?(L=Math.floor((u-32)/2),P.background=S[L],u%2===1&&(P.background=P.background+"_semi")):u===45?P.background="transparent":(P.foreground="black",u===47&&(P.underline=!0));var B=n<=23?1:2,x=this.channels[B];return x.setBkgData(P),r(n,u,this.cmdHistory),!0},s.reset=function(){for(var n=0;n<Object.keys(this.channels).length;n++){var u=this.channels[n];u&&u.reset()}this.cmdHistory=d()},s.cueSplitAtTime=function(n){for(var u=0;u<this.channels.length;u++){var c=this.channels[u];c&&c.cueSplitAtTime(n)}},e}();function r(e,s,l){l.a=e,l.b=s}function o(e,s,l){return l.a===e&&l.b===s}function d(){return{a:null,b:null}}b.default=i},"./src/utils/codecs.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"isCodecType",function(){return I}),y.d(b,"isCodecSupportedInMp4",function(){return A});var M={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function I(F,C){var R=M[C];return!!R&&R[F.slice(0,4)]===!0}function A(F,C){return MediaSource.isTypeSupported((C||"video")+'/mp4;codecs="'+F+'"')}},"./src/utils/cues.ts":function(G,b,y){"use strict";y.r(b);var M=y("./src/utils/vttparser.ts"),I=y("./src/utils/webvtt-parser.ts"),A=y("./src/utils/texttrack-utils.ts"),F=/\s/,C={newCue:function(O,p,T,S){for(var E=[],m,g,f,t,a,h=self.VTTCue||self.TextTrackCue,v=0;v<S.rows.length;v++)if(m=S.rows[v],f=!0,t=0,a="",!m.isEmpty()){for(var i=0;i<m.chars.length;i++)F.test(m.chars[i].uchar)&&f?t++:(a+=m.chars[i].uchar,f=!1);m.cueStartTime=p,p===T&&(T+=1e-4),t>=16?t--:t++;var r=Object(M.fixLineBreaks)(a.trim()),o=Object(I.generateCueId)(p,T,r);(!O||!O.cues||!O.cues.getCueById(o))&&(g=new h(p,T,r),g.id=o,g.line=v+1,g.align="left",g.position=10+Math.min(80,Math.floor(t*8/32)*10),E.push(g))}return O&&E.length&&(E.sort(function(d,e){return d.line==="auto"||e.line==="auto"?0:d.line>8&&e.line>8?e.line-d.line:d.line-e.line}),E.forEach(function(d){return Object(A.addCueToTrack)(O,d)})),E}};b.default=C},"./src/utils/discontinuities.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"findFirstFragWithCC",function(){return F}),y.d(b,"shouldAlignOnDiscontinuities",function(){return C}),y.d(b,"findDiscontinuousReferenceFrag",function(){return R}),y.d(b,"adjustSlidingStart",function(){return p}),y.d(b,"alignStream",function(){return T}),y.d(b,"alignPDT",function(){return E}),y.d(b,"alignFragmentByPDTDelta",function(){return m}),y.d(b,"alignMediaPlaylistByPDT",function(){return g});var M=y("./src/polyfills/number.ts"),I=y("./src/utils/logger.ts"),A=y("./src/controller/level-helper.ts");function F(f,t){for(var a=null,h=0,v=f.length;h<v;h++){var i=f[h];if(i&&i.cc===t){a=i;break}}return a}function C(f,t,a){return!!(t.details&&(a.endCC>a.startCC||f&&f.cc<a.startCC))}function R(f,t){var a=f.fragments,h=t.fragments;if(!h.length||!a.length){I.logger.log("No fragments to align");return}var v=F(a,h[0].cc);if(!v||v&&!v.startPTS){I.logger.log("No frag in previous level to align on");return}return v}function O(f,t){if(f){var a=f.start+t;f.start=f.startPTS=a,f.endPTS=a+f.duration}}function p(f,t){for(var a=t.fragments,h=0,v=a.length;h<v;h++)O(a[h],f);t.fragmentHint&&O(t.fragmentHint,f),t.alignedSliding=!0}function T(f,t,a){!t||(S(f,a,t),!a.alignedSliding&&t.details&&E(a,t.details),!a.alignedSliding&&t.details&&!a.skippedSegments&&Object(A.adjustSliding)(t.details,a))}function S(f,t,a){if(C(f,a,t)){var h=R(a.details,t);h&&Object(M.isFiniteNumber)(h.start)&&(I.logger.log("Adjusting PTS using last level due to CC increase within current level "+t.url),p(h.start,t))}}function E(f,t){if(!(!t.fragments.length||!f.hasProgramDateTime||!t.hasProgramDateTime)){var a=t.fragments[0].programDateTime,h=f.fragments[0].programDateTime,v=(h-a)/1e3+t.fragments[0].start;v&&Object(M.isFiniteNumber)(v)&&(I.logger.log("Adjusting PTS using programDateTime delta "+(h-a)+"ms, sliding:"+v.toFixed(3)+" "+f.url+" "),p(v,f))}}function m(f,t){var a=f.programDateTime;if(!!a){var h=(a-t)/1e3;f.start=f.startPTS=h,f.endPTS=h+f.duration}}function g(f,t){if(!(!t.fragments.length||!f.hasProgramDateTime||!t.hasProgramDateTime)){var a=t.fragments[0].programDateTime,h=t.fragments[0].start,v=a-h*1e3;f.fragments.forEach(function(i){m(i,v)}),f.fragmentHint&&m(f.fragmentHint,v),f.alignedSliding=!0}}},"./src/utils/ewma-bandwidth-estimator.ts":function(G,b,y){"use strict";y.r(b);var M=y("./src/utils/ewma.ts"),I=function(){function A(C,R,O){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=O,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new M.default(C),this.fast_=new M.default(R)}var F=A.prototype;return F.update=function(R,O){var p=this.slow_,T=this.fast_;this.slow_.halfLife!==R&&(this.slow_=new M.default(R,p.getEstimate(),p.getTotalWeight())),this.fast_.halfLife!==O&&(this.fast_=new M.default(O,T.getEstimate(),T.getTotalWeight()))},F.sample=function(R,O){R=Math.max(R,this.minDelayMs_);var p=8*O,T=R/1e3,S=p/T;this.fast_.sample(T,S),this.slow_.sample(T,S)},F.canEstimate=function(){var R=this.fast_;return R&&R.getTotalWeight()>=this.minWeight_},F.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},F.destroy=function(){},A}();b.default=I},"./src/utils/ewma.ts":function(G,b,y){"use strict";y.r(b);var M=function(){function I(F,C,R){C===void 0&&(C=0),R===void 0&&(R=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=F,this.alpha_=F?Math.exp(Math.log(.5)/F):0,this.estimate_=C,this.totalWeight_=R}var A=I.prototype;return A.sample=function(C,R){var O=Math.pow(this.alpha_,C);this.estimate_=R*(1-O)+O*this.estimate_,this.totalWeight_+=C},A.getTotalWeight=function(){return this.totalWeight_},A.getEstimate=function(){if(this.alpha_){var C=1-Math.pow(this.alpha_,this.totalWeight_);if(C)return this.estimate_/C}return this.estimate_},I}();b.default=M},"./src/utils/fetch-loader.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"fetchSupported",function(){return m});var M=y("./src/polyfills/number.ts"),I=y("./src/loader/load-stats.ts"),A=y("./src/demux/chunk-cache.ts");function F(h,v){h.prototype=Object.create(v.prototype),h.prototype.constructor=h,T(h,v)}function C(h){var v=typeof Map=="function"?new Map:void 0;return C=function(r){if(r===null||!p(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(typeof v<"u"){if(v.has(r))return v.get(r);v.set(r,o)}function o(){return R(r,arguments,S(this).constructor)}return o.prototype=Object.create(r.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),T(o,r)},C(h)}function R(h,v,i){return O()?R=Reflect.construct.bind():R=function(o,d,e){var s=[null];s.push.apply(s,d);var l=Function.bind.apply(o,s),n=new l;return e&&T(n,e.prototype),n},R.apply(null,arguments)}function O(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function p(h){return Function.toString.call(h).indexOf("[native code]")!==-1}function T(h,v){return T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,o){return r.__proto__=o,r},T(h,v)}function S(h){return S=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},S(h)}function E(){return E=Object.assign?Object.assign.bind():function(h){for(var v=1;v<arguments.length;v++){var i=arguments[v];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(h[r]=i[r])}return h},E.apply(this,arguments)}function m(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var g=function(){function h(i){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=i.fetchSetup||t,this.controller=new self.AbortController,this.stats=new I.LoadStats}var v=h.prototype;return v.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},v.abortInternal=function(){var r=this.response;(!r||!r.ok)&&(this.stats.aborted=!0,this.controller.abort())},v.abort=function(){var r;this.abortInternal(),(r=this.callbacks)!==null&&r!==void 0&&r.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},v.load=function(r,o,d){var e=this,s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();var l=f(r,this.controller.signal),n=d.onProgress,u=r.responseType==="arraybuffer",c=u?"byteLength":"length";this.context=r,this.config=o,this.callbacks=d,this.request=this.fetchSetup(r,l),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){e.abortInternal(),d.onTimeout(s,r,e.response)},o.timeout),self.fetch(this.request).then(function(D){if(e.response=e.loader=D,!D.ok){var L=D.status,P=D.statusText;throw new a(P||"fetch, bad network response",L,D)}return s.loading.first=Math.max(self.performance.now(),s.loading.start),s.total=parseInt(D.headers.get("Content-Length")||"0"),n&&Object(M.isFiniteNumber)(o.highWaterMark)?e.loadProgressively(D,s,r,o.highWaterMark,n):u?D.arrayBuffer():D.text()}).then(function(D){var L=e.response;self.clearTimeout(e.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first),s.loaded=s.total=D[c];var P={url:L.url,data:D};n&&!Object(M.isFiniteNumber)(o.highWaterMark)&&n(s,r,D,L),d.onSuccess(P,s,r,L)}).catch(function(D){if(self.clearTimeout(e.requestTimeout),!s.aborted){var L=D&&D.code||0,P=D?D.message:null;d.onError({code:L,text:P},r,D?D.details:null)}})},v.getCacheAge=function(){var r=null;if(this.response){var o=this.response.headers.get("age");r=o?parseFloat(o):null}return r},v.loadProgressively=function(r,o,d,e,s){e===void 0&&(e=0);var l=new A.default,n=r.body.getReader(),u=function c(){return n.read().then(function(D){if(D.done)return l.dataLength&&s(o,d,l.flush(),r),Promise.resolve(new ArrayBuffer(0));var L=D.value,P=L.length;return o.loaded+=P,P<e||l.dataLength?(l.push(L),l.dataLength>=e&&s(o,d,l.flush(),r)):s(o,d,L,r),c()}).catch(function(){return Promise.reject()})};return u()},h}();function f(h,v){var i={method:"GET",mode:"cors",credentials:"same-origin",signal:v,headers:new self.Headers(E({},h.headers))};return h.rangeEnd&&i.headers.set("Range","bytes="+h.rangeStart+"-"+String(h.rangeEnd-1)),i}function t(h,v){return new self.Request(h.url,v)}var a=function(h){F(v,h);function v(i,r,o){var d;return d=h.call(this,i)||this,d.code=void 0,d.details=void 0,d.code=r,d.details=o,d}return v}(C(Error));b.default=g},"./src/utils/imsc1-ttml-parser.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"IMSC1_CODEC",function(){return p}),y.d(b,"parseIMSC1",function(){return m});var M=y("./src/utils/mp4-tools.ts"),I=y("./src/utils/vttparser.ts"),A=y("./src/utils/vttcue.ts"),F=y("./src/demux/id3.ts"),C=y("./src/utils/timescale-conversion.ts"),R=y("./src/utils/webvtt-parser.ts");function O(){return O=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var l=arguments[s];for(var n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n])}return e},O.apply(this,arguments)}var p="stpp.ttml.im1t",T=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,S=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,E={left:"start",center:"center",right:"end",start:"start",end:"end"};function m(e,s,l,n,u){var c=Object(M.findBox)(new Uint8Array(e),["mdat"]);if(c.length===0){u(new Error("Could not parse IMSC1 mdat"));return}var D=c.map(function(P){return Object(F.utf8ArrayToStr)(P)}),L=Object(C.toTimescaleFromScale)(s,1,l);try{D.forEach(function(P){return n(g(P,L))})}catch(P){u(P)}}function g(e,s){var l=new DOMParser,n=l.parseFromString(e,"text/xml"),u=n.getElementsByTagName("tt")[0];if(!u)throw new Error("Invalid ttml");var c={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},D=Object.keys(c).reduce(function(U,N){return U[N]=u.getAttribute("ttp:"+N)||c[N],U},{}),L=u.getAttribute("xml:space")!=="preserve",P=t(f(u,"styling","style")),B=t(f(u,"layout","region")),x=f(u,"body","[begin]");return[].map.call(x,function(U){var N=a(U,L);if(!N||!U.hasAttribute("begin"))return null;var k=r(U.getAttribute("begin"),D),K=r(U.getAttribute("dur"),D),w=r(U.getAttribute("end"),D);if(k===null)throw i(U);if(w===null){if(K===null)throw i(U);w=k+K}var W=new A.default(k-s,w-s,N);W.id=Object(R.generateCueId)(W.startTime,W.endTime,W.text);var H=B[U.getAttribute("region")],j=P[U.getAttribute("style")];W.position=10,W.size=80;var Y=h(H,j,P),X=Y.textAlign;if(X){var z=E[X];z&&(W.lineAlign=z),W.align=X}return O(W,Y),W}).filter(function(U){return U!==null})}function f(e,s,l){var n=e.getElementsByTagName(s)[0];return n?[].slice.call(n.querySelectorAll(l)):[]}function t(e){return e.reduce(function(s,l){var n=l.getAttribute("xml:id");return n&&(s[n]=l),s},{})}function a(e,s){return[].slice.call(e.childNodes).reduce(function(l,n,u){var c;return n.nodeName==="br"&&u?l+`
`:(c=n.childNodes)!==null&&c!==void 0&&c.length?a(n,s):s?l+n.textContent.trim().replace(/\s+/g," "):l+n.textContent},"")}function h(e,s,l){var n="http://www.w3.org/ns/ttml#styling",u=null,c=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],D=e!=null&&e.hasAttribute("style")?e.getAttribute("style"):null;return D&&l.hasOwnProperty(D)&&(u=l[D]),c.reduce(function(L,P){var B=v(s,n,P)||v(e,n,P)||v(u,n,P);return B&&(L[P]=B),L},{})}function v(e,s,l){return e&&e.hasAttributeNS(s,l)?e.getAttributeNS(s,l):null}function i(e){return new Error("Could not parse ttml timestamp "+e)}function r(e,s){if(!e)return null;var l=Object(I.parseTimeStamp)(e);return l===null&&(T.test(e)?l=o(e,s):S.test(e)&&(l=d(e,s))),l}function o(e,s){var l=T.exec(e),n=(l[4]|0)+(l[5]|0)/s.subFrameRate;return(l[1]|0)*3600+(l[2]|0)*60+(l[3]|0)+n/s.frameRate}function d(e,s){var l=S.exec(e),n=Number(l[1]),u=l[2];switch(u){case"h":return n*3600;case"m":return n*60;case"ms":return n*1e3;case"f":return n/s.frameRate;case"t":return n/s.tickRate}return n}},"./src/utils/logger.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"enableLogs",function(){return R}),y.d(b,"logger",function(){return O});var M=function(){},I={trace:M,debug:M,log:M,warn:M,info:M,error:M},A=I;function F(p){var T=self.console[p];return T?T.bind(self.console,"["+p+"] >"):M}function C(p){for(var T=arguments.length,S=new Array(T>1?T-1:0),E=1;E<T;E++)S[E-1]=arguments[E];S.forEach(function(m){A[m]=p[m]?p[m].bind(p):F(m)})}function R(p){if(self.console&&p===!0||typeof p=="object"){C(p,"debug","log","info","warn","error");try{A.log()}catch{A=I}}else A=I}var O=A},"./src/utils/mediakeys-helper.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"KeySystems",function(){return M}),y.d(b,"requestMediaKeySystemAccess",function(){return I});var M;(function(A){A.WIDEVINE="com.widevine.alpha",A.PLAYREADY="com.microsoft.playready"})(M||(M={}));var I=function(){return typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}()},"./src/utils/mediasource-helper.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"getMediaSource",function(){return M});function M(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"RemuxerTrackIdConfig",function(){return R}),y.d(b,"bin2str",function(){return O}),y.d(b,"readUint16",function(){return p}),y.d(b,"readUint32",function(){return T}),y.d(b,"readSint32",function(){return S}),y.d(b,"writeUint32",function(){return E}),y.d(b,"findBox",function(){return m}),y.d(b,"parseSegmentIndex",function(){return g}),y.d(b,"parseInitSegment",function(){return f}),y.d(b,"getStartDTS",function(){return t}),y.d(b,"getDuration",function(){return a}),y.d(b,"computeRawDurationFromSamples",function(){return h}),y.d(b,"offsetStartDTS",function(){return v}),y.d(b,"segmentValidRange",function(){return i}),y.d(b,"appendUint8Array",function(){return r}),y.d(b,"parseSamples",function(){return o}),y.d(b,"parseSEIMessageFromNALu",function(){return s}),y.d(b,"parseEmsg",function(){return n});var M=y("./src/utils/typed-array.ts"),I=y("./src/loader/fragment.ts"),A=y("./src/demux/id3.ts"),F=Math.pow(2,32)-1,C=[].push,R={video:1,audio:2,id3:3,text:4};function O(u){return String.fromCharCode.apply(null,u)}function p(u,c){var D=u[c]<<8|u[c+1];return D<0?65536+D:D}function T(u,c){var D=S(u,c);return D<0?4294967296+D:D}function S(u,c){return u[c]<<24|u[c+1]<<16|u[c+2]<<8|u[c+3]}function E(u,c,D){u[c]=D>>24,u[c+1]=D>>16&255,u[c+2]=D>>8&255,u[c+3]=D&255}function m(u,c){var D=[];if(!c.length)return D;for(var L=u.byteLength,P=0;P<L;){var B=T(u,P),x=O(u.subarray(P+4,P+8)),U=B>1?P+B:L;if(x===c[0])if(c.length===1)D.push(u.subarray(P+8,U));else{var N=m(u.subarray(P+8,U),c.slice(1));N.length&&C.apply(D,N)}P=U}return D}function g(u){var c=[],D=u[0],L=8,P=T(u,L);L+=4;var B=0,x=0;D===0?L+=8:L+=16,L+=2;var U=u.length+x,N=p(u,L);L+=2;for(var k=0;k<N;k++){var K=L,w=T(u,K);K+=4;var W=w&2147483647,H=(w&2147483648)>>>31;if(H===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var j=T(u,K);K+=4,c.push({referenceSize:W,subsegmentDuration:j,info:{duration:j/P,start:U,end:U+W-1}}),U+=W,K+=4,L=K}return{earliestPresentationTime:B,timescale:P,version:D,referencesCount:N,references:c}}function f(u){for(var c=[],D=m(u,["moov","trak"]),L=0;L<D.length;L++){var P=D[L],B=m(P,["tkhd"])[0];if(B){var x=B[0],U=x===0?12:20,N=T(B,U),k=m(P,["mdia","mdhd"])[0];if(k){x=k[0],U=x===0?12:20;var K=T(k,U),w=m(P,["mdia","hdlr"])[0];if(w){var W=O(w.subarray(8,12)),H={soun:I.ElementaryStreamTypes.AUDIO,vide:I.ElementaryStreamTypes.VIDEO}[W];if(H){var j=m(P,["mdia","minf","stbl","stsd"])[0],Y=void 0;j&&(Y=O(j.subarray(12,16))),c[N]={timescale:K,type:H},c[H]={timescale:K,id:N,codec:Y}}}}}}var X=m(u,["moov","mvex","trex"]);return X.forEach(function(z){var _=T(z,4),Q=c[_];Q&&(Q.default={duration:T(z,12),flags:T(z,20)})}),c}function t(u,c){return m(c,["moof","traf"]).reduce(function(D,L){var P=m(L,["tfdt"])[0],B=P[0],x=m(L,["tfhd"]).reduce(function(U,N){var k=T(N,4),K=u[k];if(K){var w=T(P,4);B===1&&(w*=Math.pow(2,32),w+=T(P,8));var W=K.timescale||9e4,H=w/W;if(isFinite(H)&&(U===null||H<U))return H}return U},null);return x!==null&&isFinite(x)&&(D===null||x<D)?x:D},null)||0}function a(u,c){for(var D=0,L=0,P=0,B=m(u,["moof","traf"]),x=0;x<B.length;x++){var U=B[x],N=m(U,["tfhd"])[0],k=T(N,4),K=c[k];if(!!K){var w=K.default,W=T(N,0)|w?.flags,H=w?.duration;W&8&&(W&2?H=T(N,12):H=T(N,8));for(var j=K.timescale||9e4,Y=m(U,["trun"]),X=0;X<Y.length;X++){if(D=h(Y[X]),!D&&H){var z=T(Y[X],4);D=H*z}K.type===I.ElementaryStreamTypes.VIDEO?L+=D/j:K.type===I.ElementaryStreamTypes.AUDIO&&(P+=D/j)}}}if(L===0&&P===0){for(var _=0,Q=m(u,["sidx"]),$=0;$<Q.length;$++){var V=g(Q[$]);V!=null&&V.references&&(_+=V.references.reduce(function(J,Z){return J+Z.info.duration||0},0))}return _}return L||P}function h(u){var c=T(u,0),D=8;c&1&&(D+=4),c&4&&(D+=4);for(var L=0,P=T(u,4),B=0;B<P;B++){if(c&256){var x=T(u,D);L+=x,D+=4}c&512&&(D+=4),c&1024&&(D+=4),c&2048&&(D+=4)}return L}function v(u,c,D){m(c,["moof","traf"]).forEach(function(L){m(L,["tfhd"]).forEach(function(P){var B=T(P,4),x=u[B];if(!!x){var U=x.timescale||9e4;m(L,["tfdt"]).forEach(function(N){var k=N[0],K=T(N,4);if(k===0)K-=D*U,K=Math.max(K,0),E(N,4,K);else{K*=Math.pow(2,32),K+=T(N,8),K-=D*U,K=Math.max(K,0);var w=Math.floor(K/(F+1)),W=Math.floor(K%(F+1));E(N,4,w),E(N,8,W)}})}})})}function i(u){var c={valid:null,remainder:null},D=m(u,["moof"]);if(D){if(D.length<2)return c.remainder=u,c}else return c;var L=D[D.length-1];return c.valid=Object(M.sliceUint8)(u,0,L.byteOffset-8),c.remainder=Object(M.sliceUint8)(u,L.byteOffset-8),c}function r(u,c){var D=new Uint8Array(u.length+c.length);return D.set(u),D.set(c,u.length),D}function o(u,c){var D=[],L=c.samples,P=c.timescale,B=c.id,x=!1,U=m(L,["moof"]);return U.map(function(N){var k=N.byteOffset-8,K=m(N,["traf"]);K.map(function(w){var W=m(w,["tfdt"]).map(function(H){var j=H[0],Y=T(H,4);return j===1&&(Y*=Math.pow(2,32),Y+=T(H,8)),Y/P})[0];return W!==void 0&&(u=W),m(w,["tfhd"]).map(function(H){var j=T(H,4),Y=T(H,0)&16777215,X=(Y&1)!==0,z=(Y&2)!==0,_=(Y&8)!==0,Q=0,$=(Y&16)!==0,V=0,J=(Y&32)!==0,Z=8;j===B&&(X&&(Z+=8),z&&(Z+=4),_&&(Q=T(H,Z),Z+=4),$&&(V=T(H,Z),Z+=4),J&&(Z+=4),c.type==="video"&&(x=d(c.codec)),m(w,["trun"]).map(function(q){var ot=q[0],tt=T(q,0)&16777215,ut=(tt&1)!==0,nt=0,ft=(tt&4)!==0,rt=(tt&256)!==0,ht=0,ct=(tt&512)!==0,gt=0,dt=(tt&1024)!==0,Tt=(tt&2048)!==0,lt=0,yt=T(q,4),it=8;ut&&(nt=T(q,it),it+=4),ft&&(it+=4);for(var st=nt+k,mt=0;mt<yt;mt++){if(rt?(ht=T(q,it),it+=4):ht=Q,ct?(gt=T(q,it),it+=4):gt=V,dt&&(it+=4),Tt&&(ot===0?lt=T(q,it):lt=S(q,it),it+=4),c.type===I.ElementaryStreamTypes.VIDEO)for(var at=0;at<gt;){var et=T(L,st);st+=4;var St=L[st]&31;if(e(x,St)){var vt=L.subarray(st,st+et);s(vt,u+lt/P,D)}st+=et,at+=et+4}u+=ht/P}}))})})}),D}function d(u){if(!u)return!1;var c=u.indexOf("."),D=c<0?u:u.substring(0,c);return D==="hvc1"||D==="hev1"||D==="dvh1"||D==="dvhe"}function e(u,c){return u?c===39||c===40:c===6}function s(u,c,D){var L=l(u),P=0;P++;for(var B=0,x=0,U=!1,N=0;P<L.length;){B=0;do{if(P>=L.length)break;N=L[P++],B+=N}while(N===255);x=0;do{if(P>=L.length)break;N=L[P++],x+=N}while(N===255);var k=L.length-P;if(!U&&B===4&&P<L.length){U=!0;var K=L[P++];if(K===181){var w=p(L,P);if(P+=2,w===49){var W=T(L,P);if(P+=4,W===1195456820){var H=L[P++];if(H===3){var j=L[P++],Y=31&j,X=64&j,z=X?2+Y*3:0,_=new Uint8Array(z);if(X){_[0]=j;for(var Q=1;Q<z;Q++)_[Q]=L[P++]}D.push({type:H,payloadType:B,pts:c,bytes:_})}}}}}else if(B===5&&x<k){if(U=!0,x>16){for(var $=[],V=0;V<16;V++){var J=L[P++].toString(16);$.push(J.length==1?"0"+J:J),(V===3||V===5||V===7||V===9)&&$.push("-")}for(var Z=x-16,q=new Uint8Array(Z),ot=0;ot<Z;ot++)q[ot]=L[P++];D.push({payloadType:B,pts:c,uuid:$.join(""),userData:Object(A.utf8ArrayToStr)(q),userDataBytes:q})}}else if(x<k)P+=x;else if(x>k)break}}function l(u){for(var c=u.byteLength,D=[],L=1;L<c-2;)u[L]===0&&u[L+1]===0&&u[L+2]===3?(D.push(L+2),L+=2):L++;if(D.length===0)return u;var P=c-D.length,B=new Uint8Array(P),x=0;for(L=0;L<P;x++,L++)x===D[0]&&(x++,D.shift()),B[L]=u[x];return B}function n(u){var c=u[0],D="",L="",P=0,B=0,x=0,U=0,N=0,k=0;if(c===0){for(;O(u.subarray(k,k+1))!=="\0";)D+=O(u.subarray(k,k+1)),k+=1;for(D+=O(u.subarray(k,k+1)),k+=1;O(u.subarray(k,k+1))!=="\0";)L+=O(u.subarray(k,k+1)),k+=1;L+=O(u.subarray(k,k+1)),k+=1,P=T(u,12),B=T(u,16),U=T(u,20),N=T(u,24),k=28}else if(c===1){k+=4,P=T(u,k),k+=4;var K=T(u,k);k+=4;var w=T(u,k);for(k+=4,x=Math.pow(2,32)*K+w,Number.isSafeInteger(x)||(x=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),U=T(u,k),k+=4,N=T(u,k),k+=4;O(u.subarray(k,k+1))!=="\0";)D+=O(u.subarray(k,k+1)),k+=1;for(D+=O(u.subarray(k,k+1)),k+=1;O(u.subarray(k,k+1))!=="\0";)L+=O(u.subarray(k,k+1)),k+=1;L+=O(u.subarray(k,k+1)),k+=1}var W=u.subarray(k,u.byteLength);return{schemeIdUri:D,value:L,timeScale:P,presentationTime:x,presentationTimeDelta:B,eventDuration:U,id:N,payload:W}}},"./src/utils/output-filter.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"default",function(){return M});var M=function(){function I(F,C){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=F,this.trackName=C}var A=I.prototype;return A.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},A.newCue=function(C,R,O){(this.startTime===null||this.startTime>C)&&(this.startTime=C),this.endTime=R,this.screen=O,this.timelineController.createCaptionsTrack(this.trackName)},A.reset=function(){this.cueRanges=[],this.startTime=null},I}()},"./src/utils/texttrack-utils.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"sendAddTrackEvent",function(){return I}),y.d(b,"addCueToTrack",function(){return A}),y.d(b,"clearCurrentCues",function(){return F}),y.d(b,"removeCuesInRange",function(){return C}),y.d(b,"getCuesInRange",function(){return O});var M=y("./src/utils/logger.ts");function I(p,T){var S;try{S=new Event("addtrack")}catch{S=document.createEvent("Event"),S.initEvent("addtrack",!1,!1)}S.track=p,T.dispatchEvent(S)}function A(p,T){var S=p.mode;if(S==="disabled"&&(p.mode="hidden"),p.cues&&!p.cues.getCueById(T.id))try{if(p.addCue(T),!p.cues.getCueById(T.id))throw new Error("addCue is failed for: "+T)}catch(m){M.logger.debug("[texttrack-utils]: "+m);var E=new self.TextTrackCue(T.startTime,T.endTime,T.text);E.id=T.id,p.addCue(E)}S==="disabled"&&(p.mode=S)}function F(p){var T=p.mode;if(T==="disabled"&&(p.mode="hidden"),p.cues)for(var S=p.cues.length;S--;)p.removeCue(p.cues[S]);T==="disabled"&&(p.mode=T)}function C(p,T,S,E){var m=p.mode;if(m==="disabled"&&(p.mode="hidden"),p.cues&&p.cues.length>0)for(var g=O(p.cues,T,S),f=0;f<g.length;f++)(!E||E(g[f]))&&p.removeCue(g[f]);m==="disabled"&&(p.mode=m)}function R(p,T){if(T<p[0].startTime)return 0;var S=p.length-1;if(T>p[S].endTime)return-1;for(var E=0,m=S;E<=m;){var g=Math.floor((m+E)/2);if(T<p[g].startTime)m=g-1;else if(T>p[g].startTime&&E<S)E=g+1;else return g}return p[E].startTime-T<T-p[m].startTime?E:m}function O(p,T,S){var E=[],m=R(p,T);if(m>-1)for(var g=m,f=p.length;g<f;g++){var t=p[g];if(t.startTime>=T&&t.endTime<=S)E.push(t);else if(t.startTime>S)return E}return E}},"./src/utils/time-ranges.ts":function(G,b,y){"use strict";y.r(b);var M={toString:function(A){for(var F="",C=A.length,R=0;R<C;R++)F+="["+A.start(R).toFixed(3)+","+A.end(R).toFixed(3)+"]";return F}};b.default=M},"./src/utils/timescale-conversion.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"toTimescaleFromBase",function(){return I}),y.d(b,"toTimescaleFromScale",function(){return A}),y.d(b,"toMsFromMpegTsClock",function(){return F}),y.d(b,"toMpegTsClockFromTimescale",function(){return C});var M=9e4;function I(R,O,p,T){p===void 0&&(p=1),T===void 0&&(T=!1);var S=R*O*p;return T?Math.round(S):S}function A(R,O,p,T){return p===void 0&&(p=1),T===void 0&&(T=!1),I(R,O,1/p,T)}function F(R,O){return O===void 0&&(O=!1),I(R,1e3,1/M,O)}function C(R,O){return O===void 0&&(O=1),I(R,M,1/O)}},"./src/utils/typed-array.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"sliceUint8",function(){return M});function M(I,A,F){return Uint8Array.prototype.slice?I.slice(A,F):new Uint8Array(Array.prototype.slice.call(I,A,F))}},"./src/utils/vttcue.ts":function(G,b,y){"use strict";y.r(b),b.default=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;var M=["","lr","rl"],I=["start","middle","end","left","right"];function A(p,T){if(typeof T!="string"||!Array.isArray(p))return!1;var S=T.toLowerCase();return~p.indexOf(S)?S:!1}function F(p){return A(M,p)}function C(p){return A(I,p)}function R(p){for(var T=arguments.length,S=new Array(T>1?T-1:0),E=1;E<T;E++)S[E-1]=arguments[E];for(var m=1;m<arguments.length;m++){var g=arguments[m];for(var f in g)p[f]=g[f]}return p}function O(p,T,S){var E=this,m={enumerable:!0};E.hasBeenReset=!1;var g="",f=!1,t=p,a=T,h=S,v=null,i="",r=!0,o="auto",d="start",e=50,s="middle",l=50,n="middle";Object.defineProperty(E,"id",R({},m,{get:function(){return g},set:function(c){g=""+c}})),Object.defineProperty(E,"pauseOnExit",R({},m,{get:function(){return f},set:function(c){f=!!c}})),Object.defineProperty(E,"startTime",R({},m,{get:function(){return t},set:function(c){if(typeof c!="number")throw new TypeError("Start time must be set to a number.");t=c,this.hasBeenReset=!0}})),Object.defineProperty(E,"endTime",R({},m,{get:function(){return a},set:function(c){if(typeof c!="number")throw new TypeError("End time must be set to a number.");a=c,this.hasBeenReset=!0}})),Object.defineProperty(E,"text",R({},m,{get:function(){return h},set:function(c){h=""+c,this.hasBeenReset=!0}})),Object.defineProperty(E,"region",R({},m,{get:function(){return v},set:function(c){v=c,this.hasBeenReset=!0}})),Object.defineProperty(E,"vertical",R({},m,{get:function(){return i},set:function(c){var D=F(c);if(D===!1)throw new SyntaxError("An invalid or illegal string was specified.");i=D,this.hasBeenReset=!0}})),Object.defineProperty(E,"snapToLines",R({},m,{get:function(){return r},set:function(c){r=!!c,this.hasBeenReset=!0}})),Object.defineProperty(E,"line",R({},m,{get:function(){return o},set:function(c){if(typeof c!="number"&&c!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");o=c,this.hasBeenReset=!0}})),Object.defineProperty(E,"lineAlign",R({},m,{get:function(){return d},set:function(c){var D=C(c);if(!D)throw new SyntaxError("An invalid or illegal string was specified.");d=D,this.hasBeenReset=!0}})),Object.defineProperty(E,"position",R({},m,{get:function(){return e},set:function(c){if(c<0||c>100)throw new Error("Position must be between 0 and 100.");e=c,this.hasBeenReset=!0}})),Object.defineProperty(E,"positionAlign",R({},m,{get:function(){return s},set:function(c){var D=C(c);if(!D)throw new SyntaxError("An invalid or illegal string was specified.");s=D,this.hasBeenReset=!0}})),Object.defineProperty(E,"size",R({},m,{get:function(){return l},set:function(c){if(c<0||c>100)throw new Error("Size must be between 0 and 100.");l=c,this.hasBeenReset=!0}})),Object.defineProperty(E,"align",R({},m,{get:function(){return n},set:function(c){var D=C(c);if(!D)throw new SyntaxError("An invalid or illegal string was specified.");n=D,this.hasBeenReset=!0}})),E.displayState=void 0}return O.prototype.getCueAsHTML=function(){var p=self.WebVTT;return p.convertCueToDOMTree(self,this.text)},O}()},"./src/utils/vttparser.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"parseTimeStamp",function(){return A}),y.d(b,"fixLineBreaks",function(){return T}),y.d(b,"VTTParser",function(){return S});var M=y("./src/utils/vttcue.ts"),I=function(){function E(){}var m=E.prototype;return m.decode=function(f,t){if(!f)return"";if(typeof f!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(f))},E}();function A(E){function m(f,t,a,h){return(f|0)*3600+(t|0)*60+(a|0)+parseFloat(h||0)}var g=E.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return g?parseFloat(g[2])>59?m(g[2],g[3],0,g[4]):m(g[1],g[2],g[3],g[4]):null}var F=function(){function E(){this.values=Object.create(null)}var m=E.prototype;return m.set=function(f,t){!this.get(f)&&t!==""&&(this.values[f]=t)},m.get=function(f,t,a){return a?this.has(f)?this.values[f]:t[a]:this.has(f)?this.values[f]:t},m.has=function(f){return f in this.values},m.alt=function(f,t,a){for(var h=0;h<a.length;++h)if(t===a[h]){this.set(f,t);break}},m.integer=function(f,t){/^-?\d+$/.test(t)&&this.set(f,parseInt(t,10))},m.percent=function(f,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){var a=parseFloat(t);if(a>=0&&a<=100)return this.set(f,a),!0}return!1},E}();function C(E,m,g,f){var t=f?E.split(f):[E];for(var a in t)if(typeof t[a]=="string"){var h=t[a].split(g);if(h.length===2){var v=h[0],i=h[1];m(v,i)}}}var R=new M.default(0,0,""),O=R.align==="middle"?"middle":"center";function p(E,m,g){var f=E;function t(){var v=A(E);if(v===null)throw new Error("Malformed timestamp: "+f);return E=E.replace(/^[^\sa-zA-Z-]+/,""),v}function a(v,i){var r=new F;C(v,function(e,s){var l;switch(e){case"region":for(var n=g.length-1;n>=0;n--)if(g[n].id===s){r.set(e,g[n].region);break}break;case"vertical":r.alt(e,s,["rl","lr"]);break;case"line":l=s.split(","),r.integer(e,l[0]),r.percent(e,l[0])&&r.set("snapToLines",!1),r.alt(e,l[0],["auto"]),l.length===2&&r.alt("lineAlign",l[1],["start",O,"end"]);break;case"position":l=s.split(","),r.percent(e,l[0]),l.length===2&&r.alt("positionAlign",l[1],["start",O,"end","line-left","line-right","auto"]);break;case"size":r.percent(e,s);break;case"align":r.alt(e,s,["start",O,"end","left","right"]);break}},/:/,/\s/),i.region=r.get("region",null),i.vertical=r.get("vertical","");var o=r.get("line","auto");o==="auto"&&R.line===-1&&(o=-1),i.line=o,i.lineAlign=r.get("lineAlign","start"),i.snapToLines=r.get("snapToLines",!0),i.size=r.get("size",100),i.align=r.get("align",O);var d=r.get("position","auto");d==="auto"&&R.position===50&&(d=i.align==="start"||i.align==="left"?0:i.align==="end"||i.align==="right"?100:50),i.position=d}function h(){E=E.replace(/^\s+/,"")}if(h(),m.startTime=t(),h(),E.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+f);E=E.slice(3),h(),m.endTime=t(),h(),a(E,m)}function T(E){return E.replace(/<br(?: \/)?>/gi,`
`)}var S=function(){function E(){this.state="INITIAL",this.buffer="",this.decoder=new I,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var m=E.prototype;return m.parse=function(f){var t=this;f&&(t.buffer+=t.decoder.decode(f,{stream:!0}));function a(){var d=t.buffer,e=0;for(d=T(d);e<d.length&&d[e]!=="\r"&&d[e]!==`
`;)++e;var s=d.slice(0,e);return d[e]==="\r"&&++e,d[e]===`
`&&++e,t.buffer=d.slice(e),s}function h(d){C(d,function(e,s){},/:/)}try{var v="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;v=a();var i=v.match(/^()?WEBVTT([ \t].*)?$/);if(!i||!i[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var r=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(r?r=!1:v=a(),t.state){case"HEADER":/:/.test(v)?h(v):v||(t.state="ID");continue;case"NOTE":v||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(v)){t.state="NOTE";break}if(!v)continue;if(t.cue=new M.default(0,0,""),t.state="CUE",v.indexOf("-->")===-1){t.cue.id=v;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{p(v,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{var o=v.indexOf("-->")!==-1;if(!v||o&&(r=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=v}continue;case"BADCUE":v||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},m.flush=function(){var f=this;try{if((f.cue||f.state==="HEADER")&&(f.buffer+=`

`,f.parse()),f.state==="INITIAL"||f.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){f.onparsingerror&&f.onparsingerror(t)}return f.onflush&&f.onflush(),this},E}()},"./src/utils/webvtt-parser.ts":function(G,b,y){"use strict";y.r(b),y.d(b,"generateCueId",function(){return S}),y.d(b,"parseWebVTT",function(){return m});var M=y("./src/polyfills/number.ts"),I=y("./src/utils/vttparser.ts"),A=y("./src/demux/id3.ts"),F=y("./src/utils/timescale-conversion.ts"),C=y("./src/remux/mp4-remuxer.ts"),R=/\r\n|\n\r|\n|\r/g,O=function(f,t,a){return a===void 0&&(a=0),f.slice(a,a+t.length)===t},p=function(f){var t=parseInt(f.slice(-3)),a=parseInt(f.slice(-6,-4)),h=parseInt(f.slice(-9,-7)),v=f.length>9?parseInt(f.substring(0,f.indexOf(":"))):0;if(!Object(M.isFiniteNumber)(t)||!Object(M.isFiniteNumber)(a)||!Object(M.isFiniteNumber)(h)||!Object(M.isFiniteNumber)(v))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+f);return t+=1e3*a,t+=60*1e3*h,t+=60*60*1e3*v,t},T=function(f){for(var t=5381,a=f.length;a;)t=t*33^f.charCodeAt(--a);return(t>>>0).toString()};function S(g,f,t){return T(g.toString())+T(f.toString())+T(t)}var E=function(f,t,a){var h=f[t],v=f[h.prevCC];if(!v||!v.new&&h.new){f.ccOffset=f.presentationOffset=h.start,h.new=!1;return}for(;(i=v)!==null&&i!==void 0&&i.new;){var i;f.ccOffset+=h.start-v.start,h.new=!1,h=v,v=f[h.prevCC]}f.presentationOffset=a};function m(g,f,t,a,h,v,i,r){var o=new I.VTTParser,d=Object(A.utf8ArrayToStr)(new Uint8Array(g)).trim().replace(R,`
`).split(`
`),e=[],s=Object(F.toMpegTsClockFromTimescale)(f,t),l="00:00.000",n=0,u=0,c,D=!0;o.oncue=function(L){var P=a[h],B=a.ccOffset,x=(n-s)/9e4;P!=null&&P.new&&(u!==void 0?B=a.ccOffset=P.start:E(a,h,x)),x&&(B=x-a.presentationOffset);var U=L.endTime-L.startTime,N=Object(C.normalizePts)((L.startTime+B-u)*9e4,v*9e4)/9e4;L.startTime=Math.max(N,0),L.endTime=Math.max(N+U,0);var k=L.text.trim();L.text=decodeURIComponent(encodeURIComponent(k)),L.id||(L.id=S(L.startTime,L.endTime,k)),L.endTime>0&&e.push(L)},o.onparsingerror=function(L){c=L},o.onflush=function(){if(c){r(c);return}i(e)},d.forEach(function(L){if(D)if(O(L,"X-TIMESTAMP-MAP=")){D=!1,L.slice(16).split(",").forEach(function(P){O(P,"LOCAL:")?l=P.slice(6):O(P,"MPEGTS:")&&(n=parseInt(P.slice(7)))});try{u=p(l)/1e3}catch(P){c=P}return}else L===""&&(D=!1);o.parse(L+`
`)}),o.flush()}},"./src/utils/xhr-loader.ts":function(G,b,y){"use strict";y.r(b);var M=y("./src/utils/logger.ts"),I=y("./src/loader/load-stats.ts"),A=/^age:\s*[\d.]+\s*$/m,F=function(){function C(O){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=O?O.xhrSetup:null,this.stats=new I.LoadStats,this.retryDelay=0}var R=C.prototype;return R.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},R.abortInternal=function(){var p=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),p&&(p.onreadystatechange=null,p.onprogress=null,p.readyState!==4&&(this.stats.aborted=!0,p.abort()))},R.abort=function(){var p;this.abortInternal(),(p=this.callbacks)!==null&&p!==void 0&&p.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},R.load=function(p,T,S){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=p,this.config=T,this.callbacks=S,this.retryDelay=T.retryDelay,this.loadInternal()},R.loadInternal=function(){var p=this.config,T=this.context;if(!!p){var S=this.loader=new self.XMLHttpRequest,E=this.stats;E.loading.first=0,E.loaded=0;var m=this.xhrSetup;try{if(m)try{m(S,T.url)}catch{S.open("GET",T.url,!0),m(S,T.url)}S.readyState||S.open("GET",T.url,!0);var g=this.context.headers;if(g)for(var f in g)S.setRequestHeader(f,g[f])}catch(t){this.callbacks.onError({code:S.status,text:t.message},T,S);return}T.rangeEnd&&S.setRequestHeader("Range","bytes="+T.rangeStart+"-"+(T.rangeEnd-1)),S.onreadystatechange=this.readystatechange.bind(this),S.onprogress=this.loadprogress.bind(this),S.responseType=T.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),p.timeout),S.send()}},R.readystatechange=function(){var p=this.context,T=this.loader,S=this.stats;if(!(!p||!T)){var E=T.readyState,m=this.config;if(!S.aborted&&E>=2)if(self.clearTimeout(this.requestTimeout),S.loading.first===0&&(S.loading.first=Math.max(self.performance.now(),S.loading.start)),E===4){T.onreadystatechange=null,T.onprogress=null;var g=T.status;if(g>=200&&g<300){S.loading.end=Math.max(self.performance.now(),S.loading.first);var f,t;if(p.responseType==="arraybuffer"?(f=T.response,t=f.byteLength):(f=T.responseText,t=f.length),S.loaded=S.total=t,!this.callbacks)return;var a=this.callbacks.onProgress;if(a&&a(S,p,f,T),!this.callbacks)return;var h={url:T.responseURL,data:f};this.callbacks.onSuccess(h,S,p,T)}else S.retry>=m.maxRetry||g>=400&&g<499?(M.logger.error(g+" while loading "+p.url),this.callbacks.onError({code:g,text:T.statusText},p,T)):(M.logger.warn(g+" while loading "+p.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,m.maxRetryDelay),S.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),m.timeout)}},R.loadtimeout=function(){M.logger.warn("timeout while loading "+this.context.url);var p=this.callbacks;p&&(this.abortInternal(),p.onTimeout(this.stats,this.context,this.loader))},R.loadprogress=function(p){var T=this.stats;T.loaded=p.loaded,p.lengthComputable&&(T.total=p.total)},R.getCacheAge=function(){var p=null;if(this.loader&&A.test(this.loader.getAllResponseHeaders())){var T=this.loader.getResponseHeader("age");p=T?parseFloat(T):null}return p},C}();b.default=F}}).default})}}]);

//# sourceMappingURL=26.773919a8.js.map