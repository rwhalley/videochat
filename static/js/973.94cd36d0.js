"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[973],{5973:(fe,S,i)=>{i.r(S),i.d(S,{default:()=>de});var e=i(8160),W=i(6024),j=i(8404),p=i.n(j),D=i(9067),H=i(8081),B=i(8546),U=i(3510),V=i(3133),Z=i(300),w=i(9290),d=i(8485),G=i(7688),I=i(455),g=i(9024),h=i(8721),N=i(6939),Q=i(27),k=i(5285),J=i(5861);function Y({hlsStatsState:n,onClose:t}){var r,l,u;return e.createElement(d.k,{css:{position:"absolute",minWidth:"60%",margin:"$8 0  0 $20","@md":{minWidth:"60%",margin:"$8 0  0 $8"},"@sm":{minWidth:"100%",margin:"$0"},padding:"$2 $4 $2 $4",zIndex:100,backgroundColor:"rgba(55,59,66, 0.84)",borderRadius:"$1"},direction:"column"},e.createElement(d.k,{justify:"end"},e.createElement(J.h,{onClick:t},e.createElement(Q.Z,null))),e.createElement(m,{label:"URL"},e.createElement(d.k,{align:"center"},e.createElement(k.Z,null),e.createElement("a",{style:{cursor:"pointer",textDecoration:"underline"},href:n?.url,target:"_blank",rel:"noreferrer"},"Stream url"))),e.createElement(m,{label:"Video size"},` ${(r=n?.videoSize)==null?void 0:r.width}x${(l=n?.videoSize)==null?void 0:l.height}`),e.createElement(m,{label:"Buffer duration"},(u=n?.bufferedDuration)==null?void 0:u.toFixed(2)," "),e.createElement(m,{label:"Connection speed"},`${(n?.bandwidthEstimate/(1e3*1e3)).toFixed(2)}Mbps`),e.createElement(m,{label:"Bitrate"},`${(n?.bitrate/(1e3*1e3)).toFixed(2)}Mbps`),e.createElement(m,{label:"distance from live"},X(n.distanceFromLive/1e3)),e.createElement(m,{label:"Total frames dropped"},`${n?.droppedFrames}`))}function X(n){let t=Math.floor(n);const r=Math.floor(t/3600);t=t-r*3600;const l=Math.floor(t/60),u=Math.floor(t-l*60),v=`${l<10?"0"+l:l}`,a=`${u<10?"0"+u:u}`;let c=`${v}:${a}`;return r&&(c=`${`${r<10?"0"+r:r}`}:${v}:${a}`),c}const m=(0,e.memo)(({label:n,children:t})=>e.createElement(d.k,{gap:4,justify:"between",css:{width:"100%"}},e.createElement(h.x,{css:{width:"30%","@md":{fontSize:"$md"},"@sm":{fontSize:"$sm"}}},n),e.createElement(h.x,{css:{"@md":{fontSize:"$md"},"@sm":{fontSize:"$sm"},maxWidth:"70%",minWidth:"50%",overflowWrap:"break-word"}},t)));var K=i(7097),q=i(9520),_=i(9478),ee=Object.defineProperty,te=(n,t,r)=>t in n?ee(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,L=(n,t,r)=>(te(n,typeof t!="symbol"?t+"":t,r),r);const C="hls-timed-metadata",x="hls-stream-no-longer-live",ne=10;class re{constructor(t,r){L(this,"hls"),L(this,"videoRef"),L(this,"eventEmitter",new q.EventEmitter2),L(this,"isLive",!0),this.hls=new(p())(this.getHLSConfig()),this.videoRef=r,this.hls.loadSource(t),this.hls.attachMedia(r.current),this.handleHLSTimedMetadataParsing(),this.ControllerEvents=[C,x]}reset(){this.hls&&this.hls.media&&(this.hls.detachMedia(),this.hls=null),this.eventEmitter=null}getCurrentLevel(){return this.hls.currentLevel}setCurrentLevel(t){const r=this.hls.levels.findIndex(l=>l.height===t.height);this.hls.currentLevel=r}getHlsJsInstance(){return this.hls}jumpToLive(){const t=this.videoRef.current;if(t.currentTime=this.hls.liveSyncPosition,t.paused)try{t.play()}catch(r){console.error("Attempt to jump to live position Failed.",r)}}on(t,r){t===x&&this.enableTimeUpdateListener(),this.ControllerEvents.indexOf(t)===-1?this.hls.on(t,r):this.eventEmitter.addListener(t,r)}enableTimeUpdateListener(){this.videoRef.current.addEventListener("timeupdate",t=>{if(this.hls){const r=this.videoRef.current,l=this.getHLSConfig().liveMaxLatencyDuration||ne;this.isLive=this.hls.liveSyncPosition-r.currentTime<=l,this.isLive||this.eventEmitter.emit(x)}})}handleHLSTimedMetadataParsing(){this.hls.on(p().Events.FRAG_CHANGED,(t,{frag:r})=>{try{if(this.videoRef.current.textTracks.length===0)return;const l=r.start;[...this.videoRef.current.textTracks[0].cues].filter(a=>a.startTime>=l).forEach(a=>{const c=a.startTime-l,f=r.end-r.start;if(c<f){const b=a.value.data;setTimeout(()=>{const A=a.endTime-a.startTime;this.eventEmitter.emit(C,{payload:b,duration:A,metadata:a})},c*1e3)}})}catch(l){console.error("FRAG_CHANGED event error",l)}})}getHLSConfig(){return _.T.optimiseHLSLatency()?{enableWorker:!0,liveSyncDuration:1,liveMaxLatencyDuration:5,liveDurationInfinity:!0,highBufferWatchdogPeriod:1}:{enableWorker:!0,maxBufferLength:20,backBufferLength:10}}}var F=i(5581),O=Object.getOwnPropertySymbols,le=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable,oe=(n,t)=>{var r={};for(var l in n)le.call(n,l)&&t.indexOf(l)<0&&(r[l]=n[l]);if(n!=null&&O)for(var l of O(n))t.indexOf(l)<0&&ie.call(n,l)&&(r[l]=n[l]);return r};const ae=(0,w.zo)("video",{margin:"0 auto",flex:"1 1 0",minHeight:0,h:"100%"});let s,y;const se=()=>{var n;const t=(0,e.useRef)(null),r=(0,D._U)(H.Yt),l=(0,D._U)((0,H.EP)(F._8.hlsStats)),u=(0,D.cw)();let[v,a]=(0,e.useState)(null);const c=(n=r.variants[0])==null?void 0:n.url,[f,b]=(0,e.useState)([]),[A,R]=(0,e.useState)(!0),[ue,M]=(0,e.useState)(""),[P,me]=(0,e.useState)(!1);(0,e.useEffect)(()=>{let o=t.current;return o&&c&&(p().isSupported()?(s=new re(c,t),y=new W.f(s.getHlsJsInstance(),o),s.on(x,()=>{R(!1)}),s.on(C,E=>{var $=E,{payload:T}=$,he=oe($,["payload"]);console.log(`%c Payload: ${T}`,"color:#2b2d42; background:#d80032"),console.log(he),K.y.addToast({title:`Payload from timed Metadata ${T}`})}),s.on(p().Events.MANIFEST_LOADED,(E,{levels:$})=>{const T=ce($);b(T),M("Auto")})):o.canPlayType("application/vnd.apple.mpegurl")&&(o.src=c)),()=>{y=null}},[c]),(0,e.useEffect)(()=>{if(!y)return;let o;return l?o=y.subscribe(E=>{a(E)}):o?.(),()=>{o?.()}},[l]),(0,e.useEffect)(()=>{if(s)return()=>s.reset()},[]);const z=(0,e.useCallback)(o=>{if(s){s.setCurrentLevel(o);const E=o.height==="auto"?"Auto":`${o.height}p`;M(E)}},[f]),ve=()=>{u.setAppData(F._8.hlsStats,!l)};return e.createElement(e.Fragment,null,v?.url&&l?e.createElement(Y,{hlsStatsState:v,onClose:ve}):null,c?e.createElement(d.k,{css:{flexDirection:"column",size:"100%",px:"$10"}},e.createElement(ae,{ref:t,autoPlay:!0,controls:!0,playsInline:!0}),e.createElement(d.k,{align:"center",justify:"end"},s?e.createElement(G.z,{variant:"standard",css:{marginRight:"0.3rem"},onClick:()=>{s.jumpToLive(),R(!0)},key:"LeaveRoom","data-testid":"leave_room_btn"},e.createElement(I.u,{title:"Jump to Live"},e.createElement(d.k,{css:{gap:"$2"}},e.createElement(B.Z,{color:A?"#CC525F":"FAFAFA",key:"jumpToLive"}),"Live"))):null,e.createElement(g.L.Root,{open:P,onOpenChange:o=>me(o)},e.createElement(g.L.Trigger,{asChild:!0,"data-testid":"quality_selector"},e.createElement(d.k,{css:{color:"$textPrimary",borderRadius:"$1",cursor:"pointer",zIndex:4,border:"$space$px solid $textDisabled",padding:"$4"}},e.createElement(I.u,{title:"Select Quality"},e.createElement(d.k,null,e.createElement(U.Z,null),e.createElement(h.x,{variant:"md"},ue))),e.createElement(N.x,{css:{"@lg":{display:"none"},color:"$textDisabled"}},P?e.createElement(V.Z,null):e.createElement(Z.Z,null)))),f.length>0&&e.createElement(g.L.Content,{sideOffset:5,align:"end",css:{height:"auto",maxHeight:"$96"}},e.createElement(g.L.Item,{onClick:o=>z({height:"auto"}),css:{h:"auto",flexDirection:"column",flexWrap:"wrap",cursor:"pointer",alignItems:"flex-start"},key:"auto"},e.createElement(h.x,null,"Automatic")),f.map(o=>e.createElement(g.L.Item,{onClick:()=>z(o),css:{h:"auto",flexDirection:"column",flexWrap:"wrap",cursor:"pointer",alignItems:"flex-start"},key:o.url},e.createElement(h.x,null,`${o.height}p (${(Number(o.bitrate/1024)/1024).toFixed(2)} Mbps)`))))))):e.createElement(d.k,{align:"center",justify:"center",css:{size:"100%",px:"$10"}},e.createElement(h.x,{variant:"md",css:{textAlign:"center"}},"Waiting for the stream to start...")))};function ce(n){return n.filter(({videoCodec:t,width:r,height:l})=>!!t||!!(r&&l))}const de=se}}]);

//# sourceMappingURL=973.94cd36d0.js.map